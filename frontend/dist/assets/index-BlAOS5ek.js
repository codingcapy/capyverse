import{Q as b,i as g,k as w,l as y,m as L,b as m,j as e,d as h,L as C,n as E,o as v,r as u,p as R,q as I}from"./index-Cta9xeSw.js";import{b as k}from"./images-CofRNpWY.js";import{P}from"./PostThumbnail-CSuUztLb.js";import{g as M}from"./users-BiPlqAA2.js";import{a as O,d as S}from"./purify.es-D3OjqHSp.js";import"./index-BmC9yB3L.js";var Q=class extends b{constructor(s,r){super(s,r)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:g()})}getOptimisticResult(s){return s.behavior=g(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,r){const{state:n}=s,o=super.createResult(s,r),{isFetching:i,isRefetching:a,isError:c,isRefetchError:x}=o,l=n.fetchMeta?.fetchMore?.direction,t=c&&l==="forward",d=i&&l==="forward",f=c&&l==="backward",p=i&&l==="backward";return{...o,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:y(r,n.data),hasPreviousPage:w(r,n.data),isFetchNextPageError:t,isFetchingNextPage:d,isFetchPreviousPageError:f,isFetchingPreviousPage:p,isRefetchError:x&&!t&&!f,isRefetching:a&&!d&&!p}}};function N(s,r){return L(s,Q)}function B(s){const{data:r,isLoading:n,error:o}=m(M(s.post.userId)),{data:i,isLoading:a,error:c}=m(O(s.post.postId));return e.jsxs("div",{className:"px-5 border-b border-[#222222] py-3",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:!n||o?r?r.profilePic?r.profilePic:h:h:h,alt:"",className:"w-6 h-6 rounded-full"}),n?e.jsx("div",{children:"Loading..."}):o?e.jsx("div",{children:"Unknown author"}):r?e.jsx("div",{className:"font-bold ml-2",children:r.username}):e.jsx("div",{children:"Unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:S(s.post.createdAt)})]}),e.jsx(C,{to:"/posts/$postId",params:{postId:s.post.postId.toString()},className:"font-bold hover:underline",children:e.jsx("div",{className:"my-2",children:s.post.title})}),a?e.jsx("div",{className:"pr-3",children:"Loading..."}):c?e.jsx("div",{className:"pr-3",children:"Error fetching comments"}):i?e.jsxs("div",{className:"text-sm",children:[i.length," comments"]}):e.jsx("div",{className:"pr-3"})]})}function j(){const{data:s,isLoading:r,error:n}=m(E());return e.jsx("aside",{className:"hidden 2xl:block sticky top-[110px] h-[calc(100vh-150px)] w-[300px] ml-5 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"bg-[#111111] rounded-xl pt-2 overflow-y-auto",children:[e.jsx("div",{className:"my-3 px-5",children:"RECENT POSTS"}),r?e.jsx("div",{className:"px-5 border-b border-[#222222] py-3",children:"Loading..."}):n?e.jsx("div",{className:"px-5 border-b border-[#222222] py-3",children:"Error fetching recent posts"}):s?s.map(o=>e.jsx(B,{post:o},o.postId)):e.jsx("div",{})]})})}function F(){const{searchContent:s}=v(),r=u.useRef(null),{data:n,fetchNextPage:o,hasNextPage:i,isFetchingNextPage:a,isPending:c,error:x}=N({queryKey:["new-posts"],queryFn:R,initialPageParam:null,getNextPageParam:t=>t.nextCursor}),l=n?.pages.flatMap(t=>t.posts)??[];return u.useEffect(()=>{if(!r.current||!i)return;const t=new IntersectionObserver(([d])=>{d.isIntersecting&&o()},{rootMargin:"200px"});return t.observe(r.current),()=>t.disconnect()},[o,i,l.length]),x?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):c?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{children:[l.filter(t=>s===""||t.title.toLowerCase().includes(s.toLowerCase())||t.content.toLowerCase().includes(s.toLowerCase())).map(t=>e.jsx(P,{post:t},t.postId)),e.jsx("div",{ref:r,style:{height:"40px",background:"#444444"}}),a&&e.jsx("div",{children:"Loading more…"}),!i&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(j,{})]})}function q(){const{searchContent:s}=v(),r=u.useRef(null),{data:n,fetchNextPage:o,hasNextPage:i,isFetchingNextPage:a,isPending:c,error:x}=N({queryKey:["popular-posts"],queryFn:I,initialPageParam:null,getNextPageParam:t=>t.nextCursor}),l=n?.pages.flatMap(t=>t.posts)??[];return u.useEffect(()=>{if(!r.current||!i)return;const t=new IntersectionObserver(([d])=>{console.log({isIntersecting:d.isIntersecting,boundingClientRect:d.boundingClientRect,rootBounds:d.rootBounds}),d.isIntersecting&&o()});return t.observe(r.current),()=>t.disconnect()},[o,i]),x?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):c?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{children:[l.filter(t=>s===""||t.title.toLowerCase().includes(s.toLowerCase())||t.content.toLowerCase().includes(s.toLowerCase())).map(t=>e.jsx(P,{post:t},t.postId)),e.jsx("div",{ref:r,className:"h-10 bg-[#444444]"}),a&&e.jsx("div",{children:"Loading more…"}),!i&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(j,{})]})}function $(){const[s,r]=u.useState(!1),[n,o]=u.useState("Popular"),i=u.useRef(null);function a(c){i.current&&!i.current.contains(c.target)&&r(!1)}return u.useEffect(()=>(document.addEventListener("click",a),()=>document.removeEventListener("click",a)),[]),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"mx-auto w-full md:w-[50%] pt-[70px] pb-5 ",children:e.jsxs("div",{ref:i,className:"relative mx-auto w-full 2xl:w-[750px] flex",children:[e.jsxs("div",{onClick:()=>r(!s),className:"flex cursor-pointer pl-4 md:pl-0 md:pt-1 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx("div",{className:"text-xs",children:n}),e.jsx("div",{className:"ml-2",children:e.jsx(k,{})})]}),s&&e.jsxs("div",{onClick:()=>{},className:"absolute top-6 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[e.jsx("div",{onClick:()=>{o("Popular"),r(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),e.jsx("div",{onClick:()=>{o("New"),r(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]})}),n==="Popular"?e.jsx(q,{}):e.jsx(F,{})]})})}export{$ as component};
