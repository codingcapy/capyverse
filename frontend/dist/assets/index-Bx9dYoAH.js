import{b as h,l as L,j as e,d as x,L as I,m as C,n as g,r as d,o as E,p as k}from"./index-oCxPLNMr.js";import{c as S}from"./images-DZe8fdJr.js";import{u as v}from"./useInfiniteQuery-DVKg1p84.js";import{P as j}from"./PostThumbnail-CKwSRBmt.js";import{g as R}from"./users-32qS8ict.js";import{a as B,b as M,d as f}from"./purify.es-EML7CgGw.js";function O(t){const{data:r,isLoading:n,error:o}=h(R(t.post.userId)),{data:i,isLoading:l,error:c}=h(B(t.post.postId)),{data:m,isLoading:u,isError:s}=h(M(t.post.postId)),{data:a,isLoading:b,error:P}=h({...L(t.post.communityId),enabled:!!t.post.communityId}),y=!!t.post.communityId;return e.jsxs("div",{className:"px-5 border-b border-[#222222] py-3",children:[y?b?e.jsx("div",{children:"Loading..."}):P?e.jsx("div",{children:"Error loading community"}):a?e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:a.icon?a.icon:x,alt:"",className:"w-6 h-6 rounded-full"}),e.jsxs("div",{className:"font-bold ml-2",children:["c/",a.communityId]}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:f(t.post.createdAt)})]}):e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:!n||o?r?r.profilePic?r.profilePic:x:x:x,alt:"",className:"w-6 h-6 rounded-full"}),n?e.jsx("div",{children:"Loading..."}):o?e.jsx("div",{children:"Unknown author"}):r?e.jsx("div",{className:"font-bold ml-2",children:r.username}):e.jsx("div",{children:"Unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:f(t.post.createdAt)})]}):e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:!n||o?r?r.profilePic?r.profilePic:x:x:x,alt:"",className:"w-6 h-6 rounded-full"}),n?e.jsx("div",{children:"Loading..."}):o?e.jsx("div",{children:"Unknown author"}):r?e.jsx("div",{className:"font-bold ml-2",children:r.username}):e.jsx("div",{children:"Unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:f(t.post.createdAt)})]}),e.jsx(I,{to:"/posts/$postId",params:{postId:t.post.postId.toString()},className:"font-bold hover:underline",children:e.jsx("div",{className:"my-2",children:t.post.title})}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"text-sm mr-2",children:[u?"Loading...":s?"error":m!==void 0?m.filter(p=>p.commentId===null).reduce((p,w)=>p+w.value,0):"error"," ","votes"]}),e.jsxs("div",{className:"text-sm",children:[l?"Loading...":c?"error":i," ","comments"]})]})]})}function N(){const{data:t,isLoading:r,error:n}=h(C());return e.jsx("aside",{className:"hidden 2xl:block sticky top-[110px] h-[calc(100vh-150px)] w-[300px] ml-5 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"bg-[#111111] rounded-xl pt-2 overflow-y-auto",children:[e.jsx("div",{className:"my-3 px-5",children:"RECENT POSTS"}),r?e.jsx("div",{className:"px-5 border-b border-[#222222] py-3",children:"Loading..."}):n?e.jsx("div",{className:"px-5 border-b border-[#222222] py-3",children:"Error fetching recent posts"}):t?t.map(o=>e.jsx(O,{post:o},o.postId)):e.jsx("div",{})]})})}function Q(){const{searchContent:t}=g(),r=d.useRef(null),{data:n,fetchNextPage:o,hasNextPage:i,isFetchingNextPage:l,isPending:c,error:m}=v({queryKey:["new-posts"],queryFn:E,initialPageParam:null,getNextPageParam:s=>s.nextCursor}),u=n?.pages.flatMap(s=>s.posts)??[];return d.useEffect(()=>{if(!r.current||!i)return;const s=new IntersectionObserver(([a])=>{a.isIntersecting&&o()},{rootMargin:"200px"});return s.observe(r.current),()=>s.disconnect()},[o,i,u.length]),m?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):c?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{children:[u.filter(s=>t===""||s.title.toLowerCase().includes(t.toLowerCase())||s.content.toLowerCase().includes(t.toLowerCase())).map(s=>e.jsx(j,{post:s},s.postId)),e.jsx("div",{ref:r,style:{height:"40px",background:"#444444"}}),l&&e.jsx("div",{children:"Loading more…"}),!i&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(N,{})]})}function U(){const{searchContent:t}=g(),r=d.useRef(null),{data:n,fetchNextPage:o,hasNextPage:i,isFetchingNextPage:l,isPending:c,error:m}=v({queryKey:["popular-posts"],queryFn:k,initialPageParam:null,getNextPageParam:s=>s.nextCursor}),u=n?.pages.flatMap(s=>s.posts)??[];return d.useEffect(()=>{if(!r.current||!i)return;const s=new IntersectionObserver(([a])=>{console.log({isIntersecting:a.isIntersecting,boundingClientRect:a.boundingClientRect,rootBounds:a.rootBounds}),a.isIntersecting&&o()});return s.observe(r.current),()=>s.disconnect()},[o,i]),m?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):c?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{children:[u.filter(s=>t===""||s.title.toLowerCase().includes(t.toLowerCase())||s.content.toLowerCase().includes(t.toLowerCase())).map(s=>e.jsx(j,{post:s},s.postId)),e.jsx("div",{ref:r,className:"h-10 bg-[#444444]"}),l&&e.jsx("div",{children:"Loading more…"}),!i&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(N,{})]})}function K(){const[t,r]=d.useState(!1),[n,o]=d.useState("Popular"),i=d.useRef(null);function l(c){i.current&&!i.current.contains(c.target)&&r(!1)}return d.useEffect(()=>(document.addEventListener("click",l),()=>document.removeEventListener("click",l)),[]),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"mx-auto w-full md:w-[50%] pt-[70px] pb-5 ",children:e.jsxs("div",{ref:i,className:"relative mx-auto w-full 2xl:w-[750px] flex",children:[e.jsxs("div",{onClick:()=>r(!t),className:"flex cursor-pointer pl-4 md:pl-0 md:pt-1 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx("div",{className:"text-xs",children:n}),e.jsx("div",{className:"ml-2",children:e.jsx(S,{})})]}),t&&e.jsxs("div",{onClick:()=>{},className:"absolute top-6 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[e.jsx("div",{onClick:()=>{o("Popular"),r(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),e.jsx("div",{onClick:()=>{o("New"),r(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]})}),n==="Popular"?e.jsx(U,{}):e.jsx(Q,{})]})})}export{K as component};
