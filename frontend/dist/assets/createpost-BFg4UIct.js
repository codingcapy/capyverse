import{u as E,c as U,a as z,r,j as e}from"./index-BbOmwRhB.js";import{a as L,u as O,g as k,b as R}from"./images-C9OjxddE.js";import{a as T}from"./index-CHqMXX7M.js";import{P as B}from"./PostContentInput-d2ohVxOx.js";function G(){const{user:s}=E(),{mutate:x,isPending:h,error:g}=U(),m=z(),[b,i]=r.useState(""),[v,l]=r.useState(!1),j=r.useRef(null),[u,M]=r.useState(null),{mutate:p,isPending:f}=L(),{data:n,isLoading:I,error:y}=O(k(s&&s.userId||"")),[$,A]=r.useState(""),{mutate:N}=R(),[c,d]=r.useState(0),P=n&&n[c],[o,C]=r.useState("");function D(t){if(t.preventDefault(),!s)return"Error: no logged in user";if(o.length>1e4)return i("Post content length max character limit is 10,000");const a=t.target.titleinput.value;if(a.length>400)return i("Title content length max character limit is 400");x({userId:s.userId||"",title:a,content:o},{onSuccess:()=>m({to:"/"}),onError:w=>i(w.toString())}),g&&i(g.toString())}function S(t){if(f)return;const a=t.target.files?.[0];a&&(p({postId:"",userId:s&&s.userId||"",file:a}),t.target.value="")}return r.useEffect(()=>{s||m({to:"/login"})},[s]),r.useEffect(()=>()=>{u&&URL.revokeObjectURL(u)},[u]),r.useEffect(()=>console.log(o),[o]),e.jsxs("div",{className:"pt-20 w-[80%] lg:w-[50%] 2xl:w-[30%] mx-auto",children:[e.jsx("div",{className:"text-center font-bold text-cyan-500 text-2xl mb-5",children:"Create Post"}),e.jsxs("form",{onSubmit:D,className:"flex flex-col mx-auto ",children:[e.jsx("input",{type:"text",name:"titleinput",id:"title",required:!0,className:"p-2 border border-[#c4c4c4] rounded-xl my-2",placeholder:"Title"}),e.jsxs("div",{onDragEnter:t=>{t.preventDefault(),l(!0)},onDragOver:t=>{t.preventDefault(),l(!0)},onDragLeave:()=>l(!1),onDrop:t=>{if(t.preventDefault(),l(!1),f)return;const a=t.dataTransfer.files?.[0];a&&p({postId:"",userId:s&&s.userId||"",file:a})},className:`my-5 border border-dashed w-full h-[150px] rounded-xl ${v?"bg-[#242424]":""}`,children:[e.jsx("input",{ref:j,type:"file",className:"hidden",accept:"image/png, image/jpeg, image/heic, image/webp"}),e.jsxs("div",{className:"relative w-full h-full",children:[y?e.jsx("div",{children:"Error loading images"}):I?e.jsx("div",{children:"Loading..."}):n?n.length>0?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[n.length>1&&e.jsx("button",{type:"button",onClick:()=>d(t=>t===0?n.length-1:t-1),className:"absolute left-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:"‹"}),P&&e.jsxs("div",{className:"relative",children:[e.jsx(T,{size:20,className:"text-red-400 absolute top-2 right-2 bg-zinc-700 p-[4px] rounded z-10 cursor-pointer",onClick:()=>N({imageId:n[c].imageId})}),e.jsx("img",{src:`https://${n[c].imageUrl}`,className:"max-h-[140px] mx-auto rounded-lg bg-[#3d3d3d] object-contain"})]}),n.length>1&&e.jsx("button",{type:"button",onClick:()=>d(t=>t===n.length-1?0:t+1),className:"absolute right-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:"›"}),e.jsx("div",{className:"absolute bottom-2 flex gap-1",children:n.map((t,a)=>e.jsx("button",{type:"button",onClick:()=>d(a),className:`w-2 h-2 rounded-full ${a===c?"bg-cyan-400":"bg-zinc-500"}`},a))})]}):e.jsx("div",{className:"text-center pt-[60px]",children:"Drag and drop or upload images"}):e.jsx("div",{className:"text-center pt-[60px]",children:"Drag and drop or upload images"}),e.jsx("input",{type:"file",className:"absolute top-0 left-0 w-full h-full py-2 opacity-0 cursor-pointer appearance-none file:hidden",accept:"image/png, image/jpeg, image/heic, image/webp",onChange:S})]})]}),e.jsx(B,{content:o,onChange:t=>C(t),contentPlaceholder:"Content (optional)"}),e.jsx("button",{className:"bg-cyan-600 px-5 py-2 rounded-full font-bold my-5 cursor-pointer hover:bg-cyan-500 transition-all ease-in-out duration-300",children:h?"Loading...":"POST"})]}),e.jsx("div",{children:b})]})}export{G as component};
