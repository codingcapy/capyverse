import{u as E,a as k,j as e,r as x,d as z,F as X,e as Y,I as Z,R as ee,c as te,f as ne,h as se}from"./index-DD15-aUF.js";import{u as M,b as oe,c as ae,e as re,f as de,h as le,i as ie,j as ce,k as me,l as B,m as ue,n as xe,d as Q,F as _,g as fe,M as he,V as pe}from"./comments-YfOFELjd.js";import{g as q}from"./users-DWf42UMc.js";import{d as A}from"./capypaul01-dN7xfBcC.js";function ve(t){const{data:a,isLoading:i,isError:c}=M(oe(t.comment.commentId)),{mutate:m}=ae(),{mutate:d}=re(),{user:r}=E(),g=k();function f(n,l,j,h){n.preventDefault(),n.stopPropagation();const p=a&&a.find(C=>r&&C.userId===r.userId);r&&p?d({voteId:p.voteId,value:h}):r?m({userId:r&&r.userId||"",postId:l.postId,commentId:j.commentId,value:h}):g({to:"/login"})}return e.jsx("div",{children:c?e.jsx("div",{children:"Error fetching votes"}):i?e.jsx("div",{children:"Loading..."}):a?e.jsxs("div",{className:"flex w-fit rounded-full py-1 justify-center",children:[a.filter(n=>r&&n.userId===r.userId&&n.value===1).length>0?e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),d({voteId:a.find(l=>l.postId===t.post.postId&&r&&l.userId===r.userId&&l.value===1).voteId,value:0})},className:"pr-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(de,{size:20})}):e.jsx("div",{onClick:n=>{f(n,t.post,t.comment,1)},className:"pr-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(le,{size:20})}),e.jsx("div",{className:"",children:a.filter(n=>n.postId===t.post.postId).reduce((n,l)=>n+l.value,0)}),a.filter(n=>r&&n.userId===r.userId&&n.value===-1).length>0?e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),d({voteId:a.find(l=>l.postId===t.post.postId&&r&&l.userId===r.userId&&l.value===-1).voteId,value:0})},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(ie,{size:20})}):e.jsx("div",{onClick:n=>{f(n,t.post,t.comment,-1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(ce,{size:20})})]}):e.jsx("div",{children:"An unexpected error has occured"})})}function je(t){const a=x.useRef(null),{user:i}=E(),{setEditCommentModePointer:c}=z();k();function m(d){a.current&&!a.current.contains(d.target)&&t.setShowMenu(!1)}return x.useEffect(()=>(document.addEventListener("click",m),()=>document.removeEventListener("click",m)),[]),e.jsxs("div",{ref:a,className:"absolute top-12 right-2 py-2 px-5 rounded bg-[#222222] shadow-[0_0_15px_rgba(0,0,0,0.7)] z-40",children:[i&&t.comment.userId===i.userId&&e.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[e.jsx(me,{size:20,className:"pt-1"}),e.jsx("div",{onClick:()=>{c(t.comment.commentId),t.setCommentContent(t.comment.content||""),t.setShowMenu(!1)},className:"ml-2",children:"Edit"})]}),e.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[e.jsx(X,{size:20,className:"pt-1"}),e.jsx("div",{className:"ml-2",children:"Save"})]}),i&&t.comment.userId===i.userId&&e.jsxs("div",{onClick:d=>{d.stopPropagation(),d.preventDefault(),t.setDeleteMode(!0),t.setShowMenu(!1)},className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[e.jsx(Y,{size:20,className:"pt-1 "}),e.jsx("div",{className:"ml-2",children:"Delete"})]})]})}function $(t){const[a,i]=x.useState(!1),{user:c}=E(),[m,d]=x.useState(""),{mutate:r,isPending:g}=B(),f=k(),[n,l]=x.useState(!1),[j,h]=x.useState(!1),{mutate:p,isPending:C}=ue(),{editCommentModePointer:N,setEditCommentModePointer:b}=z(),{mutate:y}=xe();function I(s){if(s.preventDefault(),!c)return f({to:"/login"});const P=c.userId;r({userId:P,postId:t.post.postId,parentCommentId:t.comment.commentId,level:t.comment.level+1,content:m},{onSuccess:()=>{d(""),i(!1)}})}function S(s){if(s.preventDefault(),!c)return f({to:"/login"});y({commentId:t.comment.commentId,content:m},{onSuccess:()=>{b(0),d("")}})}return e.jsxs("div",{className:"my-3",style:{marginLeft:window.innerWidth>760?t.comment.level*25:t.comment.level*10},children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("div",{className:"font-bold",children:t.comment.username}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:Q(t.post.createdAt)})]}),N===t.comment.commentId?e.jsxs("form",{onSubmit:S,className:"pl-5 py-2 my-5 rounded-2xl border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300",children:[e.jsx("input",{type:"text",placeholder:"Add your reply",className:"outline-none w-full",value:m,onChange:s=>d(s.target.value),required:!0}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:s=>{s.stopPropagation(),b(0)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:"Save Edits"})]})]}):e.jsx("div",{children:t.comment.content}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"mr-3",children:e.jsx(ve,{post:t.post,comment:t.comment})}),e.jsxs("div",{onClick:()=>{c||f({to:"/login"}),i(!0)},className:"flex ml-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx(Z,{size:22}),e.jsx("div",{className:"ml-2",children:"Reply"})]}),c&&t.comment.userId===c.userId&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{onClick:s=>{s.preventDefault(),s.stopPropagation(),l(!n)},className:"ml-3 px-2 pt-1.5 rounded-full hover:text-cyan-700 transition-all ease-in-out duration-300 cursor-pointer",children:e.jsx(_,{})}),n&&e.jsx(je,{comment:t.comment,setDeleteMode:h,setShowMenu:l,setCommentContent:d})]})]}),a&&e.jsxs("form",{onSubmit:I,className:`pl-5 py-2 my-5 ${a?"rounded-2xl":"rounded-full"} border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300`,children:[e.jsx("input",{type:"text",placeholder:"Add your reply",className:"outline-none w-full",value:m,onChange:s=>d(s.target.value),required:!0}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:s=>{s.stopPropagation(),i(!1)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:g,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:g?"Creating...":"Comment"})]})]}),j&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Comment?"}),e.jsx("div",{className:"my-5",children:"Once you delete this comment, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),!C&&(p({commentId:t.comment.commentId}),h(!1))},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:C?"Deleting...":"DELETE"}),e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),h(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"}),t.comment.children?.map(s=>e.jsx($,{comment:s,post:t.post},s.commentId))]},t.comment.commentId)}function Ne(){const t=ee.useRouteContext(),{user:a}=E(),{data:i,isLoading:c,error:m}=M(fe(t.postId)),{data:d,isLoading:r,error:g}=M(q(t.userId)),[f,n]=x.useState(""),{mutate:l}=B(),j=k(),[h,p]=x.useState(!1),C=G(i&&i||[]),[N,b]=x.useState(!1),[y,I]=x.useState(!1),{mutate:S}=te(),{editPostModePointer:s,setEditPostModePointer:P}=z(),{mutate:J}=ne(),[F,R]=x.useState(t.content),V=se(),{data:D,isLoading:W}=M(q(t.userId));function G(o,T){const L=new Map;for(const u of o)L.set(u.commentId,{...u,children:[]});const w=[];for(const u of o){const v=L.get(u.commentId);if(u.parentCommentId==null){w.push(v);continue}const U=L.get(u.parentCommentId);if(!U){w.push(v);continue}U.children.push(v)}const K=(u,v)=>u.createdAt.getTime()-v.createdAt.getTime();function O(u){u.sort(K);for(const v of u)v.children.length&&O(v.children)}return O(w),w}function H(o){if(o.preventDefault(),!a)return j({to:"/login"});const T=a.userId;l({userId:T,postId:t.postId,content:f},{onSuccess:()=>{n(""),p(!1)}})}return e.jsxs("div",{className:"pt-[70px] mx-auto w-full lg:w-[50%]",children:[e.jsxs("div",{className:"relative flex justify-between",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:W?A:D?D.profilePic?D.profilePic:A:A,alt:"",className:"w-8 h-8 rounded-full"}),r?e.jsx("div",{className:"ml-2",children:"Loading..."}):g?e.jsx("div",{children:"Error loading author"}):d?e.jsx("div",{className:"font-bold ml-2",children:d.username}):e.jsx("div",{className:"ml-2",children:"unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:Q(t.createdAt)})]}),e.jsx("div",{className:"",children:e.jsx("div",{onClick:o=>{o.stopPropagation(),o.preventDefault(),b(!N)},className:" absolute top-1 right-1 p-3 rounded-full hover:bg-[#575757] transition-all ease-in-out duration-300",children:e.jsx(_,{})})}),N&&e.jsx(he,{post:t,setDeleteMode:I,setShowMenu:b})]}),e.jsxs("div",{className:"text-4xl font-bold",children:[" ",t.title]}),s===t.postId?e.jsxs("div",{children:[e.jsx("textarea",{name:"content",id:"content",required:!0,className:"p-2 border border-[#c4c4c4] rounded my-2 w-full h-[300px]",placeholder:"content",value:F,onChange:o=>R(o.target.value)}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:o=>{o.stopPropagation(),P(0)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{onClick:()=>{J({postId:t.postId,content:F},{onSuccess:()=>{V.invalidate(),P(0)}})},className:"mx-2 px-2 py-1 rounded-full bg-cyan-700",children:"Save"})]})]}):e.jsx("div",{className:"my-10",children:e.jsx("div",{children:t.content})}),e.jsx(pe,{post:t}),e.jsxs("form",{onClick:()=>{a||j({to:"/login"}),p(!0)},onSubmit:H,className:`pl-5 py-2 my-5 ${h?"rounded-2xl":"rounded-full"} border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300`,children:[e.jsx("input",{type:"text",placeholder:"Join the conversation",value:f,onChange:o=>n(o.target.value),required:!0,className:"outline-none w-full"}),h&&e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:o=>{o.stopPropagation(),p(!1)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:"Comment"})]})]}),a&&t.userId===a.userId&&y&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Post?"}),e.jsx("div",{className:"my-5",children:"Once you delete this post, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:o=>{o.stopPropagation(),o.preventDefault(),S({postId:t.postId},{onSuccess:()=>{V.invalidate(),I(!1),R("[This post has been deleted by the user]")}})},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:"DELETE"}),e.jsx("div",{onClick:o=>{o.stopPropagation(),o.preventDefault(),I(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]}),a&&t.userId===a.userId&&y&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"}),m?e.jsx("div",{children:"Error loading comments"}):c?e.jsx("div",{children:"Loading..."}):C.map(o=>e.jsx($,{comment:o,post:t},o.commentId))]})}export{Ne as component};
