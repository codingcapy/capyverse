import{r as i,c as b,u as y,j as e,L as C,d as L,g as I}from"./index-CzHZuhTX.js";import{u as g,d as P,F as E,V as k,M as S,P as M,g as D}from"./Menu-BpIz--aA.js";import{d as j}from"./capypaul01-dN7xfBcC.js";import{g as A}from"./users-BsQrLrRH.js";function m(t){const[c,u]=i.useState(!1),[r,d]=i.useState(!1),{mutate:p}=b(),{user:l}=y(),{data:a,isLoading:x}=g(A(t.post.userId));return e.jsxs("div",{className:"mx-auto w-full lg:w-[50%] 2xl:w-[750px] border-t border-[#636363]",children:[e.jsxs(C,{to:"/posts/$postId",params:{postId:t.post.postId.toString()},children:[e.jsxs("div",{className:"relative my-1 rounded p-5 hover:bg-[#333333] transition-all ease-in-out duration-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:x?j:a?a.profilePic?a.profilePic:j:j,alt:"",className:"w-6 h-6 rounded-full"}),e.jsx("div",{className:"font-bold ml-2",children:t.post.username}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:P(t.post.createdAt)})]}),e.jsx("div",{onClick:o=>{o.stopPropagation(),o.preventDefault(),u(!c)},className:"absolute top-1 right-1 p-3 rounded-full hover:bg-[#575757] transition-all ease-in-out duration-300",children:e.jsx(E,{})})]}),e.jsx("div",{className:"text-2xl font-bold",children:t.post.title}),e.jsx("div",{className:"my-2",children:t.post.content}),e.jsx(k,{post:t.post}),c&&e.jsx(S,{post:t.post,setDeleteMode:d,setShowMenu:u})]}),l&&t.post.userId===l.userId&&r&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Post?"}),e.jsx("div",{className:"my-5",children:"Once you delete this post, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:o=>{o.stopPropagation(),o.preventDefault(),p({postId:t.post.postId}),d(!1)},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:"DELETE"}),e.jsx("div",{onClick:o=>{o.stopPropagation(),o.preventDefault(),d(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]})]},t.post.postId),l&&t.post.userId===l.userId&&r&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"})]})}function R(){const{data:t,isLoading:c,isError:u}=g(I()),{data:r,isLoading:d,isError:p}=g(D()),[l,a]=i.useState(!1),[x,o]=i.useState("Popular"),f=i.useRef(null),{searchContent:n}=L();function w(s){f.current&&!f.current.contains(s.target)&&a(!1)}return i.useEffect(()=>(document.addEventListener("click",w),()=>document.removeEventListener("click",w)),[]),e.jsx("div",{className:"flex-1 p-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"mx-auto w-full lg:w-[50%] pt-[70px] pb-5 ",children:e.jsxs("div",{ref:f,className:"relative mx-auto w-full 2xl:w-[750px] flex",children:[e.jsxs("div",{onClick:()=>a(!l),className:"flex cursor-pointer",children:[e.jsx("div",{className:"text-xs",children:x}),e.jsx("div",{className:"ml-2",children:e.jsx(M,{})})]}),l&&e.jsxs("div",{onClick:()=>{},className:"absolute top-5 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[e.jsx("div",{onClick:()=>{o("Popular"),a(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),e.jsx("div",{onClick:()=>{o("New"),a(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]})}),u?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):c?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):t?x==="Popular"?p?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching votes"}):d?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):r?t.sort((s,h)=>{const N=r.filter(v=>v.postId===s.postId).length||0;return(r.filter(v=>v.postId===h.postId).length||0)-N}).map(s=>n===""?e.jsx(m,{post:s},s.postId):s.title.toLowerCase().includes(n.toLowerCase())||s.content.toLowerCase().includes(n.toLowerCase())?e.jsx(m,{post:s},s.postId):""):e.jsx("div",{children:"An unexpected error has occured"}):t.sort((s,h)=>h.createdAt.getTime()-s.createdAt.getTime()).map(s=>n===""?e.jsx(m,{post:s},s.postId):s.title.toLowerCase().includes(n.toLowerCase())||s.content.toLowerCase().includes(n.toLowerCase())?e.jsx(m,{post:s},s.postId):""):e.jsx("div",{children:"An unexpected error has occured"})]})})}export{R as component};
