import{q as g,m as d,n as h,o as y,G as m,u as j,a as C,j as r,r as x,d as k,p as S,b as A,s as F,t as q,F as B,l as N}from"./index-CiYj8PkR.js";import{u as M}from"./images-D2N2NQ0m.js";const Y="/capypaul01.jpg";function P(e){return{...e,createdAt:new Date(e.createdAt)}}async function V(e){const t=await d.api.v0.comments.$post({json:e});if(!t.ok){let a="There was an issue creating your comment :( We'll look into it ASAP!";try{const s=await t.json();s&&typeof s=="object"&&"message"in s&&(a=String(s.message))}catch(s){console.error("Failed to parse error response:",s)}throw new Error(a)}return await t.json()}const ee=e=>{const t=h();return y({mutationFn:V,onSettled:()=>{t.invalidateQueries({queryKey:["comments"]})},onError:o=>{}})};async function D(e){const t=await d.api.v0.comments[":postId"].$get({param:{postId:e.toString()}});if(!t.ok)throw new Error("Error getting comments by id");const{comments:o}=await t.json();return o.map(P)}const te=e=>g({queryKey:["comments",e],queryFn:()=>D(e)});async function b(e){const t=await d.api.v0.comments.comment.delete.$post({json:e});if(!t.ok){let a="There was an issue deleting your post :( We'll look into it ASAP!";throw console.log(e),new Error(a)}return await t.json()}const oe=e=>{const t=h();return y({mutationFn:b,onSettled:(o,a)=>{if(!o)return console.log("No data, returning");t.invalidateQueries({queryKey:["comments",o.commentResult.postId]}),t.invalidateQueries({queryKey:["posts"]})},onError:o=>{}})};async function L(e){const t=await d.api.v0.comments.comment.update.$post({json:e});if(!t.ok){let a="There was an issue updating your post :( We'll look into it ASAP!";throw console.log(e),new Error(a)}return await t.json()}const re=e=>{const t=h();return y({mutationFn:L,onSettled:(o,a)=>{if(!o)return console.log("No data, returning");t.invalidateQueries({queryKey:["comments",o.commentResult.postId]}),t.invalidateQueries({queryKey:["posts"]})},onError:o=>{}})};async function Q(e){const t=await d.api.v0.comments.user[":userId"].$get({param:{userId:e.toString()}});if(!t.ok)throw new Error("Error getting comments by user id");const{comments:o}=await t.json();return o.map(P)}const se=e=>g({queryKey:["comments",e],queryFn:()=>Q(e)});async function R(e){const t=await d.api.v0.votes.$post({json:e});if(!t.ok){let a="There was an issue creating your vote :( We'll look into it ASAP!";try{const s=await t.json();s&&typeof s=="object"&&"message"in s&&(a=String(s.message))}catch(s){console.error("Failed to parse error response:",s)}throw new Error(a)}const o=await t.json();if(!o.vote)throw new Error("Invalid response from server");return o.vote}const H=e=>{const t=h();return y({mutationFn:R,onSettled:()=>{t.invalidateQueries({queryKey:["votes"]})},onError:o=>{}})};async function K(e){const t=await d.api.v0.votes[":postId"].$get({param:{postId:e.toString()}});if(!t.ok)throw new Error("Error getting votes by postId");const{votes:o}=await t.json();return o}const z=e=>g({queryKey:["votes",e],queryFn:()=>K(e)});async function T(e){const t=await d.api.v0.votes.update.$post({json:e});if(!t.ok){let a="There was an issue updating your vote :( We'll look into it ASAP!";throw console.log(e),new Error(a)}return await t.json()}const Z=e=>{const t=h();return y({mutationFn:T,onSettled:(o,a)=>{t.invalidateQueries({queryKey:["votes"]})},onError:o=>{}})};async function $(e){const t=await d.api.v0.votes.comments[":commentId"].$get({param:{commentId:e.toString()}});if(!t.ok)throw new Error("Error getting comment votes by commentId");const{votes:o}=await t.json();return o}const ne=e=>g({queryKey:["votes",e],queryFn:()=>$(e)});function ae(e){return m({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,104.49l-80,80a12,12,0,0,1-17,0l-80-80a12,12,0,0,1,17-17L128,159l71.51-71.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function ie(e){return m({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M168.49,199.51a12,12,0,0,1-17,17l-80-80a12,12,0,0,1,0-17l80-80a12,12,0,0,1,17,17L97,128Z"},child:[]}]})(e)}function ue(e){return m({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184.49,136.49l-80,80a12,12,0,0,1-17-17L159,128,87.51,56.49a12,12,0,1,1,17-17l80,80A12,12,0,0,1,184.49,136.49Z"},child:[]}]})(e)}function U(e){return m({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M229.66,141.66l-96,96a8,8,0,0,1-11.32,0l-96-96A8,8,0,0,1,32,128H72V48A16,16,0,0,1,88,32h80a16,16,0,0,1,16,16v80h40a8,8,0,0,1,5.66,13.66Z"},child:[]}]})(e)}function O(e){return m({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M231.39,123.06A8,8,0,0,1,224,128H184v80a16,16,0,0,1-16,16H88a16,16,0,0,1-16-16V128H32a8,8,0,0,1-5.66-13.66l96-96a8,8,0,0,1,11.32,0l96,96A8,8,0,0,1,231.39,123.06Z"},child:[]}]})(e)}function W(e){return m({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M231.39,132.94A8,8,0,0,0,224,128H184V48a16,16,0,0,0-16-16H88A16,16,0,0,0,72,48v80H32a8,8,0,0,0-5.66,13.66l96,96a8,8,0,0,0,11.32,0l96-96A8,8,0,0,0,231.39,132.94ZM128,220.69,51.31,144H80a8,8,0,0,0,8-8V48h80v88a8,8,0,0,0,8,8h28.69Z"},child:[]}]})(e)}function _(e){return m({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M229.66,114.34l-96-96a8,8,0,0,0-11.32,0l-96,96A8,8,0,0,0,32,128H72v80a16,16,0,0,0,16,16h80a16,16,0,0,0,16-16V128h40a8,8,0,0,0,5.66-13.66ZM176,112a8,8,0,0,0-8,8v88H88V120a8,8,0,0,0-8-8H51.31L128,35.31,204.69,112Z"},child:[]}]})(e)}function le(e){const{data:t,isLoading:o,isError:a}=M(z(e.post.postId)),{mutate:s,isPending:f}=H(),{mutate:c,isPending:p}=Z(),{user:i}=j(),v=C();function u(n,l,w){if(n.preventDefault(),n.stopPropagation(),f||p)return;const I=t&&t.find(E=>i&&E.userId===i.userId);i&&I?c({voteId:I.voteId,value:w}):i?s({userId:i&&i.userId||"",postId:l.postId,value:w}):v({to:"/login"})}return r.jsx("div",{children:a?r.jsx("div",{children:"Error fetching votes"}):o?r.jsx("div",{children:"Loading..."}):t?r.jsxs("div",{className:"flex bg-[#3e3e3e] w-fit rounded-full py-1 justify-center",children:[t.filter(n=>n.commentId===null&&i&&n.userId===i.userId&&n.value===1).length>0?r.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),c({voteId:t.find(l=>l.commentId===null&&i&&l.userId===i.userId&&l.value===1).voteId,value:0})},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:r.jsx(O,{size:20})}):r.jsx("div",{onClick:n=>{u(n,e.post,1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:r.jsx(_,{size:20})}),r.jsx("div",{className:"font-semibold",children:t.filter(n=>n.commentId===null).reduce((n,l)=>n+l.value,0)}),t.filter(n=>n.commentId===null&&i&&n.userId===i.userId&&n.value===-1).length>0?r.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),c({voteId:t.find(l=>l.commentId===null&&l.postId===e.post.postId&&i&&l.userId===i.userId&&l.value===-1).voteId,value:0})},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:r.jsx(U,{size:20})}):r.jsx("div",{onClick:n=>{u(n,e.post,-1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:r.jsx(W,{size:20})})]}):r.jsx("div",{children:"An unexpected error has occured"})})}function ce(e){const t=typeof e=="string"?new Date(e.replace(" ","T")+"Z"):e,o=Date.now();let a=Math.floor((o-t.getTime())/1e3);const s=new Intl.RelativeTimeFormat("en",{numeric:"auto"});if(a<60)return s.format(-a,"second");const f=Math.floor(a/60);if(f<60)return s.format(-f,"minute");const c=Math.floor(f/60);if(c<24)return s.format(-c,"hour");const p=Math.floor(c/24);if(p<30)return s.format(-p,"day");const i=Math.floor(p/30);if(i<12)return s.format(-i,"month");const v=Math.floor(i/12);return s.format(-v,"year")}function G(e){return m({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"},child:[]}]})(e)}function de(e){const t=x.useRef(null),{user:o}=j(),{setEditPostModePointer:a}=k(),s=C(),{mutate:f}=S(),{data:c}=M(A(o&&o.userId||"")),p=!!c?.some(u=>u.postId===e.post.postId),{mutate:i}=F();function v(u){t.current&&!t.current.contains(u.target)&&e.setShowMenu(!1)}return x.useEffect(()=>(document.addEventListener("click",v),()=>document.removeEventListener("click",v)),[]),r.jsxs("div",{ref:t,className:"absolute top-12 right-2 py-2 px-5 rounded bg-[#222222] shadow-[0_0_15px_rgba(0,0,0,0.7)] z-40",children:[o&&e.post.userId===o.userId&&r.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[r.jsx(G,{size:20,className:"pt-1"}),r.jsx("div",{onClick:()=>{a(e.post.postId),s({to:`/posts/${e.post.postId}`}),e.setShowMenu(!1)},className:"ml-2",children:"Edit"})]}),p?r.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[r.jsx(q,{size:20,className:"pt-1"}),r.jsx("div",{onClick:u=>{if(u.stopPropagation(),u.preventDefault(),!o)return s({to:"/login"});i({userId:o.userId||"",postId:e.post.postId},{onSuccess:()=>e.setShowMenu(!1)})},className:"ml-2",children:"Remove from saved"})]}):r.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[r.jsx(B,{size:20,className:"pt-1"}),r.jsx("div",{onClick:u=>{if(u.stopPropagation(),u.preventDefault(),!o)return s({to:"/login"});f({userId:o.userId||"",postId:e.post.postId},{onSuccess:()=>e.setShowMenu(!1)})},className:"ml-2",children:"Save"})]}),o&&e.post.userId===o.userId&&r.jsxs("div",{onClick:u=>{u.stopPropagation(),u.preventDefault(),e.setDeleteMode(!0),e.setShowMenu(!1)},className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[r.jsx(N,{size:20,className:"pt-1 "}),r.jsx("div",{className:"ml-2",children:"Delete"})]})]})}export{G as F,de as M,ae as P,le as V,ce as a,te as b,ee as c,Y as d,re as e,ie as f,se as g,ue as h,ne as i,H as j,Z as k,O as l,_ as m,U as n,W as o,oe as u};
