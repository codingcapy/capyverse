import{r as i,u as H,a as J,m as K,b as w,j as e,L as x,d as b,I as de,v as ce,w as me,x as ue,y as xe,k as he}from"./index-Bf8L_6SI.js";import{e as X,u as fe,f as pe,d as T,h as ge,M as je,V as ve}from"./Menu-BfzMbXt2.js";import{g as Y}from"./users-BzvMrJL5.js";import{C as be,a as ye}from"./CommentMenu-DZvC7qKx.js";import{a as Z}from"./index-BGurCco9.js";import{c as Ne,d as Ce,e as Ie}from"./images-JgUdHNRE.js";import{p as Pe}from"./purify.es-A66Cw1IH.js";import{P as we}from"./PostContentInput-Cbi_p_VF.js";function ee(t){const[d,h]=i.useState(!1),{user:c}=H(),[f,o]=i.useState(""),{mutate:S,isPending:y}=X(),u=J(),[N,E]=i.useState(!1),[p,g]=i.useState(!1),{mutate:L,isPending:j}=fe(),{editCommentModePointer:R,setEditCommentModePointer:C}=K(),{mutate:M,isPending:I}=pe(),{data:a,isLoading:k,error:P}=w(Y(t.comment.userId));function $(s){if(s.preventDefault(),!c)return u({to:"/login"});c.userId,S({postId:t.post.postId,parentCommentId:t.comment.commentId,level:t.comment.level+1,content:f},{onSuccess:()=>{o(""),h(!1)}})}function D(s){if(s.preventDefault(),!c)return u({to:"/login"});M({commentId:t.comment.commentId,content:f},{onSuccess:()=>{C(0),o("")}})}return e.jsxs("div",{className:"relative my-3 flex w-full",children:[!k||!P?a?e.jsx(x,{to:"/u/$username",params:{username:a.username.toString()},children:e.jsx("img",{src:a.profilePic?a.profilePic:b,alt:"",className:"absolute top-0 left-0 w-8 h-8 rounded-full object-cover object-center "})}):e.jsx("img",{src:b,alt:"",className:"absolute top-0 left-0 w-8 h-8 rounded-full"}):e.jsx("img",{src:b,alt:"",className:"absolute top-0 left-0 w-8 h-8 rounded-full"}),e.jsxs("div",{className:"ml-4 pl-5 border-l border-[#555555] w-full",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[k?e.jsx("div",{children:"Loading..."}):P?e.jsx("div",{children:"Unknown author"}):a?e.jsx(x,{to:"/u/$username",params:{username:a.username.toString()},className:"font-bold hover:text-cyan-500 transition-all ease-in-out duration-300",children:a.username}):e.jsx("div",{children:"Unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:T(t.comment.createdAt)})]}),R===t.comment.commentId?e.jsxs("form",{onSubmit:D,className:"pl-5 py-2 my-5 rounded-2xl border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300",children:[e.jsx("input",{type:"text",placeholder:"Add your reply",className:"outline-none w-full",value:f,onChange:s=>o(s.target.value),required:!0}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:s=>{s.stopPropagation(),C(0)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:I,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:I?"Saving...":"Save Edits"})]})]}):e.jsx("div",{children:t.comment.content}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"mr-3",children:e.jsx(be,{comment:t.comment})}),e.jsxs("div",{onClick:()=>{c||u({to:"/login"}),o(""),h(!0)},className:"flex ml-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx(de,{size:22}),e.jsx("div",{className:"ml-2",children:"Reply"})]}),c&&t.comment.userId===c.userId&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{onClick:s=>{s.preventDefault(),s.stopPropagation(),E(!N)},className:"ml-3 px-2 pt-1.5 rounded-full hover:text-cyan-700 transition-all ease-in-out duration-300 cursor-pointer",children:e.jsx(Z,{})}),N&&e.jsx(ye,{comment:t.comment,setDeleteMode:g,setShowMenu:E,setCommentContent:o})]})]}),d&&e.jsxs("form",{onSubmit:$,className:`pl-5 py-2 my-5 ${d?"rounded-2xl":"rounded-full"} border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300`,children:[e.jsx("input",{type:"text",placeholder:"Add your reply",className:"outline-none w-full",value:f,onChange:s=>o(s.target.value),required:!0}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:s=>{s.stopPropagation(),h(!1)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:y,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:y?"Creating...":"Comment"})]})]}),p&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Comment?"}),e.jsx("div",{className:"my-5",children:"Once you delete this comment, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),!j&&(L({commentId:t.comment.commentId}),g(!1))},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:j?"Deleting...":"DELETE"}),e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),g(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"}),t.comment.children?.map(s=>e.jsx(ee,{comment:s,post:t.post},s.commentId))]})]},t.comment.commentId)}function Re(){const t=ce.useRouteContext(),{user:d}=H(),{data:h,isLoading:c,error:f}=w(ge(t.postId)),{data:o,isLoading:S,error:y}=w(Y(t.userId)),[u,N]=i.useState(""),{mutate:E,isPending:p}=X(),g=J(),[L,j]=i.useState(!1),R=re(h&&h||[]),[C,M]=i.useState(!1),[I,a]=i.useState(!1),{mutate:k,isPending:P}=me(),{editPostModePointer:$,setEditPostModePointer:D}=K(),{mutate:s,isPending:Q}=ue(),[O,q]=i.useState(t.content),V=xe(),{data:r,isLoading:te,error:ne}=w(Ne(t.postId)),[B,U]=i.useState(0),se=r&&r[B],[Se,F]=i.useState(""),{data:v,isLoading:oe,error:ae}=w({...he(t.communityId),enabled:!!t.communityId});function re(n,A){const _=new Map;for(const l of n)_.set(l.commentId,{...l,children:[]});const z=[];for(const l of n){const m=_.get(l.commentId);if(l.parentCommentId==null){z.push(m);continue}const G=_.get(l.parentCommentId);if(!G){z.push(m);continue}G.children.push(m)}const ie=(l,m)=>l.createdAt.getTime()-m.createdAt.getTime();function W(l){l.sort(ie);for(const m of l)m.children.length&&W(m.children)}return W(z),z}function le(n){if(n.preventDefault(),!p){if(u.length>1e4)return F("Comment content length max character limit is 10,000");if(!d)return g({to:"/login"});d.userId,E({postId:t.postId,content:u},{onSuccess:()=>{N(""),j(!1)}})}}return e.jsxs("div",{className:"pt-[88px] pb-[140px] px-2 md:px-0 mx-auto w-full md:w-[50%] 2xl:w-[40%]",children:[e.jsxs("div",{className:"relative flex justify-between",children:[oe?e.jsx("div",{children:"Loading..."}):ae?e.jsx("div",{children:"Error loading community"}):v?e.jsx("div",{children:e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx(x,{to:"/c/$communityId",params:{communityId:v.communityId.toString()},children:e.jsx("img",{src:v.icon?v.icon:b,alt:"",className:"w-8 h-8 rounded-full object-cover object-center"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex",children:[e.jsx(x,{to:"/c/$communityId",params:{communityId:v.communityId.toString()},children:e.jsxs("div",{className:"font-bold ml-2 hover:text-cyan-500 transition-all ease-in-out duration-300",children:["c/",v.communityId]})}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:T(t.createdAt)})]}),S?e.jsx("div",{className:"ml-2",children:"Loading..."}):y?e.jsx("div",{children:"Error loading author"}):o?e.jsx(x,{to:"/u/$username",params:{username:o.username.toString()},children:e.jsx("div",{className:"ml-2 hover:text-cyan-500 transition-all ease-in-out duration-300",children:o.username})}):e.jsx("div",{className:"ml-2",children:"unknown author"})]})]})}):S?e.jsx("div",{className:"ml-2",children:"Loading..."}):y?e.jsx("div",{children:"Error loading author"}):o?e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx(x,{to:"/u/$username",params:{username:o.username.toString()},children:e.jsx("img",{src:o.profilePic?o.profilePic:b,alt:"",className:"w-8 h-8 rounded-full object-cover object-center"})}),e.jsx(x,{to:"/u/$username",params:{username:o.username.toString()},children:e.jsxs("div",{className:"font-bold ml-2 hover:text-cyan-500 transition-all ease-in-out duration-300",children:["u/",o.username]})}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:T(t.createdAt)})]}):e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:b,alt:"",className:"w-8 h-8 rounded-full object-cover object-center"}),e.jsx("div",{className:"font-bold ml-2 hover:text-cyan-500 transition-all ease-in-out duration-300",children:"unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:T(t.createdAt)})]}),e.jsx("div",{className:"",children:e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),M(!C)},className:" absolute top-1 right-1 p-3 rounded-full hover:bg-[#575757] transition-all ease-in-out duration-300",children:e.jsx(Z,{})})}),C&&e.jsx(je,{post:t,setDeleteMode:a,setShowMenu:M})]}),e.jsxs("div",{className:"text-xl md:text-3xl font-semibold",children:[" ",t.title]}),e.jsx("div",{children:ne?e.jsx("div",{className:"w-full h-auto md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:"Error loading images"}):te?e.jsx("div",{className:"w-full h-auto md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:"Loading..."}):r?r.length>0?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center mt-1",children:[r.length>1&&e.jsx("button",{type:"button",onClick:()=>U(n=>n===0?r.length-1:n-1),className:"absolute left-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:e.jsx(Ce,{})}),se&&e.jsx("div",{className:"w-full h-[220px] sm:h-[300px] md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:e.jsx("img",{src:`https://${r[B].imageUrl}`,className:"w-full h-full object-contain"})}),r.length>1&&e.jsx("button",{type:"button",onClick:()=>U(n=>n===r.length-1?0:n+1),className:"absolute right-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:e.jsx(Ie,{})}),e.jsx("div",{className:"absolute bottom-2 flex gap-1",children:r.length>1&&r.map((n,A)=>e.jsx("button",{type:"button",onClick:()=>U(A),className:`w-2 h-2 rounded-full ${A===B?"bg-cyan-400":"bg-zinc-500"}`},A))})]}):e.jsx("div",{className:"mt-2 md:mt-5"}):e.jsx("div",{className:"mt-2 md:mt-5"})}),$===t.postId?e.jsxs("div",{children:[e.jsx(we,{content:O,onChange:n=>q(n),contentPlaceholder:"Content (optional)"}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),D(0)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{onClick:()=>{if(!Q){if(O.length>1e4)return F("Post content length max character limit is 10,000");s({postId:t.postId,content:O},{onSuccess:()=>{V.invalidate(),D(0)}})}},className:"mx-2 px-2 py-1 rounded-full bg-cyan-700",children:Q?"Saving...":"Save"})]})]}):e.jsx("div",{className:"mb-5",children:e.jsx("div",{className:"",dangerouslySetInnerHTML:{__html:Pe.sanitize(t.content,{ALLOWED_TAGS:["b","i","u","s","strong","em","ul","ol","li","p","a"],ALLOWED_ATTR:["href","target","rel"],FORBID_ATTR:["style"]})}})}),e.jsx(ve,{post:t}),e.jsxs("form",{onClick:()=>{d||g({to:"/login"}),j(!0)},onSubmit:le,className:`pl-5 py-2 my-5 ${L?"rounded-2xl":"rounded-full"} border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300`,children:[e.jsx("input",{type:"text",placeholder:"Join the conversation",value:u,onChange:n=>N(n.target.value),required:!0,className:"outline-none w-full"}),L&&e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),j(!1)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:p,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:p?"Submitting...":"Comment"})]})]}),d&&t.userId===d.userId&&I&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Post?"}),e.jsx("div",{className:"my-5",children:"Once you delete this post, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),!P&&k({postId:t.postId},{onSuccess:()=>{V.invalidate(),a(!1),q("[This post has been deleted by the user]")}})},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:P?"Deleting...":"DELETE"}),e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),a(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]}),d&&t.userId===d.userId&&I&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"}),f?e.jsx("div",{children:"Error loading comments"}):c?e.jsx("div",{children:"Loading..."}):R.map(n=>e.jsx(ee,{comment:n,post:t},n.commentId))]})}export{Re as component};
