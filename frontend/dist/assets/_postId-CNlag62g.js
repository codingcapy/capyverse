import{q as y,c as C,d as w,e as f,u as I,a as g,j as e,G as N,R as b,r as P}from"./index-CqFi3jTp.js";import{u as h,g as E,a as A,b as k,P as S,c as F,e as V,f as D,d as j,V as q}from"./utils-BpKVr7m-.js";import{g as M}from"./users-Chgr9Igq.js";function z(t){return{...t,createdAt:new Date(t.createdAt)}}async function Q(t){const n=await f.api.v0.comments.$post({json:t});if(!n.ok){let c="There was an issue creating your comment :( We'll look into it ASAP!";try{const i=await n.json();i&&typeof i=="object"&&"message"in i&&(c=String(i.message))}catch(i){console.error("Failed to parse error response:",i)}throw new Error(c)}return await n.json()}const R=t=>{const n=C();return w({mutationFn:Q,onSettled:()=>{n.invalidateQueries({queryKey:["comments"]})},onError:d=>{}})};async function B(t){const n=await f.api.v0.comments[":postId"].$get({param:{postId:t.toString()}});if(!n.ok)throw new Error("Error getting comments by id");const{comments:d}=await n.json();return d.map(z)}const O=t=>y({queryKey:["comments",t],queryFn:()=>B(t)});function U(t){const{data:n,isPending:d,isError:c}=h(E(t.comment.commentId)),{mutate:i}=A(),{mutate:l}=k(),{user:o}=I(),x=g();function u(s,r,p,m){s.preventDefault(),s.stopPropagation();const a=n&&n.find(v=>o&&v.userId===o.userId);o&&a?l({voteId:a.voteId,value:m}):o?i({userId:o&&o.userId||"",postId:r.postId,commentId:p.commentId,value:m}):x({to:"/login"})}return e.jsx("div",{children:c?e.jsx("div",{children:"Error fetching votes"}):d?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"flex w-fit rounded-full py-1 justify-center",children:[n.filter(s=>o&&s.userId===o.userId&&s.value===1).length>0?e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),l({voteId:n.find(r=>r.postId===t.post.postId&&o&&r.userId===o.userId&&r.value===1).voteId,value:0})},className:"pr-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(S,{size:20})}):e.jsx("div",{onClick:s=>{u(s,t.post,t.comment,1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(F,{size:20})}),e.jsx("div",{className:"",children:n.filter(s=>s.postId===t.post.postId).reduce((s,r)=>s+r.value,0)}),n.filter(s=>o&&s.userId===o.userId&&s.value===-1).length>0?e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),l({voteId:n.find(r=>r.postId===t.post.postId&&o&&r.userId===o.userId&&r.value===-1).voteId,value:0})},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(V,{size:20})}):e.jsx("div",{onClick:s=>{u(s,t.post,t.comment,-1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(D,{size:20})})]})})}function L(t){return N({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"32",d:"M87.49 380c1.19-4.38-1.44-10.47-3.95-14.86a44.86 44.86 0 0 0-2.54-3.8 199.81 199.81 0 0 1-33-110C47.65 139.09 140.73 48 255.83 48 356.21 48 440 117.54 459.58 209.85a199 199 0 0 1 4.42 41.64c0 112.41-89.49 204.93-204.59 204.93-18.3 0-43-4.6-56.47-8.37s-26.92-8.77-30.39-10.11a31.09 31.09 0 0 0-11.12-2.07 30.71 30.71 0 0 0-12.09 2.43l-67.83 24.48a16 16 0 0 1-4.67 1.22 9.6 9.6 0 0 1-9.57-9.74 15.85 15.85 0 0 1 .6-3.29z"},child:[]}]})(t)}function W(){const t=b.useRouteContext(),{user:n}=I(),{data:d,isPending:c,error:i}=h(O(t.postId)),{data:l,isPending:o,error:x}=h(M(t.userId)),[u,s]=P.useState(""),{mutate:r}=R(),p=g();function m(a){if(a.preventDefault(),!n)return p({to:"/login"});const v=n.userId;r({userId:v,postId:t.postId,content:u},{onSuccess:()=>s("")})}return e.jsxs("div",{className:"p-20 mx-auto w-full lg:w-[50%]",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[o?e.jsx("div",{children:"Loading..."}):x?e.jsx("div",{children:"Error loading author"}):e.jsx("div",{className:"font-bold",children:l.username}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:j(t.createdAt)})]}),e.jsxs("div",{className:"text-4xl font-bold",children:[" ",t.title]}),e.jsx("div",{className:"my-10",children:e.jsx("div",{children:t.content})}),e.jsx(q,{post:t}),e.jsx("form",{onSubmit:m,children:e.jsx("input",{type:"text",placeholder:"Add your reply",className:"px-5 py-2 my-5 rounded-full border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300",value:u,onChange:a=>s(a.target.value),required:!0})}),i?e.jsx("div",{}):c?e.jsx("div",{}):d.map(a=>e.jsxs("div",{className:"my-3",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("div",{className:"font-bold",children:a.username}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:j(t.createdAt)})]}),e.jsx("div",{children:a.content}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"mr-3",children:e.jsx(U,{post:t,comment:a})}),e.jsxs("div",{className:"flex ml-2",children:[e.jsx(L,{size:22}),e.jsx("div",{className:"ml-2",children:"Reply"})]})]})]},a.commentId))]})}export{W as component};
