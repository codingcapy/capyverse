import{D as b,u as L,r as a,b as j,E as I,q as P,f as E,i as k,k as S,j as e,d as R}from"./index-_Ahtfhw7.js";import{b as _}from"./images-DrSheT_K.js";import{P as y}from"./PostThumbnail-TFLLtSe-.js";import{p as M}from"./purify.es-DmHhxxRO.js";import"./index-CiNgjiky.js";import"./users-7rhzvubZ.js";function Q(){const o=b.useRouteContext(),{user:t}=L(),[d,r]=a.useState(!1),[c,u]=a.useState("Popular"),l=a.useRef(null),{data:n,isLoading:m,error:x}=j(I(o.communityId)),{searchContent:i}=P(),{data:p,isLoading:w,error:g}=j(E(t&&t.userId||"")),{mutate:C,isPending:f}=k(),{mutate:N,isPending:h}=S();function v(s){l.current&&!l.current.contains(s.target)&&r(!1)}return a.useEffect(()=>(document.addEventListener("click",v),()=>document.removeEventListener("click",v)),[]),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"mx-auto w-full md:w-[50%] pt-[70px] pb-2",children:[e.jsxs("div",{className:"flex pt-10",children:[e.jsx("div",{className:"pt-5",children:e.jsx("img",{src:R,alt:"",className:"rounded-full w-[100px] h-[100px]"})}),e.jsxs("div",{className:"text-4xl font-bold pt-20 ml-2",children:["c/",o.communityId]})]}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{ref:l,className:"relative mx-auto w-full 2xl:w-[750px] flex pt-5",children:[e.jsxs("div",{onClick:()=>r(!d),className:"flex cursor-pointer pl-4 md:pl-0 md:pt-1 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx("div",{className:"text-xs",children:c}),e.jsx("div",{className:"ml-2",children:e.jsx(_,{})})]}),d&&e.jsxs("div",{onClick:()=>{},className:"absolute top-12 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[e.jsx("div",{onClick:()=>{u("Popular"),r(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),e.jsx("div",{onClick:()=>{u("New"),r(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]}),w?e.jsx("div",{children:"Loading..."}):g?e.jsx("div",{children:"Error loading communities"}):p?p.some(s=>s.communityId===o.communityId)?e.jsx("div",{onClick:()=>{h||N({communityId:o&&o.communityId||"",userId:t&&t.userId||""})},className:"px-5 py-3 rounded-full border cursor-pointer hover:bg-[#333333] transition-all ease-in-out duration-300",children:h?"Leaving...":"Joined"}):e.jsx("div",{onClick:()=>{f||C({communityId:o&&o.communityId||"",userId:t&&t.userId||""})},className:"px-5 py-3 rounded-full bg-cyan-700 cursor-pointer hover:bg-cyan-500 transition-all ease-in-out duration-300",children:f?"Joining...":"Join"}):e.jsx("div",{})]})]}),c==="Popular"?e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsx("div",{children:m?e.jsx("div",{className:"mx-auto w-full md:w-[50%] 2xl:w-[750px] border-t border-[#636363]",children:"Loading..."}):x?e.jsx("div",{className:"mx-auto w-full md:w-[50%] 2xl:w-[750px] border-t border-[#636363]",children:"Error fetching posts"}):n?n.length>0?n.filter(s=>i===""||s.title.toLowerCase().includes(i.toLowerCase())||s.content.toLowerCase().includes(i.toLowerCase())).map(s=>e.jsx(y,{post:s},s.postId)):e.jsx("div",{className:"mx-auto w-full md:w-[50%] 2xl:w-[750px] border-t border-[#636363]"}):e.jsx("div",{className:"mx-auto w-full md:w-[50%] 2xl:w-[750px] border-t border-[#636363]"})}),e.jsxs("aside",{className:"hidden 2xl:block sticky top-[110px] h-[calc(100vh-150px)] w-[300px] ml-5 custom-scrollbar bg-[#111111] rounded-xl py-2 overflow-y-auto",children:[e.jsx("div",{className:"my-3 px-5 font-bold",children:o.communityId}),e.jsx("div",{className:"px-5 line-clamp-4",dangerouslySetInnerHTML:{__html:M.sanitize(o.description,{ALLOWED_TAGS:["b","i","u","s","strong","em","ul","ol","li","p","a"],ALLOWED_ATTR:["href","target","rel"],FORBID_ATTR:["style"]})}})]})]}):e.jsx("div",{children:m?e.jsx("div",{children:"Loading..."}):x?e.jsx("div",{children:"Error fetching posts"}):n?n.filter(s=>i===""||s.title.toLowerCase().includes(i.toLowerCase())||s.content.toLowerCase().includes(i.toLowerCase())).map(s=>e.jsx(y,{post:s},s.postId)):e.jsx("div",{})})]})})}export{Q as component};
