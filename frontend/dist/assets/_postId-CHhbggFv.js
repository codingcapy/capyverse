import{r as l,u as Q,c as U,a as _,j as e,F as le,f as re,I as de,R as ie,e as ce,h as me,i as ue}from"./index-GLINFU8r.js";import{u as y,F as K,d as xe}from"./images-C3FtBcbP.js";import{F as fe,u as W,e as he,f as pe,d as j,a as X,c as ge,M as ve,h as je,i as be,V as Ce}from"./Menu-BHD2Vb-J.js";import{g as q}from"./users-CpS4MD1J.js";import{C as Ne}from"./CommentVotesComponent-BDGP1DAG.js";function ye(t){const o=l.useRef(null),{user:r}=Q(),{setEditCommentModePointer:c}=U();_();function m(a){o.current&&!o.current.contains(a.target)&&t.setShowMenu(!1)}return l.useEffect(()=>(document.addEventListener("click",m),()=>document.removeEventListener("click",m)),[]),e.jsxs("div",{ref:o,className:"absolute top-12 right-2 py-2 px-5 rounded bg-[#222222] shadow-[0_0_15px_rgba(0,0,0,0.7)] z-40",children:[r&&t.comment.userId===r.userId&&e.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[e.jsx(fe,{size:20,className:"pt-1"}),e.jsx("div",{onClick:()=>{c(t.comment.commentId),t.setCommentContent(t.comment.content||""),t.setShowMenu(!1)},className:"ml-2",children:"Edit"})]}),e.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[e.jsx(le,{size:20,className:"pt-1"}),e.jsx("div",{className:"ml-2",children:"Save"})]}),r&&t.comment.userId===r.userId&&e.jsxs("div",{onClick:a=>{a.stopPropagation(),a.preventDefault(),t.setDeleteMode(!0),t.setShowMenu(!1)},className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[e.jsx(re,{size:20,className:"pt-1 "}),e.jsx("div",{className:"ml-2",children:"Delete"})]})]})}function Y(t){const[o,r]=l.useState(!1),{user:c}=Q(),[m,a]=l.useState(""),{mutate:L,isPending:I}=W(),f=_(),[b,P]=l.useState(!1),[h,p]=l.useState(!1),{mutate:w,isPending:g}=he(),{editCommentModePointer:z,setEditCommentModePointer:C}=U(),{mutate:S,isPending:N}=pe(),{data:x,isLoading:R,error:M}=y(q(t.comment.userId));function A(s){if(s.preventDefault(),!c)return f({to:"/login"});const k=c.userId;L({userId:k,postId:t.post.postId,parentCommentId:t.comment.commentId,level:t.comment.level+1,content:m},{onSuccess:()=>{a(""),r(!1)}})}function E(s){if(s.preventDefault(),!c)return f({to:"/login"});S({commentId:t.comment.commentId,content:m},{onSuccess:()=>{C(0),a("")}})}return e.jsxs("div",{className:"relative my-3 flex",children:[e.jsx("img",{src:!R||!M?x?x.profilePic?x.profilePic:j:j:j,alt:"",className:"absolute top-0 left-0 w-8 h-8 rounded-full"}),e.jsxs("div",{className:"ml-4 pl-5 border-l border-[#555555]",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("div",{className:"font-bold",children:t.comment.username}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:X(t.post.createdAt)})]}),z===t.comment.commentId?e.jsxs("form",{onSubmit:E,className:"pl-5 py-2 my-5 rounded-2xl border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300",children:[e.jsx("input",{type:"text",placeholder:"Add your reply",className:"outline-none w-full",value:m,onChange:s=>a(s.target.value),required:!0}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:s=>{s.stopPropagation(),C(0)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:N,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:N?"Saving...":"Save Edits"})]})]}):e.jsx("div",{children:t.comment.content}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"mr-3",children:e.jsx(Ne,{comment:t.comment})}),e.jsxs("div",{onClick:()=>{c||f({to:"/login"}),a(""),r(!0)},className:"flex ml-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx(de,{size:22}),e.jsx("div",{className:"ml-2",children:"Reply"})]}),c&&t.comment.userId===c.userId&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{onClick:s=>{s.preventDefault(),s.stopPropagation(),P(!b)},className:"ml-3 px-2 pt-1.5 rounded-full hover:text-cyan-700 transition-all ease-in-out duration-300 cursor-pointer",children:e.jsx(K,{})}),b&&e.jsx(ye,{comment:t.comment,setDeleteMode:p,setShowMenu:P,setCommentContent:a})]})]}),o&&e.jsxs("form",{onSubmit:A,className:`pl-5 py-2 my-5 ${o?"rounded-2xl":"rounded-full"} border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300`,children:[e.jsx("input",{type:"text",placeholder:"Add your reply",className:"outline-none w-full",value:m,onChange:s=>a(s.target.value),required:!0}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:s=>{s.stopPropagation(),r(!1)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:I,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:I?"Creating...":"Comment"})]})]}),h&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Comment?"}),e.jsx("div",{className:"my-5",children:"Once you delete this comment, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),!g&&(w({commentId:t.comment.commentId}),p(!1))},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:g?"Deleting...":"DELETE"}),e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),p(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"}),t.comment.children?.map(s=>e.jsx(Y,{comment:s,post:t.post},s.commentId))]})]},t.comment.commentId)}function Ee(){const t=ie.useRouteContext(),{user:o}=Q(),{data:r,isLoading:c,error:m}=y(ge(t.postId)),{data:a,isLoading:L,error:I}=y(q(t.userId)),[f,b]=l.useState(""),{mutate:P,isPending:h}=W(),p=_(),[w,g]=l.useState(!1),z=se(r&&r||[]),[C,S]=l.useState(!1),[N,x]=l.useState(!1),{mutate:R,isPending:M}=ce(),{editPostModePointer:A,setEditPostModePointer:E}=U(),{mutate:s,isPending:k}=me(),[$,V]=l.useState(t.content),J=ue(),{data:T,isLoading:Z}=y(q(t.userId)),{data:d,isLoading:ee,error:te}=y(xe(t.postId)),[F,O]=l.useState(0),ne=d&&d[F];function se(n,v){const B=new Map;for(const i of n)B.set(i.commentId,{...i,children:[]});const D=[];for(const i of n){const u=B.get(i.commentId);if(i.parentCommentId==null){D.push(u);continue}const H=B.get(i.parentCommentId);if(!H){D.push(u);continue}H.children.push(u)}const ae=(i,u)=>i.createdAt.getTime()-u.createdAt.getTime();function G(i){i.sort(ae);for(const u of i)u.children.length&&G(u.children)}return G(D),D}function oe(n){if(n.preventDefault(),h)return;if(!o)return p({to:"/login"});const v=o.userId;P({userId:v,postId:t.postId,content:f},{onSuccess:()=>{b(""),g(!1)}})}return e.jsxs("div",{className:"pt-[88px] px-2 md:px-0 mx-auto w-full md:w-[50%] 2xl:w-[40%]",children:[e.jsxs("div",{className:"relative flex justify-between",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:Z?j:T?T.profilePic?T.profilePic:j:j,alt:"",className:"w-8 h-8 rounded-full"}),L?e.jsx("div",{className:"ml-2",children:"Loading..."}):I?e.jsx("div",{children:"Error loading author"}):a?e.jsx("div",{className:"font-bold ml-2",children:a.username}):e.jsx("div",{className:"ml-2",children:"unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:X(t.createdAt)})]}),e.jsx("div",{className:"",children:e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),S(!C)},className:" absolute top-1 right-1 p-3 rounded-full hover:bg-[#575757] transition-all ease-in-out duration-300",children:e.jsx(K,{})})}),C&&e.jsx(ve,{post:t,setDeleteMode:x,setShowMenu:S})]}),e.jsxs("div",{className:"text-xl md:text-3xl font-semibold",children:[" ",t.title]}),e.jsx("div",{children:te?e.jsx("div",{className:"w-full h-auto md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:"Error loading images"}):ee?e.jsx("div",{className:"w-full h-auto md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:"Loading..."}):d?d.length>0?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center mt-1",children:[d.length>1&&e.jsx("button",{type:"button",onClick:()=>O(n=>n===0?d.length-1:n-1),className:"absolute left-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:e.jsx(je,{})}),ne&&e.jsx("div",{className:"w-full h-[220px] sm:h-[300px] md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:e.jsx("img",{src:`https://${d[F].imageUrl}`,className:"w-full h-full object-contain"})}),d.length>1&&e.jsx("button",{type:"button",onClick:()=>O(n=>n===d.length-1?0:n+1),className:"absolute right-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:e.jsx(be,{})}),e.jsx("div",{className:"absolute bottom-2 flex gap-1",children:d.length>1&&d.map((n,v)=>e.jsx("button",{type:"button",onClick:()=>O(v),className:`w-2 h-2 rounded-full ${v===F?"bg-cyan-400":"bg-zinc-500"}`},v))})]}):e.jsx("div",{className:"mt-2 md:mt-5"}):e.jsx("div",{className:"mt-2 md:mt-5"})}),A===t.postId?e.jsxs("div",{children:[e.jsx("textarea",{name:"content",id:"content",required:!0,className:"p-2 border border-[#c4c4c4] rounded my-2 w-full h-[300px]",placeholder:"content",value:$,onChange:n=>V(n.target.value)}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),E(0)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{onClick:()=>{k||s({postId:t.postId,content:$},{onSuccess:()=>{J.invalidate(),E(0)}})},className:"mx-2 px-2 py-1 rounded-full bg-cyan-700",children:k?"Saving...":"Save"})]})]}):e.jsx("div",{className:"mb-5",children:e.jsx("div",{children:t.content})}),e.jsx(Ce,{post:t}),e.jsxs("form",{onClick:()=>{o||p({to:"/login"}),g(!0)},onSubmit:oe,className:`pl-5 py-2 my-5 ${w?"rounded-2xl":"rounded-full"} border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300`,children:[e.jsx("input",{type:"text",placeholder:"Join the conversation",value:f,onChange:n=>b(n.target.value),required:!0,className:"outline-none w-full"}),w&&e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),g(!1)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:h,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:h?"Submitting...":"Comment"})]})]}),o&&t.userId===o.userId&&N&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Post?"}),e.jsx("div",{className:"my-5",children:"Once you delete this post, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),!M&&R({postId:t.postId},{onSuccess:()=>{J.invalidate(),x(!1),V("[This post has been deleted by the user]")}})},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:M?"Deleting...":"DELETE"}),e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),x(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]}),o&&t.userId===o.userId&&N&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"}),m?e.jsx("div",{children:"Error loading comments"}):c?e.jsx("div",{children:"Loading..."}):z.map(n=>e.jsx(Y,{comment:n,post:t},n.commentId))]})}export{Ee as component};
