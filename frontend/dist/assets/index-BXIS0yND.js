import{Q as b,l as p,m as w,n as y,o as L,b as m,j as e,d as f,L as C,p as E,q as v,r as x,s as I,t as R}from"./index-DADqQpbt.js";import{b as k}from"./images-B2PBCai7.js";import{P}from"./PostThumbnail-BfUZL-hX.js";import{g as M}from"./users-DuaLJVWU.js";import{a as O,b as S,d as Q}from"./purify.es-D4nRr7vx.js";import"./index-BQac3lS8.js";var B=class extends b{constructor(s,r){super(s,r)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:p()})}getOptimisticResult(s){return s.behavior=p(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,r){const{state:i}=s,o=super.createResult(s,r),{isFetching:n,isRefetching:l,isError:d,isRefetchError:u}=o,c=i.fetchMeta?.fetchMore?.direction,t=d&&c==="forward",a=n&&c==="forward",h=d&&c==="backward",g=n&&c==="backward";return{...o,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:y(r,i.data),hasPreviousPage:w(r,i.data),isFetchNextPageError:t,isFetchingNextPage:a,isFetchPreviousPageError:h,isFetchingPreviousPage:g,isRefetchError:u&&!t&&!h,isRefetching:l&&!a&&!g}}};function N(s,r){return L(s,B)}function F(s){const{data:r,isLoading:i,error:o}=m(M(s.post.userId)),{data:n,isLoading:l,error:d}=m(O(s.post.postId)),{data:u,isLoading:c,isError:t}=m(S(s.post.postId));return e.jsxs("div",{className:"px-5 border-b border-[#222222] py-3",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:!i||o?r?r.profilePic?r.profilePic:f:f:f,alt:"",className:"w-6 h-6 rounded-full"}),i?e.jsx("div",{children:"Loading..."}):o?e.jsx("div",{children:"Unknown author"}):r?e.jsx("div",{className:"font-bold ml-2",children:r.username}):e.jsx("div",{children:"Unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:Q(s.post.createdAt)})]}),e.jsx(C,{to:"/posts/$postId",params:{postId:s.post.postId.toString()},className:"font-bold hover:underline",children:e.jsx("div",{className:"my-2",children:s.post.title})}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"text-sm mr-2",children:[c?"Loading...":t?"error":u!==void 0?u.filter(a=>a.commentId===null).reduce((a,h)=>a+h.value,0):"error"," ","votes"]}),e.jsxs("div",{className:"text-sm",children:[l?"Loading...":d?"error":n," ","comments"]})]})]})}function j(){const{data:s,isLoading:r,error:i}=m(E());return e.jsx("aside",{className:"hidden 2xl:block sticky top-[110px] h-[calc(100vh-150px)] w-[300px] ml-5 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"bg-[#111111] rounded-xl pt-2 overflow-y-auto",children:[e.jsx("div",{className:"my-3 px-5",children:"RECENT POSTS"}),r?e.jsx("div",{className:"px-5 border-b border-[#222222] py-3",children:"Loading..."}):i?e.jsx("div",{className:"px-5 border-b border-[#222222] py-3",children:"Error fetching recent posts"}):s?s.map(o=>e.jsx(F,{post:o},o.postId)):e.jsx("div",{})]})})}function q(){const{searchContent:s}=v(),r=x.useRef(null),{data:i,fetchNextPage:o,hasNextPage:n,isFetchingNextPage:l,isPending:d,error:u}=N({queryKey:["new-posts"],queryFn:I,initialPageParam:null,getNextPageParam:t=>t.nextCursor}),c=i?.pages.flatMap(t=>t.posts)??[];return x.useEffect(()=>{if(!r.current||!n)return;const t=new IntersectionObserver(([a])=>{a.isIntersecting&&o()},{rootMargin:"200px"});return t.observe(r.current),()=>t.disconnect()},[o,n,c.length]),u?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):d?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{children:[c.filter(t=>s===""||t.title.toLowerCase().includes(s.toLowerCase())||t.content.toLowerCase().includes(s.toLowerCase())).map(t=>e.jsx(P,{post:t},t.postId)),e.jsx("div",{ref:r,style:{height:"40px",background:"#444444"}}),l&&e.jsx("div",{children:"Loading more…"}),!n&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(j,{})]})}function T(){const{searchContent:s}=v(),r=x.useRef(null),{data:i,fetchNextPage:o,hasNextPage:n,isFetchingNextPage:l,isPending:d,error:u}=N({queryKey:["popular-posts"],queryFn:R,initialPageParam:null,getNextPageParam:t=>t.nextCursor}),c=i?.pages.flatMap(t=>t.posts)??[];return x.useEffect(()=>{if(!r.current||!n)return;const t=new IntersectionObserver(([a])=>{console.log({isIntersecting:a.isIntersecting,boundingClientRect:a.boundingClientRect,rootBounds:a.rootBounds}),a.isIntersecting&&o()});return t.observe(r.current),()=>t.disconnect()},[o,n]),u?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):d?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{children:[c.filter(t=>s===""||t.title.toLowerCase().includes(s.toLowerCase())||t.content.toLowerCase().includes(s.toLowerCase())).map(t=>e.jsx(P,{post:t},t.postId)),e.jsx("div",{ref:r,className:"h-10 bg-[#444444]"}),l&&e.jsx("div",{children:"Loading more…"}),!n&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(j,{})]})}function $(){const[s,r]=x.useState(!1),[i,o]=x.useState("Popular"),n=x.useRef(null);function l(d){n.current&&!n.current.contains(d.target)&&r(!1)}return x.useEffect(()=>(document.addEventListener("click",l),()=>document.removeEventListener("click",l)),[]),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"mx-auto w-full md:w-[50%] pt-[70px] pb-5 ",children:e.jsxs("div",{ref:n,className:"relative mx-auto w-full 2xl:w-[750px] flex",children:[e.jsxs("div",{onClick:()=>r(!s),className:"flex cursor-pointer pl-4 md:pl-0 md:pt-1 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx("div",{className:"text-xs",children:i}),e.jsx("div",{className:"ml-2",children:e.jsx(k,{})})]}),s&&e.jsxs("div",{onClick:()=>{},className:"absolute top-6 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[e.jsx("div",{onClick:()=>{o("Popular"),r(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),e.jsx("div",{onClick:()=>{o("New"),r(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]})}),i==="Popular"?e.jsx(T,{}):e.jsx(q,{})]})})}export{$ as component};
