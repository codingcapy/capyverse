import{j as e,m as f,r as c,z as w,A as b,B as I,u as L,b as k,f as R,i as E,k as M,a as S,d as B}from"./index-BkgZ5UPI.js";import{b as _}from"./images-Cb4lmE2L.js";import{u as v}from"./useInfiniteQuery-CVqK-uyQ.js";import{P as j}from"./PostThumbnail-D_XNGjHI.js";import{p as A}from"./purify.es-CWMwwQsy.js";import"./index-DICEMsxv.js";import"./users-Dd4m1Ql8.js";function N(t){return e.jsxs("aside",{className:"hidden 2xl:block sticky top-[110px] h-[calc(100vh-150px)] w-[300px] ml-5 custom-scrollbar bg-[#111111] rounded-xl py-2 overflow-y-auto",children:[e.jsx("div",{className:"my-3 px-5 font-bold",children:t.community.communityId}),e.jsx("div",{className:"px-5 line-clamp-4",dangerouslySetInnerHTML:{__html:A.sanitize(t.community.description,{ALLOWED_TAGS:["b","i","u","s","strong","em","ul","ol","li","p","a"],ALLOWED_ATTR:["href","target","rel"],FORBID_ATTR:["style"]})}})]})}function O(t){const{searchContent:n}=f(),o=c.useRef(null),{data:r,fetchNextPage:a,hasNextPage:i,isFetchingNextPage:u,isPending:x,error:m}=v({queryKey:["community-posts",t.community.communityId],queryFn:w,initialPageParam:null,getNextPageParam:s=>s.nextCursor}),d=r?.pages.flatMap(s=>s.posts)??[];return c.useEffect(()=>{if(!o.current||!i)return;const s=new IntersectionObserver(([l])=>{l.isIntersecting&&a()},{rootMargin:"200px"});return s.observe(o.current),()=>s.disconnect()},[a,i,d.length]),m?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):x?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{className:"2xl:min-w-[750px]",children:[d.filter(s=>n===""||s.title.toLowerCase().includes(n.toLowerCase())||s.content.toLowerCase().includes(n.toLowerCase())).map(s=>e.jsx(j,{post:s},s.postId)),e.jsx("div",{ref:o,style:{height:"40px",background:"#444444"}}),u&&e.jsx("div",{children:"Loading more…"}),!i&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(N,{community:t.community})]})}function T(t){const{searchContent:n}=f(),o=c.useRef(null),{data:r,fetchNextPage:a,hasNextPage:i,isFetchingNextPage:u,isPending:x,error:m}=v({queryKey:["community-popular-posts",t.community.communityId],queryFn:b,initialPageParam:null,getNextPageParam:s=>s.nextCursor}),d=r?.pages.flatMap(s=>s.posts)??[];return c.useEffect(()=>{if(!o.current||!i)return;const s=new IntersectionObserver(([l])=>{console.log({isIntersecting:l.isIntersecting,boundingClientRect:l.boundingClientRect,rootBounds:l.rootBounds}),l.isIntersecting&&a()});return s.observe(o.current),()=>s.disconnect()},[a,i]),m?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):x?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{className:"2xl:min-w-[750px]",children:[d.filter(s=>n===""||s.title.toLowerCase().includes(n.toLowerCase())||s.content.toLowerCase().includes(n.toLowerCase())).map(s=>e.jsx(j,{post:s},s.postId)),e.jsx("div",{ref:o,className:"h-10 bg-[#444444]"}),u&&e.jsx("div",{children:"Loading more…"}),!i&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(N,{community:t.community})]})}function W(){const t=I.useRouteContext(),{user:n}=L(),[o,r]=c.useState(!1),[a,i]=c.useState("Popular"),u=c.useRef(null),{searchContent:x}=f(),{data:m,isLoading:d,error:s}=k(R(n&&n.userId||"")),{mutate:l,isPending:g}=E(),{mutate:C,isPending:h}=M(),P=S();function y(p){u.current&&!u.current.contains(p.target)&&r(!1)}return c.useEffect(()=>(document.addEventListener("click",y),()=>document.removeEventListener("click",y)),[]),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"mx-auto w-full md:w-[50%] pt-[70px] pb-2",children:[e.jsxs("div",{className:"flex pt-10",children:[e.jsx("div",{className:"pt-5",children:e.jsx("img",{src:B,alt:"",className:"rounded-full w-[100px] h-[100px]"})}),e.jsxs("div",{className:"text-4xl font-bold pt-20 ml-2",children:["c/",t.communityId]})]}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{ref:u,className:"relative mx-auto w-full 2xl:w-[750px] flex pt-5",children:[e.jsxs("div",{onClick:()=>r(!o),className:"flex cursor-pointer pl-4 md:pl-0 md:pt-1 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx("div",{className:"text-xs",children:a}),e.jsx("div",{className:"ml-2",children:e.jsx(_,{})})]}),o&&e.jsxs("div",{onClick:()=>{},className:"absolute top-12 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[e.jsx("div",{onClick:()=>{i("Popular"),r(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),e.jsx("div",{onClick:()=>{i("New"),r(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]}),n?d?e.jsx("div",{children:"Loading..."}):s?e.jsx("div",{children:"Error loading communities"}):m?m.some(p=>p.communityId===t.communityId)?e.jsx("div",{onClick:()=>{h||C({communityId:t&&t.communityId||"",userId:n&&n.userId||""})},className:"px-5 py-3 rounded-full border cursor-pointer hover:bg-[#333333] transition-all ease-in-out duration-300",children:h?"Leaving...":"Joined"}):e.jsx("div",{onClick:()=>{g||l({communityId:t&&t.communityId||"",userId:n&&n.userId||""})},className:"px-5 py-3 rounded-full bg-cyan-700 cursor-pointer hover:bg-cyan-500 transition-all ease-in-out duration-300",children:g?"Joining...":"Join"}):e.jsx("div",{className:"px-5 py-3 rounded-full bg-cyan-700 cursor-pointer hover:bg-cyan-500 transition-all ease-in-out duration-300",children:"Join"}):e.jsx("div",{onClick:()=>P({to:"/login"}),className:"px-5 py-3 rounded-full bg-cyan-700 cursor-pointer hover:bg-cyan-500 transition-all ease-in-out duration-300",children:"Join"})]})]}),a==="Popular"?e.jsx(O,{community:t}):e.jsx(T,{community:t})]})})}export{W as component};
