import{S as p,T as c,U as h,V as w,u as P,a as C,b as I,j as s,W as F,r as S,m as M,X as N,c as V,Y as Q,Z as B,F as K,C as b}from"./index-BRwIHByB.js";import{o as A,p as j,q as U,r as x}from"./images-BsznkbKZ.js";function E(e){return{...e,createdAt:new Date(e.createdAt)}}async function L(e){const t=await c.api.v0.comments.$post({json:e});if(!t.ok){let n="There was an issue creating your comment :( We'll look into it ASAP!";try{const r=await t.json();r&&typeof r=="object"&&"message"in r&&(n=String(r.message))}catch(r){console.error("Failed to parse error response:",r)}throw new Error(n)}return await t.json()}const ne=e=>{const t=h();return w({mutationFn:L,onSettled:()=>{t.invalidateQueries({queryKey:["comments"]})},onError:o=>{}})};async function z(e){const t=await c.api.v0.comments[":postId"].$get({param:{postId:e.toString()}});if(!t.ok)throw new Error("Error getting comments by id");const{comments:o}=await t.json();return o.map(E)}const ae=e=>p({queryKey:["comments",e],queryFn:()=>z(e)});async function $(e){const t=await c.api.v0.comments.comment.delete.$post({json:e});if(!t.ok){let n="There was an issue deleting your post :( We'll look into it ASAP!";throw console.log(e),new Error(n)}return await t.json()}const ie=e=>{const t=h();return w({mutationFn:$,onSettled:(o,n)=>{if(!o)return console.log("No data, returning");t.invalidateQueries({queryKey:["comments",o.commentResult.postId]}),t.invalidateQueries({queryKey:["posts"]})},onError:o=>{}})};async function D(e){const t=await c.api.v0.comments.comment.update.$post({json:e});if(!t.ok){let n="There was an issue updating your post :( We'll look into it ASAP!";throw console.log(e),new Error(n)}return await t.json()}const ue=e=>{const t=h();return w({mutationFn:D,onSettled:(o,n)=>{if(!o)return console.log("No data, returning");t.invalidateQueries({queryKey:["comments",o.commentResult.postId]}),t.invalidateQueries({queryKey:["posts"]})},onError:o=>{}})};async function R(e){const t=await c.api.v0.comments.user[":userId"].$get({param:{userId:e.toString()}});if(!t.ok)throw new Error("Error getting comments by user id");const{comments:o}=await t.json();return o.map(E)}const ce=e=>p({queryKey:["comments",e],queryFn:()=>R(e)});async function O(e){const t=await c.api.v0.comments.post.count[":postId"].$get({param:{postId:e.toString()}});if(!t.ok)throw new Error("Error getting comments by id");const{commentsLength:o}=await t.json();return o}const me=e=>p({queryKey:["comments-length",e],queryFn:()=>O(e)});async function T(e){const t=await c.api.v0.comments.user.comments[":username"].$get({param:{username:e.toString()}});if(!t.ok)throw new Error("Error getting comments by username");const{comments:o}=await t.json();return o.map(E)}const le=e=>p({queryKey:["user-comments",e],queryFn:()=>T(e)});async function W(e){const t=await c.api.v0.votes.$post({json:e});if(!t.ok){let n="There was an issue creating your vote :( We'll look into it ASAP!";try{const r=await t.json();r&&typeof r=="object"&&"message"in r&&(n=String(r.message))}catch(r){console.error("Failed to parse error response:",r)}throw new Error(n)}const o=await t.json();if(!o.vote)throw new Error("Invalid response from server");return o.vote}const _=e=>{const t=h();return w({mutationFn:W,onSuccess:o=>{t.invalidateQueries({queryKey:["user-vote",o.postId,o.userId]}),t.invalidateQueries({queryKey:["votes-summary",o.postId]}),t.invalidateQueries({queryKey:["comment-votes",o.commentId]})},onError:o=>{}})};async function Z(e){const t=await c.api.v0.votes[":postId"].$get({param:{postId:e.toString()}});if(!t.ok)throw new Error("Error getting votes by postId");const{votes:o}=await t.json();return o}const de=e=>p({queryKey:["post-votes",e],queryFn:()=>Z(e)});async function G(e){const t=await c.api.v0.votes.update.$post({json:e});if(!t.ok){let n="There was an issue updating your vote :( We'll look into it ASAP!";throw console.log(e),new Error(n)}const{vote:o}=await t.json();return o}const X=e=>{const t=h();return w({mutationFn:G,onSuccess:o=>{t.invalidateQueries({queryKey:["comment-votes",o.commentId]}),t.invalidateQueries({queryKey:["user-vote",o.postId,o.userId]}),t.invalidateQueries({queryKey:["votes-summary",o.postId]})},onError:o=>{}})};async function Y(e){const t=await c.api.v0.votes.comments[":commentId"].$get({param:{commentId:e.toString()}});if(!t.ok)throw new Error("Error getting comment votes by commentId");const{votes:o}=await t.json();return o}const ye=e=>p({queryKey:["comment-votes",e],queryFn:()=>Y(e)});async function H(e){const t=await c.api.v0.votes.post.summary[":postId"].$get({param:{postId:e.toString()}});if(!t.ok)throw new Error("Error getting votes by postId");return await t.json()}const J=e=>p({queryKey:["votes-summary",e],queryFn:()=>H(e)});async function ee(e,t){const o=await c.api.v0.votes.post.user[":postId"][":userId"].$get({param:{postId:e.toString(),userId:t.toString()}});if(!o.ok)throw new Error("Error getting user vote by postId");return await o.json()}const te=(e,t)=>p({queryKey:["user-vote",e,t],queryFn:()=>ee(e,t)});function pe(e){const{mutate:t,isPending:o}=_(),{mutate:n,isPending:r}=X(),{user:u}=P(),l=C(),{data:y,isLoading:v,error:g}=I(J(e.post.postId)),{data:m,isLoading:f,error:i}=I(te(e.post.postId,u&&u.userId||""));function d(a,q,k){if(a.preventDefault(),a.stopPropagation(),!(o||r)){if(!u){l({to:"/login"});return}m&&m.voted?n({voteId:m.voteId,value:k}):u?t({userId:u&&u.userId||"",postId:q.postId,value:k}):l({to:"/login"})}}return s.jsx("div",{children:s.jsxs("div",{className:"flex bg-[#3e3e3e] w-fit rounded-full py-1 justify-center",children:[u?f?s.jsx(s.Fragment,{children:"Loading..."}):i?s.jsx(s.Fragment,{children:"Error loading user vote"}):m?m.value===1?s.jsx("div",{onClick:a=>{d(a,e.post,0)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:r?"Updating...":s.jsx(A,{size:20})}):s.jsx("div",{onClick:a=>{d(a,e.post,1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:s.jsx(j,{size:20})}):s.jsx("div",{onClick:a=>{d(a,e.post,1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:o?"Voting...":s.jsx(j,{size:20})}):s.jsx("div",{onClick:a=>{d(a,e.post,1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:o?"Voting...":s.jsx(j,{size:20})}),s.jsx("div",{className:"font-semibold",children:v?s.jsx("div",{children:"Loading..."}):g?s.jsx("div",{children:"Error loading votes"}):y?y.score:0}),u?f?s.jsx(s.Fragment,{children:"Loading..."}):i?s.jsx(s.Fragment,{children:"Error loading user vote"}):m?m.value===-1?s.jsx("div",{onClick:a=>{d(a,e.post,0)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:r?"Updating...":s.jsx(U,{size:20})}):m.value===0?s.jsx("div",{onClick:a=>{d(a,e.post,-1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:r?"Updating...":s.jsx(x,{size:20})}):s.jsx("div",{onClick:a=>{d(a,e.post,-1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:r?"Updating...":s.jsx(x,{size:20})}):s.jsx("div",{onClick:a=>{d(a,e.post,-1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:o?"Voting...":s.jsx(x,{size:20})}):s.jsx("div",{onClick:a=>{d(a,e.post,-1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:o?"Voting...":s.jsx(x,{size:20})})]})})}function ve(e){const t=typeof e=="string"?new Date(e.replace(" ","T")+"Z"):e,o=Date.now();let n=Math.floor((o-t.getTime())/1e3);const r=new Intl.RelativeTimeFormat("en",{numeric:"auto"});if(n<60)return r.format(-n,"second");const u=Math.floor(n/60);if(u<60)return r.format(-u,"minute");const l=Math.floor(u/60);if(l<24)return r.format(-l,"hour");const y=Math.floor(l/24);if(y<30)return r.format(-y,"day");const v=Math.floor(y/30);if(v<12)return r.format(-v,"month");const g=Math.floor(v/12);return r.format(-g,"year")}function oe(e){return F({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"},child:[]}]})(e)}function ge(e){const t=S.useRef(null),{user:o}=P(),{setEditPostModePointer:n}=M(),r=C(),{mutate:u,isPending:l}=N(),{data:y}=I(V(o&&o.userId||"")),v=!!y?.some(i=>i.postId===e.post.postId),{mutate:g,isPending:m}=Q();function f(i){t.current&&!t.current.contains(i.target)&&e.setShowMenu(!1)}return S.useEffect(()=>(document.addEventListener("click",f),()=>document.removeEventListener("click",f)),[]),s.jsxs("div",{ref:t,className:"absolute top-12 right-2 py-2 px-5 rounded bg-[#222222] shadow-[0_0_15px_rgba(0,0,0,0.7)] z-40",children:[o&&e.post.userId===o.userId&&s.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[s.jsx(oe,{size:20,className:"pt-1"}),s.jsx("div",{onClick:()=>{n(e.post.postId),r({to:`/posts/${e.post.postId}`}),e.setShowMenu(!1)},className:"ml-2",children:"Edit"})]}),v?s.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[s.jsx(B,{size:20,className:"pt-1"}),s.jsx("div",{onClick:i=>{if(i.stopPropagation(),i.preventDefault(),!o)return r({to:"/login"});m||g({userId:o.userId||"",postId:e.post.postId},{onSuccess:()=>e.setShowMenu(!1)})},className:"ml-2",children:m?"Removing...":"Remove from saved"})]}):s.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[s.jsx(K,{size:20,className:"pt-1"}),s.jsx("div",{onClick:i=>{if(i.stopPropagation(),i.preventDefault(),!o)return r({to:"/login"});l||u({userId:o.userId||"",postId:e.post.postId},{onSuccess:()=>e.setShowMenu(!1)})},className:"ml-2",children:l?"Saving...":"Save"})]}),o&&e.post.userId===o.userId&&s.jsxs("div",{onClick:i=>{i.stopPropagation(),i.preventDefault(),e.setDeleteMode(!0),e.setShowMenu(!1)},className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[s.jsx(b,{size:20,className:"pt-1 "}),s.jsx("div",{className:"ml-2",children:"Delete"})]})]})}export{oe as F,ge as M,pe as V,me as a,de as b,le as c,ve as d,ne as e,ue as f,ce as g,ae as h,ye as i,_ as j,X as k,ie as u};
