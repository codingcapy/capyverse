import{q as g,u as y,a as x,c as m,R as f,b as h,r as j,d as v,j as o}from"./index-DdlBuAOx.js";import{u as C,V as w}from"./VotesComponent-DrUZHImT.js";function b(e){return{...e,createdAt:new Date(e.createdAt)}}async function E(e){console.log(e);const t=await m.api.v0.comments.$post({json:e});if(!t.ok){let s="There was an issue creating your comment :( We'll look into it ASAP!";try{const n=await t.json();n&&typeof n=="object"&&"message"in n&&(s=String(n.message))}catch(n){console.error("Failed to parse error response:",n)}throw new Error(s)}return await t.json()}const q=e=>{const t=y();return x({mutationFn:E,onSettled:()=>{t.invalidateQueries({queryKey:["comments"]})},onError:a=>{}})};async function S(){const e=await m.api.v0.comments.$get();if(!e.ok)throw new Error("Error getting comments");const{comments:t}=await e.json();return t.map(b)}const A=()=>g({queryKey:["comments"],queryFn:()=>S()});function R(){const e=f.useRouteContext(),{user:t}=h(),{data:a,isPending:s,error:n}=C(A()),[c,u]=j.useState(""),{mutate:l}=q(),d=v();function p(r){if(r.preventDefault(),!t)return d({to:"/login"});const i=t.userId;l({userId:i,postId:e.postId,content:c}),console.log(i),console.log(e.postId),console.log(c)}return o.jsxs("div",{className:"p-20 mx-auto w-full lg:w-[50%]",children:[o.jsxs("div",{className:"text-4xl font-bold",children:[" ",e.title]}),o.jsx("div",{className:"my-10",children:o.jsxs("div",{children:[" ",e.content]})}),o.jsx(w,{post:e}),o.jsx("form",{onSubmit:p,children:o.jsx("input",{type:"text",placeholder:"Add your reply",className:"px-5 py-2 my-5 rounded-full border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300",value:c,onChange:r=>u(r.target.value),required:!0})}),n?o.jsx("div",{}):s?o.jsx("div",{}):a.map(r=>o.jsx("div",{children:r.content},r.commentId))]})}export{R as component};
