import{q as v,e as p,f as h,h as c,G as m,u as j,a as E,j as s,r as I,d as M,F as k,i as A}from"./index-CeKz0IzP.js";import{u as P}from"./index-B0yj2ae6.js";function S(e){return{...e,createdAt:new Date(e.createdAt)}}async function F(e){const t=await c.api.v0.votes.$post({json:e});if(!t.ok){let a="There was an issue creating your vote :( We'll look into it ASAP!";try{const r=await t.json();r&&typeof r=="object"&&"message"in r&&(a=String(r.message))}catch(r){console.error("Failed to parse error response:",r)}throw new Error(a)}const o=await t.json();if(!o.vote)throw new Error("Invalid response from server");return o.vote}const V=e=>{const t=p();return h({mutationFn:F,onSettled:()=>{t.invalidateQueries({queryKey:["votes"]})},onError:o=>{}})};async function q(){const e=await c.api.v0.votes.$get();if(!e.ok)throw new Error("Error getting posts");const{votes:t}=await e.json();return t.map(S)}const G=()=>v({queryKey:["votes"],queryFn:()=>q()});async function N(e){const t=await c.api.v0.votes[":postId"].$get({param:{postId:e.toString()}});if(!t.ok)throw new Error("Error getting votes by postId");const{votes:o}=await t.json();return o}const D=e=>v({queryKey:["votes",e],queryFn:()=>N(e)});async function B(e){const t=await c.api.v0.votes.update.$post({json:e});if(!t.ok){let a="There was an issue updating your vote :( We'll look into it ASAP!";throw console.log(e),new Error(a)}return await t.json()}const Q=e=>{const t=p();return h({mutationFn:B,onSettled:(o,a)=>{t.invalidateQueries({queryKey:["votes"]})},onError:o=>{}})};async function b(e){const t=await c.api.v0.votes.comments[":commentId"].$get({param:{commentId:e.toString()}});if(!t.ok)throw new Error("Error getting comment votes by commentId");const{votes:o}=await t.json();return o}const J=e=>v({queryKey:["votes",e],queryFn:()=>b(e)});function X(e){return m({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,104.49l-80,80a12,12,0,0,1-17,0l-80-80a12,12,0,0,1,17-17L128,159l71.51-71.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function H(e){return m({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M229.66,141.66l-96,96a8,8,0,0,1-11.32,0l-96-96A8,8,0,0,1,32,128H72V48A16,16,0,0,1,88,32h80a16,16,0,0,1,16,16v80h40a8,8,0,0,1,5.66,13.66Z"},child:[]}]})(e)}function K(e){return m({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M231.39,123.06A8,8,0,0,1,224,128H184v80a16,16,0,0,1-16,16H88a16,16,0,0,1-16-16V128H32a8,8,0,0,1-5.66-13.66l96-96a8,8,0,0,1,11.32,0l96,96A8,8,0,0,1,231.39,123.06Z"},child:[]}]})(e)}function L(e){return m({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M231.39,132.94A8,8,0,0,0,224,128H184V48a16,16,0,0,0-16-16H88A16,16,0,0,0,72,48v80H32a8,8,0,0,0-5.66,13.66l96,96a8,8,0,0,0,11.32,0l96-96A8,8,0,0,0,231.39,132.94ZM128,220.69,51.31,144H80a8,8,0,0,0,8-8V48h80v88a8,8,0,0,0,8,8h28.69Z"},child:[]}]})(e)}function T(e){return m({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M229.66,114.34l-96-96a8,8,0,0,0-11.32,0l-96,96A8,8,0,0,0,32,128H72v80a16,16,0,0,0,16,16h80a16,16,0,0,0,16-16V128h40a8,8,0,0,0,5.66-13.66ZM176,112a8,8,0,0,0-8,8v88H88V120a8,8,0,0,0-8-8H51.31L128,35.31,204.69,112Z"},child:[]}]})(e)}function Y(e){const{data:t,isLoading:o,isError:a}=P(D(e.post.postId)),{mutate:r,isPending:d}=V(),{mutate:u,isPending:f}=Q(),{user:i}=j(),y=E();function g(n,l,w){if(n.preventDefault(),n.stopPropagation(),d||f)return;const x=t&&t.find(C=>i&&C.userId===i.userId);i&&x?u({voteId:x.voteId,value:w}):i?r({userId:i&&i.userId||"",postId:l.postId,value:w}):y({to:"/login"})}return s.jsx("div",{children:a?s.jsx("div",{children:"Error fetching votes"}):o?s.jsx("div",{children:"Loading..."}):t?s.jsxs("div",{className:"flex bg-[#3e3e3e] w-fit rounded-full py-1 justify-center",children:[t.filter(n=>n.commentId===null&&i&&n.userId===i.userId&&n.value===1).length>0?s.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),u({voteId:t.find(l=>l.commentId===null&&i&&l.userId===i.userId&&l.value===1).voteId,value:0})},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:s.jsx(K,{size:20})}):s.jsx("div",{onClick:n=>{g(n,e.post,1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:s.jsx(T,{size:20})}),s.jsx("div",{className:"font-semibold",children:t.filter(n=>n.commentId===null).reduce((n,l)=>n+l.value,0)}),t.filter(n=>n.commentId===null&&i&&n.userId===i.userId&&n.value===-1).length>0?s.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),u({voteId:t.find(l=>l.commentId===null&&l.postId===e.post.postId&&i&&l.userId===i.userId&&l.value===-1).voteId,value:0})},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:s.jsx(H,{size:20})}):s.jsx("div",{onClick:n=>{g(n,e.post,-1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:s.jsx(L,{size:20})})]}):s.jsx("div",{children:"An unexpected error has occured"})})}function ee(e){const t=typeof e=="string"?new Date(e.replace(" ","T")+"Z"):e,o=Date.now();let a=Math.floor((o-t.getTime())/1e3);const r=new Intl.RelativeTimeFormat("en",{numeric:"auto"});if(a<60)return r.format(-a,"second");const d=Math.floor(a/60);if(d<60)return r.format(-d,"minute");const u=Math.floor(d/60);if(u<24)return r.format(-u,"hour");const f=Math.floor(u/24);if(f<30)return r.format(-f,"day");const i=Math.floor(f/30);if(i<12)return r.format(-i,"month");const y=Math.floor(i/12);return r.format(-y,"year")}function R(e){return m({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"},child:[]}]})(e)}function te(e){const t=I.useRef(null),{user:o}=j(),{setEditPostModePointer:a}=M(),r=E();function d(u){t.current&&!t.current.contains(u.target)&&e.setShowMenu(!1)}return I.useEffect(()=>(document.addEventListener("click",d),()=>document.removeEventListener("click",d)),[]),s.jsxs("div",{ref:t,className:"absolute top-12 right-2 py-2 px-5 rounded bg-[#222222] shadow-[0_0_15px_rgba(0,0,0,0.7)] z-40",children:[o&&e.post.userId===o.userId&&s.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[s.jsx(R,{size:20,className:"pt-1"}),s.jsx("div",{onClick:()=>{a(e.post.postId),r({to:`/posts/${e.post.postId}`}),e.setShowMenu(!1)},className:"ml-2",children:"Edit"})]}),s.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[s.jsx(k,{size:20,className:"pt-1"}),s.jsx("div",{className:"ml-2",children:"Save"})]}),o&&e.post.userId===o.userId&&s.jsxs("div",{onClick:u=>{u.stopPropagation(),u.preventDefault(),e.setDeleteMode(!0),e.setShowMenu(!1)},className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[s.jsx(A,{size:20,className:"pt-1 "}),s.jsx("div",{className:"ml-2",children:"Delete"})]})]})}function $(e){return{...e,createdAt:new Date(e.createdAt)}}async function z(e){const t=await c.api.v0.comments.$post({json:e});if(!t.ok){let a="There was an issue creating your comment :( We'll look into it ASAP!";try{const r=await t.json();r&&typeof r=="object"&&"message"in r&&(a=String(r.message))}catch(r){console.error("Failed to parse error response:",r)}throw new Error(a)}return await t.json()}const oe=e=>{const t=p();return h({mutationFn:z,onSettled:()=>{t.invalidateQueries({queryKey:["comments"]})},onError:o=>{}})};async function Z(e){const t=await c.api.v0.comments[":postId"].$get({param:{postId:e.toString()}});if(!t.ok)throw new Error("Error getting comments by id");const{comments:o}=await t.json();return o.map($)}const re=e=>v({queryKey:["comments",e],queryFn:()=>Z(e)});async function O(e){const t=await c.api.v0.comments.comment.delete.$post({json:e});if(!t.ok){let a="There was an issue deleting your post :( We'll look into it ASAP!";throw console.log(e),new Error(a)}return await t.json()}const ne=e=>{const t=p();return h({mutationFn:O,onSettled:(o,a)=>{if(!o)return console.log("No data, returning");t.invalidateQueries({queryKey:["comments",o.commentResult.postId]}),t.invalidateQueries({queryKey:["posts"]})},onError:o=>{}})};async function W(e){const t=await c.api.v0.comments.comment.update.$post({json:e});if(!t.ok){let a="There was an issue updating your post :( We'll look into it ASAP!";throw console.log(e),new Error(a)}return await t.json()}const se=e=>{const t=p();return h({mutationFn:W,onSettled:(o,a)=>{if(!o)return console.log("No data, returning");t.invalidateQueries({queryKey:["comments",o.commentResult.postId]}),t.invalidateQueries({queryKey:["posts"]})},onError:o=>{}})};export{R as F,te as M,X as P,Y as V,G as a,J as b,Q as c,ee as d,K as e,T as f,re as g,H as h,L as i,oe as j,ne as k,se as l,V as u};
