import{b as p,k as I,j as e,L as m,d as g,l as C,m as v,r as l,n as E,o as S}from"./index-BseA2iSZ.js";import{b as k}from"./images-CwDrouzv.js";import{u as j}from"./useInfiniteQuery-Cty-rTat.js";import{P as N}from"./PostThumbnail-B3sR5mQA.js";import{g as R}from"./users-DUs_MWhr.js";import{a as B,b as M,d as h}from"./Menu-Pwz4TyBn.js";import"./purify.es-A66Cw1IH.js";function O(s){const{data:t,isLoading:a,error:n}=p(R(s.post.userId)),{data:o,isLoading:d,error:c}=p(B(s.post.postId)),{data:u,isLoading:x,isError:r}=p(M(s.post.postId)),{data:i,isLoading:y,error:P}=p({...I(s.post.communityId),enabled:!!s.post.communityId}),w=!!s.post.communityId;return e.jsxs("div",{className:"px-5 border-b border-[#222222] py-3",children:[w?y?e.jsx("div",{children:"Loading..."}):P?e.jsx("div",{children:"Error loading community"}):i?e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx(m,{to:"/c/$communityId",params:{communityId:i.communityId.toString()},children:e.jsx("img",{src:i.icon?i.icon:g,alt:"",className:"w-6 h-6 rounded-full"})}),e.jsx(m,{to:"/c/$communityId",params:{communityId:i.communityId.toString()},children:e.jsxs("div",{className:"font-bold ml-2 hover:underline",children:["c/",i.communityId]})}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:h(s.post.createdAt)})]}):a?e.jsx("div",{children:"Loading..."}):n?e.jsx("div",{children:"Error loading author"}):t?e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx(m,{to:"/u/$username",params:{username:t.username.toString()},children:e.jsx("img",{src:t.profilePic?t.profilePic:g,alt:"",className:"w-6 h-6 rounded-full"})}),e.jsx(m,{to:"/u/$username",params:{username:t.username.toString()},children:e.jsxs("div",{className:"font-bold ml-2 hover:underline",children:["u/",t.username]})}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:h(s.post.createdAt)})]}):e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("div",{children:"Unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:h(s.post.createdAt)})]}):a?e.jsx("div",{children:"Loading..."}):n?e.jsx("div",{children:"Error loading author"}):t?e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx(m,{to:"/u/$username",params:{username:t.username.toString()},children:e.jsx("img",{src:t.profilePic?t.profilePic:g,alt:"",className:"w-6 h-6 rounded-full"})}),e.jsx(m,{to:"/u/$username",params:{username:t.username.toString()},children:e.jsxs("div",{className:"font-bold ml-2 hover:underline",children:["u/",t.username]})}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:h(s.post.createdAt)})]}):e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:g,alt:"",className:"w-6 h-6 rounded-full"}),e.jsx("div",{className:"font-bold ml-2 hover:underline",children:"Unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:h(s.post.createdAt)})]}),e.jsx(m,{to:"/posts/$postId",params:{postId:s.post.postId.toString()},className:"font-bold hover:underline",children:e.jsx("div",{className:"my-2",children:s.post.title})}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"text-sm mr-2",children:[x?"Loading...":r?"error":u!==void 0?u.filter(f=>f.commentId===null).reduce((f,L)=>f+L.value,0):"error"," ","votes"]}),e.jsxs("div",{className:"text-sm",children:[d?"Loading...":c?"error":o," ","comments"]})]})]})}function b(){const{data:s,isLoading:t,error:a}=p(C());return e.jsx("aside",{className:"hidden 2xl:block sticky top-[110px] h-[calc(100vh-150px)] w-[300px] ml-5 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"bg-[#111111] rounded-xl pt-2 overflow-y-auto",children:[e.jsx("div",{className:"my-3 px-5",children:"RECENT POSTS"}),t?e.jsx("div",{className:"px-5 border-b border-[#222222] py-3",children:"Loading..."}):a?e.jsx("div",{className:"px-5 border-b border-[#222222] py-3",children:"Error fetching recent posts"}):s?s.map(n=>e.jsx(O,{post:n},n.postId)):e.jsx("div",{})]})})}function Q(){const{searchContent:s}=v(),t=l.useRef(null),{data:a,fetchNextPage:n,hasNextPage:o,isFetchingNextPage:d,isPending:c,error:u}=j({queryKey:["new-posts"],queryFn:E,initialPageParam:null,getNextPageParam:r=>r.nextCursor}),x=a?.pages.flatMap(r=>r.posts)??[];return l.useEffect(()=>{if(!t.current||!o)return;const r=new IntersectionObserver(([i])=>{i.isIntersecting&&n()},{rootMargin:"200px"});return r.observe(t.current),()=>r.disconnect()},[n,o,x.length]),u?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):c?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{children:[x.filter(r=>s===""||r.title.toLowerCase().includes(s.toLowerCase())||r.content.toLowerCase().includes(s.toLowerCase())).map(r=>e.jsx(N,{post:r},r.postId)),e.jsx("div",{ref:t,style:{height:"40px",background:"#444444"}}),d&&e.jsx("div",{children:"Loading more…"}),!o&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(b,{})]})}function $(){const{searchContent:s}=v(),t=l.useRef(null),{data:a,fetchNextPage:n,hasNextPage:o,isFetchingNextPage:d,isPending:c,error:u}=j({queryKey:["popular-posts"],queryFn:S,initialPageParam:null,getNextPageParam:r=>r.nextCursor}),x=a?.pages.flatMap(r=>r.posts)??[];return l.useEffect(()=>{if(!t.current||!o)return;const r=new IntersectionObserver(([i])=>{console.log({isIntersecting:i.isIntersecting,boundingClientRect:i.boundingClientRect,rootBounds:i.rootBounds}),i.isIntersecting&&n()});return r.observe(t.current),()=>r.disconnect()},[n,o]),u?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):c?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{children:[x.filter(r=>s===""||r.title.toLowerCase().includes(s.toLowerCase())||r.content.toLowerCase().includes(s.toLowerCase())).map(r=>e.jsx(N,{post:r},r.postId)),e.jsx("div",{ref:t,className:"h-10 bg-[#444444]"}),d&&e.jsx("div",{children:"Loading more…"}),!o&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(b,{})]})}function K(){const[s,t]=l.useState(!1),[a,n]=l.useState("Popular"),o=l.useRef(null);function d(c){o.current&&!o.current.contains(c.target)&&t(!1)}return l.useEffect(()=>(document.addEventListener("click",d),()=>document.removeEventListener("click",d)),[]),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"mx-auto w-full md:w-[50%] pt-[70px] pb-5 ",children:e.jsxs("div",{ref:o,className:"relative mx-auto w-full 2xl:w-[750px] flex",children:[e.jsxs("div",{onClick:()=>t(!s),className:"flex cursor-pointer pl-4 md:pl-0 md:pt-1 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx("div",{className:"text-xs",children:a}),e.jsx("div",{className:"ml-2",children:e.jsx(k,{})})]}),s&&e.jsxs("div",{onClick:()=>{},className:"absolute top-6 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[e.jsx("div",{onClick:()=>{n("Popular"),t(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),e.jsx("div",{onClick:()=>{n("New"),t(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]})}),a==="Popular"?e.jsx($,{}):e.jsx(Q,{})]})})}export{K as component};
