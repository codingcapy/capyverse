import{i as p,h as m,d as v,e as P,j as e,f as w,r as d,k as N}from"./index-DfjHtLQL.js";import{P as j}from"./Menu-BfPgoUpJ.js";import{Q as b,d as C,u as R}from"./images-3kISNutm.js";import{P as f}from"./PostThumbnail-CSi5q6LG.js";import"./users-BMBWcj8H.js";var y=class extends b{constructor(t,s){super(t,s)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t){super.setOptions({...t,behavior:p()})}getOptimisticResult(t){return t.behavior=p(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,s){const{state:n}=t,i=super.createResult(t,s),{isFetching:r,isRefetching:c,isError:l,isRefetchError:h}=i,u=n.fetchMeta?.fetchMore?.direction,o=l&&u==="forward",a=r&&u==="forward",x=l&&u==="backward",g=r&&u==="backward";return{...i,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:v(s,n.data),hasPreviousPage:m(s,n.data),isFetchNextPageError:o,isFetchingNextPage:a,isFetchPreviousPageError:x,isFetchingPreviousPage:g,isRefetchError:h&&!o&&!x,isRefetching:c&&!a&&!g}}};function E(t,s){return C(t,y)}function L(){const{data:t,isPending:s,error:n}=R(w()),{searchContent:i}=P();return e.jsx("div",{children:n?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):s?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):t?t.map(r=>i===""?e.jsx(f,{post:r},r.postId):r.title.toLowerCase().includes(i.toLowerCase())||r.content.toLowerCase().includes(i.toLowerCase())?e.jsx(f,{post:r},r.postId):""):e.jsx("div",{children:"No posts! Be the first to create one."})})}function M(){const{searchContent:t}=P(),s=d.useRef(null),{data:n,fetchNextPage:i,hasNextPage:r,isFetchingNextPage:c,isPending:l,error:h}=E({queryKey:["popular-posts"],queryFn:N,initialPageParam:null,getNextPageParam:o=>o.nextCursor}),u=n?.pages.flatMap(o=>o.posts)??[];return d.useEffect(()=>{if(!s.current||!r)return;const o=new IntersectionObserver(([a])=>{console.log({isIntersecting:a.isIntersecting,boundingClientRect:a.boundingClientRect,rootBounds:a.rootBounds}),a.isIntersecting&&i()});return o.observe(s.current),()=>o.disconnect()},[i,r]),h?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):l?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{children:[u.filter(o=>t===""||o.title.toLowerCase().includes(t.toLowerCase())||o.content.toLowerCase().includes(t.toLowerCase())).map(o=>e.jsx(f,{post:o},o.postId)),e.jsx("div",{ref:s}),c&&e.jsx("div",{children:"Loading moreâ€¦"}),!r&&e.jsx("div",{children:"No more posts"})]})}function S(){const[t,s]=d.useState(!1),[n,i]=d.useState("Popular"),r=d.useRef(null);function c(l){r.current&&!r.current.contains(l.target)&&s(!1)}return d.useEffect(()=>(document.addEventListener("click",c),()=>document.removeEventListener("click",c)),[]),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"mx-auto w-full md:w-[50%] pt-[70px] pb-5 ",children:e.jsxs("div",{ref:r,className:"relative mx-auto w-full 2xl:w-[750px] flex",children:[e.jsxs("div",{onClick:()=>s(!t),className:"flex cursor-pointer pl-4 md:pl-0 md:pt-1 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx("div",{className:"text-xs",children:n}),e.jsx("div",{className:"ml-2",children:e.jsx(j,{})})]}),t&&e.jsxs("div",{onClick:()=>{},className:"absolute top-6 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[e.jsx("div",{onClick:()=>{i("Popular"),s(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),e.jsx("div",{onClick:()=>{i("New"),s(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]})}),n==="Popular"?e.jsx(M,{}):e.jsx(L,{})]})})}export{S as component};
