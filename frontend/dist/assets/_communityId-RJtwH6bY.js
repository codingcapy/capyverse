import{l as f,r as c,y as w,j as e,z as b,A as I,u as L,b as k,f as E,i as M,k as R,a as S,d as B}from"./index-lSTVWf8_.js";import{b as J}from"./images-CbpMhSlH.js";import{u as y,S as j}from"./Sidebar-RPA6xxpl.js";import{P as N}from"./PostThumbnail-CVmW7hfa.js";import"./users-ChSwiFH4.js";import"./purify.es-Cwp3xoKe.js";import"./index-Cv-hzv7k.js";function q(n){const{searchContent:t}=f(),o=c.useRef(null),{data:r,fetchNextPage:a,hasNextPage:i,isFetchingNextPage:u,isPending:x,error:d}=y({queryKey:["community-posts",n.community.communityId],queryFn:w,initialPageParam:null,getNextPageParam:s=>s.nextCursor}),m=r?.pages.flatMap(s=>s.posts)??[];return c.useEffect(()=>{if(!o.current||!i)return;const s=new IntersectionObserver(([l])=>{l.isIntersecting&&a()},{rootMargin:"200px"});return s.observe(o.current),()=>s.disconnect()},[a,i,m.length]),d?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):x?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{className:"2xl:min-w-[750px]",children:[m.filter(s=>t===""||s.title.toLowerCase().includes(t.toLowerCase())||s.content.toLowerCase().includes(t.toLowerCase())).map(s=>e.jsx(N,{post:s},s.postId)),e.jsx("div",{ref:o,style:{height:"40px",background:"#444444"}}),u&&e.jsx("div",{children:"Loading more…"}),!i&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(j,{})]})}function F(n){const{searchContent:t}=f(),o=c.useRef(null),{data:r,fetchNextPage:a,hasNextPage:i,isFetchingNextPage:u,isPending:x,error:d}=y({queryKey:["community-popular-posts",n.community.communityId],queryFn:b,initialPageParam:null,getNextPageParam:s=>s.nextCursor}),m=r?.pages.flatMap(s=>s.posts)??[];return c.useEffect(()=>{if(!o.current||!i)return;const s=new IntersectionObserver(([l])=>{console.log({isIntersecting:l.isIntersecting,boundingClientRect:l.boundingClientRect,rootBounds:l.rootBounds}),l.isIntersecting&&a()});return s.observe(o.current),()=>s.disconnect()},[a,i]),d?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):x?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{className:"2xl:min-w-[750px]",children:[m.filter(s=>t===""||s.title.toLowerCase().includes(t.toLowerCase())||s.content.toLowerCase().includes(t.toLowerCase())).map(s=>e.jsx(N,{post:s},s.postId)),e.jsx("div",{ref:o,className:"h-10 bg-[#444444]"}),u&&e.jsx("div",{children:"Loading more…"}),!i&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(j,{})]})}function T(){const n=I.useRouteContext(),{user:t}=L(),[o,r]=c.useState(!1),[a,i]=c.useState("Popular"),u=c.useRef(null),{searchContent:x}=f(),{data:d,isLoading:m,error:s}=k(E(t&&t.userId||"")),{mutate:l,isPending:g}=M(),{mutate:P,isPending:h}=R(),C=S();function v(p){u.current&&!u.current.contains(p.target)&&r(!1)}return c.useEffect(()=>(document.addEventListener("click",v),()=>document.removeEventListener("click",v)),[]),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"mx-auto w-full md:w-[50%] pt-[70px] pb-2",children:[e.jsxs("div",{className:"flex pt-10",children:[e.jsx("div",{className:"pt-5",children:e.jsx("img",{src:B,alt:"",className:"rounded-full w-[100px] h-[100px]"})}),e.jsxs("div",{className:"text-4xl font-bold pt-20 ml-2",children:["c/",n.communityId]})]}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{ref:u,className:"relative mx-auto w-full 2xl:w-[750px] flex pt-5",children:[e.jsxs("div",{onClick:()=>r(!o),className:"flex cursor-pointer pl-4 md:pl-0 md:pt-1 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx("div",{className:"text-xs",children:a}),e.jsx("div",{className:"ml-2",children:e.jsx(J,{})})]}),o&&e.jsxs("div",{onClick:()=>{},className:"absolute top-12 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[e.jsx("div",{onClick:()=>{i("Popular"),r(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),e.jsx("div",{onClick:()=>{i("New"),r(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]}),t?m?e.jsx("div",{children:"Loading..."}):s?e.jsx("div",{children:"Error loading communities"}):d?d.some(p=>p.communityId===n.communityId)?e.jsx("div",{onClick:()=>{h||P({communityId:n&&n.communityId||"",userId:t&&t.userId||""})},className:"px-5 py-3 rounded-full border cursor-pointer hover:bg-[#333333] transition-all ease-in-out duration-300",children:h?"Leaving...":"Joined"}):e.jsx("div",{onClick:()=>{g||l({communityId:n&&n.communityId||"",userId:t&&t.userId||""})},className:"px-5 py-3 rounded-full bg-cyan-700 cursor-pointer hover:bg-cyan-500 transition-all ease-in-out duration-300",children:g?"Joining...":"Join"}):e.jsx("div",{className:"px-5 py-3 rounded-full bg-cyan-700 cursor-pointer hover:bg-cyan-500 transition-all ease-in-out duration-300",children:"Join"}):e.jsx("div",{onClick:()=>C({to:"/login"}),className:"px-5 py-3 rounded-full bg-cyan-700 cursor-pointer hover:bg-cyan-500 transition-all ease-in-out duration-300",children:"Join"})]})]}),a==="Popular"?e.jsx(q,{community:n}):e.jsx(F,{community:n})]})})}export{T as component};
