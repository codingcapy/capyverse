import{u as U,c as z,a as C,r,j as e}from"./index-u4sJCFCo.js";import{a as E,u as L,g as O,b as k,c as R}from"./images-CmaUYr2k.js";function Q(){const{user:n}=U(),{mutate:f,isPending:x,error:d}=z(),u=C(),[h,g]=r.useState(""),[b,o]=r.useState(!1),v=r.useRef(null),[l,B]=r.useState(null),{mutate:m,isPending:p}=E(),{data:a,isLoading:j,error:I}=L(O(n&&n.userId||"")),[T,M]=r.useState(""),{mutate:N}=k(),[i,c]=r.useState(0),y=a&&a[i];function P(t){if(t.preventDefault(),!n)return"Error: no logged in user";const s=t.target.titleinput.value,w=t.target.content.value;f({userId:n.userId||"",title:s,content:w},{onSuccess:()=>u({to:"/"}),onError:S=>g(S.toString())}),d&&g(d.toString())}function D(t){if(p)return;const s=t.target.files?.[0];s&&(m({postId:"",userId:n&&n.userId||"",file:s}),t.target.value="")}return r.useEffect(()=>{n||u({to:"/"})},[]),r.useEffect(()=>()=>{l&&URL.revokeObjectURL(l)},[l]),e.jsxs("div",{className:"pt-20 w-[80%] lg:w-[50%] 2xl:w-[30%] mx-auto",children:[e.jsx("div",{className:"text-center font-bold text-cyan-500 text-2xl mb-10",children:"Create Post"}),e.jsxs("form",{onSubmit:P,className:"flex flex-col mx-auto ",children:[e.jsx("input",{type:"text",name:"titleinput",id:"title",required:!0,className:"p-2 border border-[#c4c4c4] rounded-xl bg-[#414141] my-2",placeholder:"Title"}),e.jsxs("div",{onDragEnter:t=>{t.preventDefault(),o(!0)},onDragOver:t=>{t.preventDefault(),o(!0)},onDragLeave:()=>o(!1),onDrop:t=>{if(t.preventDefault(),o(!1),p)return;const s=t.dataTransfer.files?.[0];s&&m({postId:"",userId:n&&n.userId||"",file:s})},className:`my-5 border border-dashed w-full h-[150px] rounded-xl ${b?"bg-[#242424]":""}`,children:[e.jsx("input",{ref:v,type:"file",className:"hidden",accept:"image/png, image/jpeg, image/heic, image/webp"}),e.jsxs("div",{className:"relative w-full h-full",children:[I?e.jsx("div",{children:"Error loading images"}):j?e.jsx("div",{children:"Loading..."}):a?a.length>0?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[a.length>1&&e.jsx("button",{type:"button",onClick:()=>c(t=>t===0?a.length-1:t-1),className:"absolute left-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:"‹"}),y&&e.jsxs("div",{className:"relative",children:[e.jsx(R,{size:20,className:"text-red-400 absolute top-2 right-2 bg-zinc-700 p-[4px] rounded z-10 cursor-pointer",onClick:()=>N({imageId:a[i].imageId})}),e.jsx("img",{src:`https://${a[i].imageUrl}`,className:"max-h-[140px] mx-auto rounded-lg bg-[#3d3d3d] object-contain"})]}),a.length>1&&e.jsx("button",{type:"button",onClick:()=>c(t=>t===a.length-1?0:t+1),className:"absolute right-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:"›"}),e.jsx("div",{className:"absolute bottom-2 flex gap-1",children:a.map((t,s)=>e.jsx("button",{type:"button",onClick:()=>c(s),className:`w-2 h-2 rounded-full ${s===i?"bg-cyan-400":"bg-zinc-500"}`},s))})]}):e.jsx("div",{className:"text-center pt-[60px]",children:"Drag and drop or upload images"}):e.jsx("div",{className:"text-center pt-[60px]",children:"Drag and drop or upload images"}),e.jsx("input",{type:"file",className:"absolute top-0 left-0 w-full h-full py-2 opacity-0 cursor-pointer appearance-none file:hidden",accept:"image/png, image/jpeg, image/heic, image/webp",onChange:D})]})]}),e.jsx("textarea",{name:"content",id:"content",className:"p-2 border border-[#c4c4c4] rounded-xl bg-[#414141] my-2 h-[200px]",placeholder:"Content (optional)"}),e.jsx("button",{className:"bg-cyan-500 px-5 py-2 rounded-full font-bold my-5",children:x?"Loading...":"POST"})]}),e.jsx("div",{children:h})]})}export{Q as component};
