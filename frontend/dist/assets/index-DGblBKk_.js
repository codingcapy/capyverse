import{i as g,h as v,e as w,f as P,r as d,j as t,k as N,l as j}from"./index-NxJvzTzy.js";import{P as b}from"./purify.es-B0IC1zRW.js";import{Q as C,d as y}from"./images-ghC1nprV.js";import{P as p}from"./PostThumbnail-BCX8iheA.js";import"./users-OSPiIUIk.js";var R=class extends C{constructor(s,r){super(s,r)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:g()})}getOptimisticResult(s){return s.behavior=g(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,r){const{state:o}=s,i=super.createResult(s,r),{isFetching:n,isRefetching:l,isError:u,isRefetchError:h}=i,a=o.fetchMeta?.fetchMore?.direction,e=u&&a==="forward",c=n&&a==="forward",f=u&&a==="backward",x=n&&a==="backward";return{...i,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:w(r,o.data),hasPreviousPage:v(r,o.data),isFetchNextPageError:e,isFetchingNextPage:c,isFetchPreviousPageError:f,isFetchingPreviousPage:x,isRefetchError:h&&!e&&!f,isRefetching:l&&!c&&!x}}};function m(s,r){return y(s,R)}function M(){const{searchContent:s}=P(),r=d.useRef(null),{data:o,fetchNextPage:i,hasNextPage:n,isFetchingNextPage:l,isPending:u,error:h}=m({queryKey:["new-posts"],queryFn:N,initialPageParam:null,getNextPageParam:e=>e.nextCursor}),a=o?.pages.flatMap(e=>e.posts)??[];return d.useEffect(()=>{if(!r.current||!n)return;const e=new IntersectionObserver(([c])=>{c.isIntersecting&&i()},{rootMargin:"200px"});return e.observe(r.current),()=>e.disconnect()},[i,n,a.length]),h?t.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):u?t.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):t.jsxs("div",{children:[a.filter(e=>s===""||e.title.toLowerCase().includes(s.toLowerCase())||e.content.toLowerCase().includes(s.toLowerCase())).map(e=>t.jsx(p,{post:e},e.postId)),t.jsx("div",{ref:r,style:{height:"40px",background:"#444444"}}),l&&t.jsx("div",{children:"Loading more…"}),!n&&t.jsx("div",{children:"No more posts"})]})}function E(){const{searchContent:s}=P(),r=d.useRef(null),{data:o,fetchNextPage:i,hasNextPage:n,isFetchingNextPage:l,isPending:u,error:h}=m({queryKey:["popular-posts"],queryFn:j,initialPageParam:null,getNextPageParam:e=>e.nextCursor}),a=o?.pages.flatMap(e=>e.posts)??[];return d.useEffect(()=>{if(!r.current||!n)return;const e=new IntersectionObserver(([c])=>{console.log({isIntersecting:c.isIntersecting,boundingClientRect:c.boundingClientRect,rootBounds:c.rootBounds}),c.isIntersecting&&i()});return e.observe(r.current),()=>e.disconnect()},[i,n]),h?t.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):u?t.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):t.jsxs("div",{children:[a.filter(e=>s===""||e.title.toLowerCase().includes(s.toLowerCase())||e.content.toLowerCase().includes(s.toLowerCase())).map(e=>t.jsx(p,{post:e},e.postId)),t.jsx("div",{ref:r,style:{height:"40px",background:"#444444"}}),l&&t.jsx("div",{children:"Loading more…"}),!n&&t.jsx("div",{children:"No more posts"})]})}function S(){const[s,r]=d.useState(!1),[o,i]=d.useState("Popular"),n=d.useRef(null);function l(u){n.current&&!n.current.contains(u.target)&&r(!1)}return d.useEffect(()=>(document.addEventListener("click",l),()=>document.removeEventListener("click",l)),[]),t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{className:"mx-auto w-full md:w-[50%] pt-[70px] pb-5 ",children:t.jsxs("div",{ref:n,className:"relative mx-auto w-full 2xl:w-[750px] flex",children:[t.jsxs("div",{onClick:()=>r(!s),className:"flex cursor-pointer pl-4 md:pl-0 md:pt-1 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[t.jsx("div",{className:"text-xs",children:o}),t.jsx("div",{className:"ml-2",children:t.jsx(b,{})})]}),s&&t.jsxs("div",{onClick:()=>{},className:"absolute top-6 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[t.jsx("div",{onClick:()=>{i("Popular"),r(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),t.jsx("div",{onClick:()=>{i("New"),r(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]})}),o==="Popular"?t.jsx(E,{}):t.jsx(M,{})]})})}export{S as component};
