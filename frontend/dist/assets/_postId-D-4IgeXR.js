import{r,u as W,a as G,e as H,j as e,I as ae,R as re,l as de,m as ie,n as ce}from"./index-DH8edUD2.js";import{u as I,F as J,e as me}from"./images-oa0gbZYx.js";import{c as K,u as ue,e as xe,d as j,a as X,b as pe,M as fe,f as he,h as ge,p as ve,V as je}from"./purify.es-D1iv5A1_.js";import{g as _}from"./users-D6P2nYId.js";import{C as be,a as Ce}from"./CommentMenu-CuU5OthB.js";import{P as ye}from"./PostContentInput-CbJ4NzaI.js";function Y(t){const[a,u]=r.useState(!1),{user:c}=W(),[x,d]=r.useState(""),{mutate:A,isPending:P}=K(),p=G(),[b,w]=r.useState(!1),[f,h]=r.useState(!1),{mutate:S,isPending:g}=ue(),{editCommentModePointer:z,setEditCommentModePointer:C}=H(),{mutate:M,isPending:y}=xe(),{data:i,isLoading:E,error:N}=I(_(t.comment.userId));function T(s){if(s.preventDefault(),!c)return p({to:"/login"});const D=c.userId;A({userId:D,postId:t.post.postId,parentCommentId:t.comment.commentId,level:t.comment.level+1,content:x},{onSuccess:()=>{d(""),u(!1)}})}function L(s){if(s.preventDefault(),!c)return p({to:"/login"});M({commentId:t.comment.commentId,content:x},{onSuccess:()=>{C(0),d("")}})}return e.jsxs("div",{className:"relative my-3 flex w-full",children:[e.jsx("img",{src:!E||!N?i?i.profilePic?i.profilePic:j:j:j,alt:"",className:"absolute top-0 left-0 w-8 h-8 rounded-full"}),e.jsxs("div",{className:"ml-4 pl-5 border-l border-[#555555] w-full",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[E?e.jsx("div",{children:"Loading..."}):N?e.jsx("div",{children:"Unknown author"}):i?e.jsx("div",{className:"font-bold",children:i.username}):e.jsx("div",{children:"Unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:X(t.post.createdAt)})]}),z===t.comment.commentId?e.jsxs("form",{onSubmit:L,className:"pl-5 py-2 my-5 rounded-2xl border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300",children:[e.jsx("input",{type:"text",placeholder:"Add your reply",className:"outline-none w-full",value:x,onChange:s=>d(s.target.value),required:!0}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:s=>{s.stopPropagation(),C(0)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:y,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:y?"Saving...":"Save Edits"})]})]}):e.jsx("div",{children:t.comment.content}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"mr-3",children:e.jsx(be,{comment:t.comment})}),e.jsxs("div",{onClick:()=>{c||p({to:"/login"}),d(""),u(!0)},className:"flex ml-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx(ae,{size:22}),e.jsx("div",{className:"ml-2",children:"Reply"})]}),c&&t.comment.userId===c.userId&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{onClick:s=>{s.preventDefault(),s.stopPropagation(),w(!b)},className:"ml-3 px-2 pt-1.5 rounded-full hover:text-cyan-700 transition-all ease-in-out duration-300 cursor-pointer",children:e.jsx(J,{})}),b&&e.jsx(Ce,{comment:t.comment,setDeleteMode:h,setShowMenu:w,setCommentContent:d})]})]}),a&&e.jsxs("form",{onSubmit:T,className:`pl-5 py-2 my-5 ${a?"rounded-2xl":"rounded-full"} border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300`,children:[e.jsx("input",{type:"text",placeholder:"Add your reply",className:"outline-none w-full",value:x,onChange:s=>d(s.target.value),required:!0}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:s=>{s.stopPropagation(),u(!1)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:P,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:P?"Creating...":"Comment"})]})]}),f&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Comment?"}),e.jsx("div",{className:"my-5",children:"Once you delete this comment, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),!g&&(S({commentId:t.comment.commentId}),h(!1))},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:g?"Deleting...":"DELETE"}),e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),h(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"}),t.comment.children?.map(s=>e.jsx(Y,{comment:s,post:t.post},s.commentId))]})]},t.comment.commentId)}function Ee(){const t=re.useRouteContext(),{user:a}=W(),{data:u,isLoading:c,error:x}=I(pe(t.postId)),{data:d,isLoading:A,error:P}=I(_(t.userId)),[p,b]=r.useState(""),{mutate:w,isPending:f}=K(),h=G(),[S,g]=r.useState(!1),z=se(u&&u||[]),[C,M]=r.useState(!1),[y,i]=r.useState(!1),{mutate:E,isPending:N}=de(),{editPostModePointer:T,setEditPostModePointer:L}=H(),{mutate:s,isPending:D}=ie(),[Q,$]=r.useState(t.content),q=ce(),{data:R,isLoading:Z}=I(_(t.userId)),{data:o,isLoading:ee,error:te}=I(me(t.postId)),[O,B]=r.useState(0),ne=o&&o[O];function se(n,v){const U=new Map;for(const l of n)U.set(l.commentId,{...l,children:[]});const k=[];for(const l of n){const m=U.get(l.commentId);if(l.parentCommentId==null){k.push(m);continue}const V=U.get(l.parentCommentId);if(!V){k.push(m);continue}V.children.push(m)}const le=(l,m)=>l.createdAt.getTime()-m.createdAt.getTime();function F(l){l.sort(le);for(const m of l)m.children.length&&F(m.children)}return F(k),k}function oe(n){if(n.preventDefault(),f)return;if(!a)return h({to:"/login"});const v=a.userId;w({userId:v,postId:t.postId,content:p},{onSuccess:()=>{b(""),g(!1)}})}return e.jsxs("div",{className:"pt-[88px] px-2 md:px-0 mx-auto w-full md:w-[50%] 2xl:w-[40%]",children:[e.jsxs("div",{className:"relative flex justify-between",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:Z?j:R?R.profilePic?R.profilePic:j:j,alt:"",className:"w-8 h-8 rounded-full"}),A?e.jsx("div",{className:"ml-2",children:"Loading..."}):P?e.jsx("div",{children:"Error loading author"}):d?e.jsx("div",{className:"font-bold ml-2",children:d.username}):e.jsx("div",{className:"ml-2",children:"unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:X(t.createdAt)})]}),e.jsx("div",{className:"",children:e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),M(!C)},className:" absolute top-1 right-1 p-3 rounded-full hover:bg-[#575757] transition-all ease-in-out duration-300",children:e.jsx(J,{})})}),C&&e.jsx(fe,{post:t,setDeleteMode:i,setShowMenu:M})]}),e.jsxs("div",{className:"text-xl md:text-3xl font-semibold",children:[" ",t.title]}),e.jsx("div",{children:te?e.jsx("div",{className:"w-full h-auto md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:"Error loading images"}):ee?e.jsx("div",{className:"w-full h-auto md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:"Loading..."}):o?o.length>0?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center mt-1",children:[o.length>1&&e.jsx("button",{type:"button",onClick:()=>B(n=>n===0?o.length-1:n-1),className:"absolute left-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:e.jsx(he,{})}),ne&&e.jsx("div",{className:"w-full h-[220px] sm:h-[300px] md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:e.jsx("img",{src:`https://${o[O].imageUrl}`,className:"w-full h-full object-contain"})}),o.length>1&&e.jsx("button",{type:"button",onClick:()=>B(n=>n===o.length-1?0:n+1),className:"absolute right-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:e.jsx(ge,{})}),e.jsx("div",{className:"absolute bottom-2 flex gap-1",children:o.length>1&&o.map((n,v)=>e.jsx("button",{type:"button",onClick:()=>B(v),className:`w-2 h-2 rounded-full ${v===O?"bg-cyan-400":"bg-zinc-500"}`},v))})]}):e.jsx("div",{className:"mt-2 md:mt-5"}):e.jsx("div",{className:"mt-2 md:mt-5"})}),T===t.postId?e.jsxs("div",{children:[e.jsx(ye,{content:Q,onChange:n=>$(n)}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),L(0)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{onClick:()=>{D||s({postId:t.postId,content:Q},{onSuccess:()=>{q.invalidate(),L(0)}})},className:"mx-2 px-2 py-1 rounded-full bg-cyan-700",children:D?"Saving...":"Save"})]})]}):e.jsx("div",{className:"mb-5",children:e.jsx("div",{className:"",dangerouslySetInnerHTML:{__html:ve.sanitize(t.content,{ALLOWED_TAGS:["b","i","u","s","strong","em","ul","ol","li","p","a"],ALLOWED_ATTR:["href","target","rel"],FORBID_ATTR:["style"]})}})}),e.jsx(je,{post:t}),e.jsxs("form",{onClick:()=>{a||h({to:"/login"}),g(!0)},onSubmit:oe,className:`pl-5 py-2 my-5 ${S?"rounded-2xl":"rounded-full"} border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300`,children:[e.jsx("input",{type:"text",placeholder:"Join the conversation",value:p,onChange:n=>b(n.target.value),required:!0,className:"outline-none w-full"}),S&&e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),g(!1)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:f,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:f?"Submitting...":"Comment"})]})]}),a&&t.userId===a.userId&&y&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Post?"}),e.jsx("div",{className:"my-5",children:"Once you delete this post, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),!N&&E({postId:t.postId},{onSuccess:()=>{q.invalidate(),i(!1),$("[This post has been deleted by the user]")}})},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:N?"Deleting...":"DELETE"}),e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),i(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]}),a&&t.userId===a.userId&&y&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"}),x?e.jsx("div",{children:"Error loading comments"}):c?e.jsx("div",{children:"Loading..."}):z.map(n=>e.jsx(Y,{comment:n,post:t},n.commentId))]})}export{Ee as component};
