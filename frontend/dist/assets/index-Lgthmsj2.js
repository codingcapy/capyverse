import{l as m,r as a,j as e,m as h,n as v}from"./index-lSTVWf8_.js";import{b as j}from"./images-CbpMhSlH.js";import{u as f,S as p}from"./Sidebar-RPA6xxpl.js";import{P as g}from"./PostThumbnail-CVmW7hfa.js";import"./users-ChSwiFH4.js";import"./purify.es-Cwp3xoKe.js";import"./index-Cv-hzv7k.js";function N(){const{searchContent:n}=m(),t=a.useRef(null),{data:i,fetchNextPage:o,hasNextPage:r,isFetchingNextPage:l,isPending:u,error:x}=f({queryKey:["new-posts"],queryFn:h,initialPageParam:null,getNextPageParam:s=>s.nextCursor}),d=i?.pages.flatMap(s=>s.posts)??[];return a.useEffect(()=>{if(!t.current||!r)return;const s=new IntersectionObserver(([c])=>{c.isIntersecting&&o()},{rootMargin:"200px"});return s.observe(t.current),()=>s.disconnect()},[o,r,d.length]),x?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):u?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{children:[d.filter(s=>n===""||s.title.toLowerCase().includes(n.toLowerCase())||s.content.toLowerCase().includes(n.toLowerCase())).map(s=>e.jsx(g,{post:s},s.postId)),e.jsx("div",{ref:t,style:{height:"40px",background:"#444444"}}),l&&e.jsx("div",{children:"Loading more…"}),!r&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(p,{})]})}function P(){const{searchContent:n}=m(),t=a.useRef(null),{data:i,fetchNextPage:o,hasNextPage:r,isFetchingNextPage:l,isPending:u,error:x}=f({queryKey:["popular-posts"],queryFn:v,initialPageParam:null,getNextPageParam:s=>s.nextCursor}),d=i?.pages.flatMap(s=>s.posts)??[];return a.useEffect(()=>{if(!t.current||!r)return;const s=new IntersectionObserver(([c])=>{console.log({isIntersecting:c.isIntersecting,boundingClientRect:c.boundingClientRect,rootBounds:c.rootBounds}),c.isIntersecting&&o()});return s.observe(t.current),()=>s.disconnect()},[o,r]),x?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):u?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{children:[d.filter(s=>n===""||s.title.toLowerCase().includes(n.toLowerCase())||s.content.toLowerCase().includes(n.toLowerCase())).map(s=>e.jsx(g,{post:s},s.postId)),e.jsx("div",{ref:t,className:"h-10 bg-[#444444]"}),l&&e.jsx("div",{children:"Loading more…"}),!r&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(p,{})]})}function M(){const[n,t]=a.useState(!1),[i,o]=a.useState("Popular"),r=a.useRef(null);function l(u){r.current&&!r.current.contains(u.target)&&t(!1)}return a.useEffect(()=>(document.addEventListener("click",l),()=>document.removeEventListener("click",l)),[]),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"mx-auto w-full md:w-[50%] pt-[70px] pb-5 ",children:e.jsxs("div",{ref:r,className:"relative mx-auto w-full 2xl:w-[750px] flex",children:[e.jsxs("div",{onClick:()=>t(!n),className:"flex cursor-pointer pl-4 md:pl-0 md:pt-1 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx("div",{className:"text-xs",children:i}),e.jsx("div",{className:"ml-2",children:e.jsx(j,{})})]}),n&&e.jsxs("div",{onClick:()=>{},className:"absolute top-6 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[e.jsx("div",{onClick:()=>{o("Popular"),t(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),e.jsx("div",{onClick:()=>{o("New"),t(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]})}),i==="Popular"?e.jsx(P,{}):e.jsx(N,{})]})})}export{M as component};
