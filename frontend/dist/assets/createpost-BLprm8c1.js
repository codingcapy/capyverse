import{u as E,c as U,a as z,r as n,j as e}from"./index-BTJKpMzf.js";import{a as L,u as O,g as k,b as R,c as T}from"./images-CrnoFf0Z.js";import{P as B}from"./PostContentInput-D4wWLrjD.js";function _(){const{user:r}=E(),{mutate:x,isPending:h,error:g}=U(),m=z(),[b,o]=n.useState(""),[v,l]=n.useState(!1),j=n.useRef(null),[u,M]=n.useState(null),{mutate:p,isPending:f}=L(),{data:s,isLoading:I,error:N}=O(k(r&&r.userId||"")),[$,A]=n.useState(""),{mutate:y}=R(),[c,d]=n.useState(0),P=s&&s[c],[i,D]=n.useState("");function S(t){if(t.preventDefault(),!r)return"Error: no logged in user";if(i.length>1e4)return o("Post content length max character limit is 10,000");const a=t.target.titleinput.value;if(a.length>400)return o("Title content length max character limit is 400");x({userId:r.userId||"",title:a,content:i},{onSuccess:()=>m({to:"/"}),onError:C=>o(C.toString())}),g&&o(g.toString())}function w(t){if(f)return;const a=t.target.files?.[0];a&&(p({postId:"",userId:r&&r.userId||"",file:a}),t.target.value="")}return n.useEffect(()=>{r||m({to:"/"})},[]),n.useEffect(()=>()=>{u&&URL.revokeObjectURL(u)},[u]),n.useEffect(()=>console.log(i),[i]),e.jsxs("div",{className:"pt-20 w-[80%] lg:w-[50%] 2xl:w-[30%] mx-auto",children:[e.jsx("div",{className:"text-center font-bold text-cyan-500 text-2xl mb-5",children:"Create Post"}),e.jsxs("form",{onSubmit:S,className:"flex flex-col mx-auto ",children:[e.jsx("input",{type:"text",name:"titleinput",id:"title",required:!0,className:"p-2 border border-[#c4c4c4] rounded-xl bg-[#414141] my-2",placeholder:"Title"}),e.jsxs("div",{onDragEnter:t=>{t.preventDefault(),l(!0)},onDragOver:t=>{t.preventDefault(),l(!0)},onDragLeave:()=>l(!1),onDrop:t=>{if(t.preventDefault(),l(!1),f)return;const a=t.dataTransfer.files?.[0];a&&p({postId:"",userId:r&&r.userId||"",file:a})},className:`my-5 border border-dashed w-full h-[150px] rounded-xl ${v?"bg-[#242424]":""}`,children:[e.jsx("input",{ref:j,type:"file",className:"hidden",accept:"image/png, image/jpeg, image/heic, image/webp"}),e.jsxs("div",{className:"relative w-full h-full",children:[N?e.jsx("div",{children:"Error loading images"}):I?e.jsx("div",{children:"Loading..."}):s?s.length>0?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[s.length>1&&e.jsx("button",{type:"button",onClick:()=>d(t=>t===0?s.length-1:t-1),className:"absolute left-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:"‹"}),P&&e.jsxs("div",{className:"relative",children:[e.jsx(T,{size:20,className:"text-red-400 absolute top-2 right-2 bg-zinc-700 p-[4px] rounded z-10 cursor-pointer",onClick:()=>y({imageId:s[c].imageId})}),e.jsx("img",{src:`https://${s[c].imageUrl}`,className:"max-h-[140px] mx-auto rounded-lg bg-[#3d3d3d] object-contain"})]}),s.length>1&&e.jsx("button",{type:"button",onClick:()=>d(t=>t===s.length-1?0:t+1),className:"absolute right-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:"›"}),e.jsx("div",{className:"absolute bottom-2 flex gap-1",children:s.map((t,a)=>e.jsx("button",{type:"button",onClick:()=>d(a),className:`w-2 h-2 rounded-full ${a===c?"bg-cyan-400":"bg-zinc-500"}`},a))})]}):e.jsx("div",{className:"text-center pt-[60px]",children:"Drag and drop or upload images"}):e.jsx("div",{className:"text-center pt-[60px]",children:"Drag and drop or upload images"}),e.jsx("input",{type:"file",className:"absolute top-0 left-0 w-full h-full py-2 opacity-0 cursor-pointer appearance-none file:hidden",accept:"image/png, image/jpeg, image/heic, image/webp",onChange:w})]})]}),e.jsx(B,{content:i,onChange:t=>D(t)}),e.jsx("button",{className:"bg-cyan-500 px-5 py-2 rounded-full font-bold my-5",children:h?"Loading...":"POST"})]}),e.jsx("div",{children:b})]})}export{_ as component};
