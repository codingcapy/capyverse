import{u as A,a as R,j as e,r as m,d as q,F as re,e as de,I as le,R as ie,c as ce,f as me,h as ue}from"./index-C8cWqiKe.js";import{a as w,d as K,c as xe}from"./index-wNJ3pt-a.js";import{b as fe,u as he,c as pe,e as ve,f as ge,h as je,i as be,F as Ce,j as W,k as Ne,l as Ie,d as X,g as ye,M as Pe,m as we,n as Ee,V as Me}from"./comments-CKhZBP2P.js";import{g as Q}from"./users-CKK6o92o.js";import{d as E}from"./capypaul01-dN7xfBcC.js";function Se(t){const{data:a,isLoading:i,isError:c}=w(fe(t.comment.commentId)),{mutate:u,isPending:l}=he(),{mutate:v,isPending:N}=pe(),{user:r}=A(),g=R();function j(s,d,I,h){if(s.preventDefault(),s.stopPropagation(),l||N)return;const y=a&&a.find(b=>r&&b.userId===r.userId);r&&y?v({voteId:y.voteId,value:h}):r?u({userId:r&&r.userId||"",postId:d.postId,commentId:I.commentId,value:h}):g({to:"/login"})}return e.jsx("div",{children:c?e.jsx("div",{children:"Error fetching votes"}):i?e.jsx("div",{children:"Loading..."}):a?e.jsxs("div",{className:"flex w-fit rounded-full py-1 justify-center",children:[a.filter(s=>r&&s.userId===r.userId&&s.value===1).length>0?e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),v({voteId:a.find(d=>d.postId===t.post.postId&&r&&d.userId===r.userId&&d.value===1).voteId,value:0})},className:"pr-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(ve,{size:20})}):e.jsx("div",{onClick:s=>{j(s,t.post,t.comment,1)},className:"pr-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(ge,{size:20})}),e.jsx("div",{className:"",children:a.filter(s=>s.postId===t.post.postId).reduce((s,d)=>s+d.value,0)}),a.filter(s=>r&&s.userId===r.userId&&s.value===-1).length>0?e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),v({voteId:a.find(d=>d.postId===t.post.postId&&r&&d.userId===r.userId&&d.value===-1).voteId,value:0})},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(je,{size:20})}):e.jsx("div",{onClick:s=>{j(s,t.post,t.comment,-1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(be,{size:20})})]}):e.jsx("div",{children:"An unexpected error has occured"})})}function ke(t){const a=m.useRef(null),{user:i}=A(),{setEditCommentModePointer:c}=q();R();function u(l){a.current&&!a.current.contains(l.target)&&t.setShowMenu(!1)}return m.useEffect(()=>(document.addEventListener("click",u),()=>document.removeEventListener("click",u)),[]),e.jsxs("div",{ref:a,className:"absolute top-12 right-2 py-2 px-5 rounded bg-[#222222] shadow-[0_0_15px_rgba(0,0,0,0.7)] z-40",children:[i&&t.comment.userId===i.userId&&e.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[e.jsx(Ce,{size:20,className:"pt-1"}),e.jsx("div",{onClick:()=>{c(t.comment.commentId),t.setCommentContent(t.comment.content||""),t.setShowMenu(!1)},className:"ml-2",children:"Edit"})]}),e.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[e.jsx(re,{size:20,className:"pt-1"}),e.jsx("div",{className:"ml-2",children:"Save"})]}),i&&t.comment.userId===i.userId&&e.jsxs("div",{onClick:l=>{l.stopPropagation(),l.preventDefault(),t.setDeleteMode(!0),t.setShowMenu(!1)},className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[e.jsx(de,{size:20,className:"pt-1 "}),e.jsx("div",{className:"ml-2",children:"Delete"})]})]})}function Y(t){const[a,i]=m.useState(!1),{user:c}=A(),[u,l]=m.useState(""),{mutate:v,isPending:N}=W(),r=R(),[g,j]=m.useState(!1),[s,d]=m.useState(!1),{mutate:I,isPending:h}=Ne(),{editCommentModePointer:y,setEditCommentModePointer:b}=q(),{mutate:S,isPending:M}=Ie(),{data:C,isLoading:F,error:k}=w(Q(t.comment.userId));function V(o){if(o.preventDefault(),!c)return r({to:"/login"});const L=c.userId;v({userId:L,postId:t.post.postId,parentCommentId:t.comment.commentId,level:t.comment.level+1,content:u},{onSuccess:()=>{l(""),i(!1)}})}function D(o){if(o.preventDefault(),!c)return r({to:"/login"});S({commentId:t.comment.commentId,content:u},{onSuccess:()=>{b(0),l("")}})}return e.jsxs("div",{className:"relative my-3 flex",children:[e.jsx("img",{src:!F||!k?C?C.profilePic?C.profilePic:E:E:E,alt:"",className:"absolute top-0 left-0 w-8 h-8 rounded-full"}),e.jsxs("div",{className:"ml-4 pl-5 border-l border-[#555555]",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("div",{className:"font-bold",children:t.comment.username}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:X(t.post.createdAt)})]}),y===t.comment.commentId?e.jsxs("form",{onSubmit:D,className:"pl-5 py-2 my-5 rounded-2xl border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300",children:[e.jsx("input",{type:"text",placeholder:"Add your reply",className:"outline-none w-full",value:u,onChange:o=>l(o.target.value),required:!0}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:o=>{o.stopPropagation(),b(0)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:M,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:M?"Saving...":"Save Edits"})]})]}):e.jsx("div",{children:t.comment.content}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"mr-3",children:e.jsx(Se,{post:t.post,comment:t.comment})}),e.jsxs("div",{onClick:()=>{c||r({to:"/login"}),l(""),i(!0)},className:"flex ml-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx(le,{size:22}),e.jsx("div",{className:"ml-2",children:"Reply"})]}),c&&t.comment.userId===c.userId&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{onClick:o=>{o.preventDefault(),o.stopPropagation(),j(!g)},className:"ml-3 px-2 pt-1.5 rounded-full hover:text-cyan-700 transition-all ease-in-out duration-300 cursor-pointer",children:e.jsx(K,{})}),g&&e.jsx(ke,{comment:t.comment,setDeleteMode:d,setShowMenu:j,setCommentContent:l})]})]}),a&&e.jsxs("form",{onSubmit:V,className:`pl-5 py-2 my-5 ${a?"rounded-2xl":"rounded-full"} border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300`,children:[e.jsx("input",{type:"text",placeholder:"Add your reply",className:"outline-none w-full",value:u,onChange:o=>l(o.target.value),required:!0}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:o=>{o.stopPropagation(),i(!1)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:N,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:N?"Creating...":"Comment"})]})]}),s&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Comment?"}),e.jsx("div",{className:"my-5",children:"Once you delete this comment, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:o=>{o.stopPropagation(),o.preventDefault(),!h&&(I({commentId:t.comment.commentId}),d(!1))},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:h?"Deleting...":"DELETE"}),e.jsx("div",{onClick:o=>{o.stopPropagation(),o.preventDefault(),d(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"}),t.comment.children?.map(o=>e.jsx(Y,{comment:o,post:t.post},o.commentId))]})]},t.comment.commentId)}function Fe(){const t=ie.useRouteContext(),{user:a}=A(),{data:i,isLoading:c,error:u}=w(ye(t.postId)),{data:l,isLoading:v,error:N}=w(Q(t.userId)),[r,g]=m.useState(""),{mutate:j,isPending:s}=W(),d=R(),[I,h]=m.useState(!1),y=se(i&&i||[]),[b,S]=m.useState(!1),[M,C]=m.useState(!1),{mutate:F,isPending:k}=ce(),{editPostModePointer:V,setEditPostModePointer:D}=q(),{mutate:o,isPending:L}=me(),[_,$]=m.useState(t.content),J=ue(),{data:O,isLoading:Z}=w(Q(t.userId)),{data:x,isLoading:ee,error:te}=w(xe(t.postId)),[T,B]=m.useState(0),ne=x&&x[T];function se(n,P){const U=new Map;for(const f of n)U.set(f.commentId,{...f,children:[]});const z=[];for(const f of n){const p=U.get(f.commentId);if(f.parentCommentId==null){z.push(p);continue}const H=U.get(f.parentCommentId);if(!H){z.push(p);continue}H.children.push(p)}const ae=(f,p)=>f.createdAt.getTime()-p.createdAt.getTime();function G(f){f.sort(ae);for(const p of f)p.children.length&&G(p.children)}return G(z),z}function oe(n){if(n.preventDefault(),s)return;if(!a)return d({to:"/login"});const P=a.userId;j({userId:P,postId:t.postId,content:r},{onSuccess:()=>{g(""),h(!1)}})}return e.jsxs("div",{className:"pt-[88px] px-2 md:px-0 mx-auto w-full md:w-[50%] 2xl:w-[40%]",children:[e.jsxs("div",{className:"relative flex justify-between",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:Z?E:O?O.profilePic?O.profilePic:E:E,alt:"",className:"w-8 h-8 rounded-full"}),v?e.jsx("div",{className:"ml-2",children:"Loading..."}):N?e.jsx("div",{children:"Error loading author"}):l?e.jsx("div",{className:"font-bold ml-2",children:l.username}):e.jsx("div",{className:"ml-2",children:"unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:X(t.createdAt)})]}),e.jsx("div",{className:"",children:e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),S(!b)},className:" absolute top-1 right-1 p-3 rounded-full hover:bg-[#575757] transition-all ease-in-out duration-300",children:e.jsx(K,{})})}),b&&e.jsx(Pe,{post:t,setDeleteMode:C,setShowMenu:S})]}),e.jsxs("div",{className:"text-xl md:text-3xl font-semibold",children:[" ",t.title]}),e.jsx("div",{children:te?e.jsx("div",{className:"w-full h-auto md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:"Error loading images"}):ee?e.jsx("div",{className:"w-full h-auto md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:"Loading..."}):x?x.length>0?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center mt-1",children:[x.length>1&&e.jsx("button",{type:"button",onClick:()=>B(n=>n===0?x.length-1:n-1),className:"absolute left-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:e.jsx(we,{})}),ne&&e.jsx("div",{className:"w-full h-[220px] sm:h-[300px] md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:e.jsx("img",{src:`https://${x[T].imageUrl}`,className:"w-full h-full object-contain"})}),x.length>1&&e.jsx("button",{type:"button",onClick:()=>B(n=>n===x.length-1?0:n+1),className:"absolute right-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:e.jsx(Ee,{})}),e.jsx("div",{className:"absolute bottom-2 flex gap-1",children:x.length>1&&x.map((n,P)=>e.jsx("button",{type:"button",onClick:()=>B(P),className:`w-2 h-2 rounded-full ${P===T?"bg-cyan-400":"bg-zinc-500"}`},P))})]}):e.jsx("div",{className:"mt-2 md:mt-5"}):e.jsx("div",{className:"mt-2 md:mt-5"})}),V===t.postId?e.jsxs("div",{children:[e.jsx("textarea",{name:"content",id:"content",required:!0,className:"p-2 border border-[#c4c4c4] rounded my-2 w-full h-[300px]",placeholder:"content",value:_,onChange:n=>$(n.target.value)}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),D(0)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{onClick:()=>{L||o({postId:t.postId,content:_},{onSuccess:()=>{J.invalidate(),D(0)}})},className:"mx-2 px-2 py-1 rounded-full bg-cyan-700",children:L?"Saving...":"Save"})]})]}):e.jsx("div",{className:"mb-5",children:e.jsx("div",{children:t.content})}),e.jsx(Me,{post:t}),e.jsxs("form",{onClick:()=>{a||d({to:"/login"}),h(!0)},onSubmit:oe,className:`pl-5 py-2 my-5 ${I?"rounded-2xl":"rounded-full"} border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300`,children:[e.jsx("input",{type:"text",placeholder:"Join the conversation",value:r,onChange:n=>g(n.target.value),required:!0,className:"outline-none w-full"}),I&&e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),h(!1)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:s,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:s?"Submitting...":"Comment"})]})]}),a&&t.userId===a.userId&&M&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Post?"}),e.jsx("div",{className:"my-5",children:"Once you delete this post, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),!k&&F({postId:t.postId},{onSuccess:()=>{J.invalidate(),C(!1),$("[This post has been deleted by the user]")}})},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:k?"Deleting...":"DELETE"}),e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),C(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]}),a&&t.userId===a.userId&&M&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"}),u?e.jsx("div",{children:"Error loading comments"}):c?e.jsx("div",{children:"Loading..."}):y.map(n=>e.jsx(Y,{comment:n,post:t},n.commentId))]})}export{Fe as component};
