import{b as m,j as e,d as p,L as N,l as P,m as f,r as c,n as b,o as w}from"./index-f40zsaGT.js";import{b as y}from"./images-BUT50JTi.js";import{u as h}from"./useInfiniteQuery-jxysRIbb.js";import{P as g}from"./PostThumbnail-DMLGzt2D.js";import{g as L}from"./users-yeHq82en.js";import{a as C,b as I,d as E}from"./purify.es-Bbamuf03.js";import"./index-B-2keQcT.js";function k(t){const{data:r,isLoading:a,error:o}=m(L(t.post.userId)),{data:n,isLoading:l,error:d}=m(C(t.post.postId)),{data:u,isLoading:x,isError:s}=m(I(t.post.postId));return e.jsxs("div",{className:"px-5 border-b border-[#222222] py-3",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:!a||o?r?r.profilePic?r.profilePic:p:p:p,alt:"",className:"w-6 h-6 rounded-full"}),a?e.jsx("div",{children:"Loading..."}):o?e.jsx("div",{children:"Unknown author"}):r?e.jsx("div",{className:"font-bold ml-2",children:r.username}):e.jsx("div",{children:"Unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:E(t.post.createdAt)})]}),e.jsx(N,{to:"/posts/$postId",params:{postId:t.post.postId.toString()},className:"font-bold hover:underline",children:e.jsx("div",{className:"my-2",children:t.post.title})}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"text-sm mr-2",children:[x?"Loading...":s?"error":u!==void 0?u.filter(i=>i.commentId===null).reduce((i,j)=>i+j.value,0):"error"," ","votes"]}),e.jsxs("div",{className:"text-sm",children:[l?"Loading...":d?"error":n," ","comments"]})]})]})}function v(){const{data:t,isLoading:r,error:a}=m(P());return e.jsx("aside",{className:"hidden 2xl:block sticky top-[110px] h-[calc(100vh-150px)] w-[300px] ml-5 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"bg-[#111111] rounded-xl pt-2 overflow-y-auto",children:[e.jsx("div",{className:"my-3 px-5",children:"RECENT POSTS"}),r?e.jsx("div",{className:"px-5 border-b border-[#222222] py-3",children:"Loading..."}):a?e.jsx("div",{className:"px-5 border-b border-[#222222] py-3",children:"Error fetching recent posts"}):t?t.map(o=>e.jsx(k,{post:o},o.postId)):e.jsx("div",{})]})})}function S(){const{searchContent:t}=f(),r=c.useRef(null),{data:a,fetchNextPage:o,hasNextPage:n,isFetchingNextPage:l,isPending:d,error:u}=h({queryKey:["new-posts"],queryFn:b,initialPageParam:null,getNextPageParam:s=>s.nextCursor}),x=a?.pages.flatMap(s=>s.posts)??[];return c.useEffect(()=>{if(!r.current||!n)return;const s=new IntersectionObserver(([i])=>{i.isIntersecting&&o()},{rootMargin:"200px"});return s.observe(r.current),()=>s.disconnect()},[o,n,x.length]),u?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):d?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{children:[x.filter(s=>t===""||s.title.toLowerCase().includes(t.toLowerCase())||s.content.toLowerCase().includes(t.toLowerCase())).map(s=>e.jsx(g,{post:s},s.postId)),e.jsx("div",{ref:r,style:{height:"40px",background:"#444444"}}),l&&e.jsx("div",{children:"Loading more…"}),!n&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(v,{})]})}function R(){const{searchContent:t}=f(),r=c.useRef(null),{data:a,fetchNextPage:o,hasNextPage:n,isFetchingNextPage:l,isPending:d,error:u}=h({queryKey:["popular-posts"],queryFn:w,initialPageParam:null,getNextPageParam:s=>s.nextCursor}),x=a?.pages.flatMap(s=>s.posts)??[];return c.useEffect(()=>{if(!r.current||!n)return;const s=new IntersectionObserver(([i])=>{console.log({isIntersecting:i.isIntersecting,boundingClientRect:i.boundingClientRect,rootBounds:i.rootBounds}),i.isIntersecting&&o()});return s.observe(r.current),()=>s.disconnect()},[o,n]),u?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):d?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{children:[x.filter(s=>t===""||s.title.toLowerCase().includes(t.toLowerCase())||s.content.toLowerCase().includes(t.toLowerCase())).map(s=>e.jsx(g,{post:s},s.postId)),e.jsx("div",{ref:r,className:"h-10 bg-[#444444]"}),l&&e.jsx("div",{children:"Loading more…"}),!n&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(v,{})]})}function U(){const[t,r]=c.useState(!1),[a,o]=c.useState("Popular"),n=c.useRef(null);function l(d){n.current&&!n.current.contains(d.target)&&r(!1)}return c.useEffect(()=>(document.addEventListener("click",l),()=>document.removeEventListener("click",l)),[]),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"mx-auto w-full md:w-[50%] pt-[70px] pb-5 ",children:e.jsxs("div",{ref:n,className:"relative mx-auto w-full 2xl:w-[750px] flex",children:[e.jsxs("div",{onClick:()=>r(!t),className:"flex cursor-pointer pl-4 md:pl-0 md:pt-1 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx("div",{className:"text-xs",children:a}),e.jsx("div",{className:"ml-2",children:e.jsx(y,{})})]}),t&&e.jsxs("div",{onClick:()=>{},className:"absolute top-6 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[e.jsx("div",{onClick:()=>{o("Popular"),r(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),e.jsx("div",{onClick:()=>{o("New"),r(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]})}),a==="Popular"?e.jsx(R,{}):e.jsx(S,{})]})})}export{U as component};
