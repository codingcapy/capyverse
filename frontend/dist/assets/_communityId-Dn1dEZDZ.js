import{u as E,b as g,E as M,r as c,G as Q,j as e,m as j,H as T,J as G,K,f as _,p as A,q as W,a as Z,M as V,L as I,d as h,k as X}from"./index-rCe4vFY6.js";import{b as Y}from"./images-M3NSp5mx.js";import{u as k}from"./useInfiniteQuery-DdG45QD0.js";import{P as S}from"./PostThumbnail-D06UP31J.js";import{F as $}from"./Menu-CU0pf1nq.js";import"./users-BCwoSECg.js";import"./purify.es-A66Cw1IH.js";function R(n){const{user:s}=E(),{data:i,isLoading:x,error:o}=g(M(n.community.communityId)),[r,a]=c.useState(!1),[u,m]=c.useState(n.community.description),{mutate:d,isPending:t}=Q();function l(p){p.preventDefault(),!(t||!s)&&d({communityId:n.community.communityId,description:u},{onSuccess:()=>a(!1)})}return e.jsxs("aside",{className:"hidden 2xl:block sticky top-[110px] h-[calc(100vh-150px)] w-[300px] ml-5 custom-scrollbar bg-[#111111] rounded-xl py-2 overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"my-3 px-5 font-bold",children:n.community.communityId}),s?x?e.jsx("div",{children:"Loading..."}):o?e.jsx("div",{children:"Error loading moderators"}):i&&i.some(p=>p.userId===s.userId)?e.jsx("div",{onClick:()=>a(!0),className:"rounded-full m-2.5 p-2 bg-[#333333] hover:text-cyan-500 transition-all ease-in-out duration-300 cursor-pointer",children:e.jsx($,{size:12,className:""})}):"":""]}),r?e.jsxs("form",{onSubmit:l,className:"flex flex-col",children:[e.jsx("textarea",{className:"border border-[#a0a0a0] mx-auto w-[280px] rounded p-2",value:u,onChange:p=>m(p.target.value)}),e.jsxs("div",{className:"m-2 self-end flex text-center",children:[e.jsx("div",{onClick:()=>a(!1),className:"rounded-full w-[75px] bg-[#555555] mr-2 cursor-pointer hover:bg-[#666666] transition-all ease-in-out duration-300",children:"Cancel"}),e.jsx("button",{className:"rounded-full w-[100px] bg-cyan-700 cursor-pointer hover:bg-cyan-500 transition-all ease-in-out duration-300",children:"Edit"})]})]}):e.jsx("div",{className:"px-5 line-clamp-4",children:n.community.description})]})}function ee(n){const{searchContent:s}=j(),i=c.useRef(null),{data:x,fetchNextPage:o,hasNextPage:r,isFetchingNextPage:a,isPending:u,error:m}=k({queryKey:["community-posts",n.community.communityId],queryFn:T,initialPageParam:null,getNextPageParam:t=>t.nextCursor}),d=x?.pages.flatMap(t=>t.posts)??[];return c.useEffect(()=>{if(!i.current||!r)return;const t=new IntersectionObserver(([l])=>{l.isIntersecting&&o()},{rootMargin:"200px"});return t.observe(i.current),()=>t.disconnect()},[o,r,d.length]),m?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):u?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{className:"2xl:min-w-[750px]",children:[d.filter(t=>s===""||t.title.toLowerCase().includes(s.toLowerCase())||t.content.toLowerCase().includes(s.toLowerCase())).map(t=>e.jsx(S,{post:t},t.postId)),e.jsx("div",{ref:i,style:{height:"40px",background:"#444444"}}),a&&e.jsx("div",{children:"Loading moreâ€¦"}),!r&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(R,{community:n.community})]})}function te(n){const{searchContent:s}=j(),i=c.useRef(null),{data:x,fetchNextPage:o,hasNextPage:r,isFetchingNextPage:a,isPending:u,error:m}=k({queryKey:["community-popular-posts",n.community.communityId],queryFn:G,initialPageParam:null,getNextPageParam:t=>t.nextCursor}),d=x?.pages.flatMap(t=>t.posts)??[];return c.useEffect(()=>{if(!i.current||!r)return;const t=new IntersectionObserver(([l])=>{console.log({isIntersecting:l.isIntersecting,boundingClientRect:l.boundingClientRect,rootBounds:l.rootBounds}),l.isIntersecting&&o()});return t.observe(i.current),()=>t.disconnect()},[o,r]),m?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):u?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):e.jsxs("div",{className:"mx-auto flex 2xl:pl-80",children:[e.jsxs("div",{className:"2xl:min-w-[750px]",children:[d.filter(t=>s===""||t.title.toLowerCase().includes(s.toLowerCase())||t.content.toLowerCase().includes(s.toLowerCase())).map(t=>e.jsx(S,{post:t},t.postId)),e.jsx("div",{ref:i,className:"h-10 bg-[#444444]"}),a&&e.jsx("div",{children:"Loading moreâ€¦"}),!r&&e.jsx("div",{className:"text-4xl text-center py-10",children:"No more posts!"})]}),e.jsx(R,{community:n.community})]})}function ce(){const{communityId:n}=K.useParams(),{data:s,isLoading:i,error:x}=g(X(n)),{user:o}=E(),[r,a]=c.useState(!1),[u,m]=c.useState("Popular"),d=c.useRef(null),{searchContent:t}=j(),{data:l,isLoading:p,error:O}=g(_(o&&o.userId||"")),{mutate:B,isPending:N}=A(),{mutate:F,isPending:w}=W(),z=Z(),[C,b]=c.useState(!1),{data:P,isLoading:D,error:J}=g(M(n)),{mutate:U,isPending:q}=V();function L(f){d.current&&!d.current.contains(f.target)&&a(!1)}function H(f){if(q||!s)return;const y=f.target.files?.[0];if(y){if(y.size>1024*1024){alert("File size exceeds 1MB. Please upload a smaller file.");return}const v=new FileReader;v.onloadend=()=>{U({communityId:s.communityId,icon:v.result})},v.readAsDataURL(y)}}return c.useEffect(()=>(document.addEventListener("click",L),()=>document.removeEventListener("click",L)),[]),e.jsx("div",{className:"flex-1",children:i?e.jsx("div",{className:"pt-20 pl-2.5 lg:pl-[300px] text-2xl",children:"Loading..."}):x?e.jsx("div",{className:"flex flex-col min-h-screen",children:e.jsxs("main",{className:"flex-1 p-3",children:[e.jsx("p",{className:"text-xl md:text-4xl text-center pt-20 md:pt-32",children:"Whoops! This isn't what you're looking for ðŸ˜…"}),e.jsx("p",{className:"mt-5 text-center",children:"Check the spelling of the community name. If it's correct, the community might have been removed or suspended."}),e.jsx("div",{className:"flex flex-col my-10 md:my-20 mx-auto w-[250px]",children:e.jsx(I,{to:"/",className:"py-2 px-10 rounded bg-cyan-500 text-center tracking-widest hover:bg-cyan-300 hover:text-[#202020] transition-all ease-in-out duration-300 text-white secondary-font font-bold",children:"LET'S GO HOME"})})]})}):s?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"mx-auto w-full md:w-[50%] pt-[70px] pb-2",children:[e.jsxs("div",{className:"flex pt-10",children:[e.jsx("div",{className:"pt-5",children:o?D?e.jsx("div",{children:"Loading..."}):J?e.jsx("div",{children:"Error loading moderators"}):P?P.some(f=>f.userId===o.userId)?e.jsxs("div",{className:"relative cursor-pointer",onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),children:[e.jsx("img",{src:s.icon?s.icon:h,alt:"",className:"rounded-full w-[100px] h-[100px]"}),C&&e.jsx("svg",{width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"absolute top-[35px] left-9 z-1 cursor-pointer",children:e.jsx("path",{d:"M15.1113 9.89062C16.3766 11.9078 18.0945 13.614 20.1357 14.8662L10.5352 24.4688C10.2695 24.7344 10.1358 24.8668 9.97266 24.9541C9.8095 25.0414 9.62514 25.0787 9.25684 25.1523L4.20898 26.1621C4.00121 26.2037 3.89701 26.2242 3.83789 26.165C3.77902 26.1059 3.80027 26.0016 3.8418 25.7939L4.85059 20.7461C4.92427 20.3777 4.96149 20.1935 5.04883 20.0303C5.13616 19.8671 5.26951 19.7344 5.53516 19.4688L15.1113 9.89062ZM21.249 4.27148C21.7668 4.27148 22.1842 4.68815 23.0176 5.52148L24.4814 6.98633C25.3148 7.81966 25.7314 8.23614 25.7314 8.75391C25.7314 9.27166 25.3148 9.68816 24.4814 10.5215L21.0479 13.9541C18.9748 12.7418 17.2473 11.0284 16.0205 8.98145L19.4814 5.52148C20.3145 4.68839 20.7315 4.27172 21.249 4.27148Z",fill:"white"})}),e.jsx("input",{id:"imageUpload",type:"file",accept:"image/*",className:"absolute top-0 left-0 z-10 h-[100px] w-[100px] opacity-0 cursor-pointer",onChange:H}),C&&e.jsx("div",{className:"absolute rounded-full inset-0 bg-black opacity-50 z-0 cursor-pointer"})]}):e.jsx("img",{src:s.icon?s.icon:h,alt:"",className:"rounded-full w-[100px] h-[100px]"}):e.jsx("img",{src:s.icon?s.icon:h,alt:"",className:"rounded-full w-[100px] h-[100px]"}):e.jsx("img",{src:s.icon?s.icon:h,alt:"",className:"rounded-full w-[100px] h-[100px]"})}),e.jsxs("div",{className:"text-4xl font-bold pt-20 ml-2",children:["c/",s.communityId]})]}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{ref:d,className:"relative mx-auto w-full 2xl:w-[750px] flex pt-5",children:[e.jsxs("div",{onClick:()=>a(!r),className:"flex cursor-pointer pl-4 md:pl-0 md:pt-1 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx("div",{className:"text-xs",children:u}),e.jsx("div",{className:"ml-2",children:e.jsx(Y,{})})]}),r&&e.jsxs("div",{onClick:()=>{},className:"absolute top-12 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[e.jsx("div",{onClick:()=>{m("Popular"),a(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),e.jsx("div",{onClick:()=>{m("New"),a(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]}),o?p?e.jsx("div",{children:"Loading..."}):O?e.jsx("div",{children:"Error loading communities"}):l?l.some(f=>f.communityId===s.communityId)?e.jsx("div",{onClick:()=>{w||F({communityId:n})},className:"px-5 py-3 rounded-full border cursor-pointer hover:bg-[#333333] transition-all ease-in-out duration-300",children:w?"Leaving...":"Joined"}):e.jsx("div",{onClick:()=>{N||B({communityId:n})},className:"px-5 py-3 rounded-full bg-cyan-700 cursor-pointer hover:bg-cyan-500 transition-all ease-in-out duration-300",children:N?"Joining...":"Join"}):e.jsx("div",{className:"px-5 py-3 rounded-full bg-cyan-700 cursor-pointer hover:bg-cyan-500 transition-all ease-in-out duration-300",children:"Join"}):e.jsx("div",{onClick:()=>z({to:"/login"}),className:"px-5 py-3 rounded-full bg-cyan-700 cursor-pointer hover:bg-cyan-500 transition-all ease-in-out duration-300",children:"Join"})]})]}),u==="Popular"?e.jsx(ee,{community:s}):e.jsx(te,{community:s})]}):e.jsx("div",{className:"flex flex-col min-h-screen",children:e.jsxs("main",{className:"flex-1 p-3",children:[e.jsx("p",{className:"text-xl md:text-4xl text-center pt-20 md:pt-32",children:"Whoops! This isn't what you're looking for ðŸ˜…"}),e.jsx("div",{className:"flex flex-col my-10 md:my-20 mx-auto w-[250px]",children:e.jsx(I,{to:"/",className:"py-2 px-10 rounded bg-cyan-500 text-center tracking-widest hover:bg-cyan-300 hover:text-[#202020] transition-all ease-in-out duration-300 text-white secondary-font font-bold",children:"LET'S GO HOME"})})]})})})}export{ce as component};
