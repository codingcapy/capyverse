import{S as P,s as k,h as w,g as U,n as g,u as x,r as d,a as A,b as q,c as M,j as l,L as _}from"./index-LT3886pk.js";var $=class extends P{#t;#s=void 0;#e;#r;constructor(e,r){super(),this.#t=e,this.setOptions(r),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const r=this.options;this.options=this.#t.defaultMutationOptions(e),k(this.options,r)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),r?.mutationKey&&this.options.mutationKey&&w(r.mutationKey)!==w(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#a(e)}getCurrentResult(){return this.#s}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#i(),this.#a()}mutate(e,r){return this.#r=r,this.#e?.removeObserver(this),this.#e=this.#t.getMutationCache().build(this.#t,this.options),this.#e.addObserver(this),this.#e.execute(e)}#i(){const e=this.#e?.state??U();this.#s={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){g.batch(()=>{if(this.#r&&this.hasListeners()){const r=this.#s.variables,t=this.#s.context,s={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#r.onSuccess?.(e.data,r,t,s),this.#r.onSettled?.(e.data,null,r,t,s)):e?.type==="error"&&(this.#r.onError?.(e.error,r,t,s),this.#r.onSettled?.(void 0,e.error,r,t,s))}this.listeners.forEach(r=>{r(this.#s)})})}};function R(e,r){const t=x(),[s]=d.useState(()=>new $(t,e));d.useEffect(()=>{s.setOptions(e)},[s,e]);const i=d.useSyncExternalStore(d.useCallback(c=>s.subscribe(g.batchCalls(c)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),a=d.useCallback((c,n)=>{s.mutate(c,n).catch(A)},[s]);if(i.error&&q(s.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:a,mutateAsync:i.mutate}}var N=(e,r,t={})=>{let s=`${e}=${r}`;if(e.startsWith("__Secure-")&&!t.secure)throw new Error("__Secure- Cookie must have Secure attributes");if(e.startsWith("__Host-")){if(!t.secure)throw new Error("__Host- Cookie must have Secure attributes");if(t.path!=="/")throw new Error('__Host- Cookie must have Path attributes with "/"');if(t.domain)throw new Error("__Host- Cookie must not have Domain attributes")}if(t&&typeof t.maxAge=="number"&&t.maxAge>=0){if(t.maxAge>3456e4)throw new Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");s+=`; Max-Age=${t.maxAge|0}`}if(t.domain&&t.prefix!=="host"&&(s+=`; Domain=${t.domain}`),t.path&&(s+=`; Path=${t.path}`),t.expires){if(t.expires.getTime()-Date.now()>3456e7)throw new Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");s+=`; Expires=${t.expires.toUTCString()}`}if(t.httpOnly&&(s+="; HttpOnly"),t.secure&&(s+="; Secure"),t.sameSite&&(s+=`; SameSite=${t.sameSite.charAt(0).toUpperCase()+t.sameSite.slice(1)}`),t.priority&&(s+=`; Priority=${t.priority.charAt(0).toUpperCase()+t.priority.slice(1)}`),t.partitioned){if(!t.secure)throw new Error("Partitioned Cookie must have Secure attributes");s+="; Partitioned"}return s},L=(e,r,t)=>(r=encodeURIComponent(r),N(e,r,t)),T=(e,r)=>(e=e.replace(/\/+$/,""),e=e+"/",r=r.replace(/^\/+/,""),e+r),b=(e,r)=>{for(const[t,s]of Object.entries(r)){const i=new RegExp("/:"+t+"(?:{[^/]+})?\\??");e=e.replace(i,s?`/${s}`:"")}return e},S=e=>{const r=new URLSearchParams;for(const[t,s]of Object.entries(e))if(s!==void 0)if(Array.isArray(s))for(const i of s)r.append(t,i);else r.set(t,s);return r},D=(e,r)=>{switch(r){case"ws":return e.replace(/^http/,"ws");case"http":return e.replace(/^ws/,"http")}},C=e=>/^https?:\/\/[^\/]+?\/index(?=\?|$)/.test(e)?e.replace(/\/index(?=\?|$)/,"/"):e.replace(/\/index(?=\?|$)/,"");function p(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function j(e,r){if(!p(e)&&!p(r))return r;const t={...e};for(const s in r){const i=r[s];p(t[s])&&p(i)?t[s]=j(t[s],i):t[s]=i}return t}var E=(e,r)=>new Proxy(()=>{},{get(s,i){if(!(typeof i!="string"||i==="then"))return E(e,[...r,i])},apply(s,i,a){return e({path:r,args:a})}}),H=class{url;method;queryParams=void 0;pathParams={};rBody;cType=void 0;constructor(e,r){this.url=e,this.method=r}fetch=async(e,r)=>{if(e){if(e.query&&(this.queryParams=S(e.query)),e.form){const n=new FormData;for(const[u,h]of Object.entries(e.form))if(Array.isArray(h))for(const o of h)n.append(u,o);else n.append(u,h);this.rBody=n}e.json&&(this.rBody=JSON.stringify(e.json),this.cType="application/json"),e.param&&(this.pathParams=e.param)}let t=this.method.toUpperCase();const s={...e?.header,...typeof r?.headers=="function"?await r.headers():r?.headers};if(e?.cookie){const n=[];for(const[u,h]of Object.entries(e.cookie))n.push(L(u,h,{path:"/"}));s.Cookie=n.join(",")}this.cType&&(s["Content-Type"]=this.cType);const i=new Headers(s??void 0);let a=this.url;a=C(a),a=b(a,this.pathParams),this.queryParams&&(a=a+"?"+this.queryParams.toString()),t=this.method.toUpperCase();const c=!(t==="GET"||t==="HEAD");return(r?.fetch||fetch)(a,{body:c?this.rBody:void 0,method:t,headers:i,...r?.init})}},K=(e,r)=>E(function t(s){const i=[...s.path],a=i.slice(-3).reverse();if(a[0]==="toString")return a[1]==="name"?a[2]||"":t.toString();if(a[0]==="valueOf")return a[1]==="name"?a[2]||"":t;let c="";if(/^\$/.test(a[0])){const o=i.pop();o&&(c=o.replace(/^\$/,""))}const n=i.join("/"),u=T(e,n);if(c==="url"){let o=u;return s.args[0]&&(s.args[0].param&&(o=b(u,s.args[0].param)),s.args[0].query&&(o=o+"?"+S(s.args[0].query).toString())),o=C(o),new URL(o)}if(c==="ws"){const o=D(s.args[0]&&s.args[0].param?b(u,s.args[0].param):u,"ws"),f=new URL(o),v=s.args[0]?.query;return v&&Object.entries(v).forEach(([m,y])=>{Array.isArray(y)?y.forEach(O=>f.searchParams.append(m,O)):f.searchParams.set(m,y)}),((...m)=>r?.webSocket!==void 0&&typeof r.webSocket=="function"?r.webSocket(...m):new WebSocket(...m))(f.toString())}const h=new H(u,c);if(c){r??={};const o=j(r,{...s.args[1]});return h.fetch(s.args[0],o)}return h},[]);const I="http://localhost:3333",W=K(I);async function B(e){const r=await W.api.v0.users.$post({json:e});if(!r.ok){let s="There was an issue creating your account :( We'll look into it ASAP!";try{const i=await r.json();i&&typeof i=="object"&&"message"in i&&(s=String(i.message))}catch(i){console.error("Failed to parse error response:",i)}throw new Error(s)}const t=await r.json();if(!t.user)throw new Error("Invalid response from server");return t.user}const F=e=>{const r=x();return R({mutationFn:B,onSettled:()=>{r.invalidateQueries({queryKey:["users"]})},onError:t=>{}})};function Q(){const{mutate:e}=F(),[r,t]=d.useState(""),{loginService:s,authLoading:i,user:a}=M(n=>n);function c(n){n.preventDefault();const u=n.target.username.value,h=n.target.email.value,o=n.target.password.value;if(u.length>255)return t("Username too long!");if(h.length>255)return t("Email too long!");if(o.length>80)return t("Password too long! Max character limit is 80");e({username:u,password:o,email:h},{onSuccess:()=>{s(h,o),i&&t("Loading...")},onError:f=>t(f.toString())})}return l.jsxs("div",{className:"pt-20 w-[300px] mx-auto",children:[l.jsx("div",{className:"text-center font-bold text-cyan-500 text-2xl mb-10",children:"Sign Up"}),l.jsxs("form",{onSubmit:c,className:"flex flex-col mx-auto",children:[l.jsx("input",{type:"text",name:"username",id:"username",required:!0,className:"p-2 border border-[#c4c4c4] rounded bg-[#414141] my-2",placeholder:"username"}),l.jsx("input",{type:"email",name:"email",id:"email",required:!0,className:"p-2 border border-[#c4c4c4] rounded bg-[#414141] my-2",placeholder:"email"}),l.jsx("input",{type:"password",name:"password",id:"password",required:!0,className:"p-2 border border-[#c4c4c4] rounded bg-[#414141] my-2",placeholder:"password"}),l.jsx("button",{className:"bg-cyan-500 px-5 py-2 rounded-full font-bold my-5",children:"SIGN UP"})]}),l.jsxs("div",{children:["Already have an account?"," ",l.jsx(_,{to:"/login",className:"text-cyan-500 font-bold",children:"Login"})]}),l.jsx("div",{children:r})]})}export{Q as component};
