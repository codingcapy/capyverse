import{u as E,a as D,j as e,r as u,d as T,F as ae,e as de,I as ie,R as le,c as ce,f as ue,h as me}from"./index-CeGHjFy2.js";import{a as M,d as G,c as xe}from"./index-Ctk5t4J3.js";import{b as fe,u as he,c as pe,e as ve,f as ge,h as je,i as be,F as Ce,j as H,k as Ne,l as ye,d as K,g as Ie,M as Pe,V as we}from"./comments-DmyhyBTe.js";import{g as W}from"./users-eAH2VyzS.js";import{d as O}from"./capypaul01-dN7xfBcC.js";function Me(t){const{data:r,isLoading:l,isError:c}=M(fe(t.comment.commentId)),{mutate:m,isPending:i}=he(),{mutate:v,isPending:C}=pe(),{user:a}=E(),g=D();function j(s,d,N,h){if(s.preventDefault(),s.stopPropagation(),i||C)return;const y=r&&r.find(b=>a&&b.userId===a.userId);a&&y?v({voteId:y.voteId,value:h}):a?m({userId:a&&a.userId||"",postId:d.postId,commentId:N.commentId,value:h}):g({to:"/login"})}return e.jsx("div",{children:c?e.jsx("div",{children:"Error fetching votes"}):l?e.jsx("div",{children:"Loading..."}):r?e.jsxs("div",{className:"flex w-fit rounded-full py-1 justify-center",children:[r.filter(s=>a&&s.userId===a.userId&&s.value===1).length>0?e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),v({voteId:r.find(d=>d.postId===t.post.postId&&a&&d.userId===a.userId&&d.value===1).voteId,value:0})},className:"pr-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(ve,{size:20})}):e.jsx("div",{onClick:s=>{j(s,t.post,t.comment,1)},className:"pr-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(ge,{size:20})}),e.jsx("div",{className:"",children:r.filter(s=>s.postId===t.post.postId).reduce((s,d)=>s+d.value,0)}),r.filter(s=>a&&s.userId===a.userId&&s.value===-1).length>0?e.jsx("div",{onClick:s=>{s.stopPropagation(),s.preventDefault(),v({voteId:r.find(d=>d.postId===t.post.postId&&a&&d.userId===a.userId&&d.value===-1).voteId,value:0})},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(je,{size:20})}):e.jsx("div",{onClick:s=>{j(s,t.post,t.comment,-1)},className:"px-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:e.jsx(be,{size:20})})]}):e.jsx("div",{children:"An unexpected error has occured"})})}function Se(t){const r=u.useRef(null),{user:l}=E(),{setEditCommentModePointer:c}=T();D();function m(i){r.current&&!r.current.contains(i.target)&&t.setShowMenu(!1)}return u.useEffect(()=>(document.addEventListener("click",m),()=>document.removeEventListener("click",m)),[]),e.jsxs("div",{ref:r,className:"absolute top-12 right-2 py-2 px-5 rounded bg-[#222222] shadow-[0_0_15px_rgba(0,0,0,0.7)] z-40",children:[l&&t.comment.userId===l.userId&&e.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[e.jsx(Ce,{size:20,className:"pt-1"}),e.jsx("div",{onClick:()=>{c(t.comment.commentId),t.setCommentContent(t.comment.content||""),t.setShowMenu(!1)},className:"ml-2",children:"Edit"})]}),e.jsxs("div",{className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[e.jsx(ae,{size:20,className:"pt-1"}),e.jsx("div",{className:"ml-2",children:"Save"})]}),l&&t.comment.userId===l.userId&&e.jsxs("div",{onClick:i=>{i.stopPropagation(),i.preventDefault(),t.setDeleteMode(!0),t.setShowMenu(!1)},className:"flex py-2 hover:text-[#ffffff] cursor-pointer",children:[e.jsx(de,{size:20,className:"pt-1 "}),e.jsx("div",{className:"ml-2",children:"Delete"})]})]})}function X(t){const[r,l]=u.useState(!1),{user:c}=E(),[m,i]=u.useState(""),{mutate:v,isPending:C}=H(),a=D(),[g,j]=u.useState(!1),[s,d]=u.useState(!1),{mutate:N,isPending:h}=Ne(),{editCommentModePointer:y,setEditCommentModePointer:b}=T(),{mutate:S,isPending:P}=ye();function w(o){if(o.preventDefault(),!c)return a({to:"/login"});const z=c.userId;v({userId:z,postId:t.post.postId,parentCommentId:t.comment.commentId,level:t.comment.level+1,content:m},{onSuccess:()=>{i(""),l(!1)}})}function L(o){if(o.preventDefault(),!c)return a({to:"/login"});S({commentId:t.comment.commentId,content:m},{onSuccess:()=>{b(0),i("")}})}return e.jsxs("div",{className:"my-3",style:{marginLeft:window.innerWidth>760?t.comment.level*25:t.comment.level*10},children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("div",{className:"font-bold",children:t.comment.username}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:K(t.post.createdAt)})]}),y===t.comment.commentId?e.jsxs("form",{onSubmit:L,className:"pl-5 py-2 my-5 rounded-2xl border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300",children:[e.jsx("input",{type:"text",placeholder:"Add your reply",className:"outline-none w-full",value:m,onChange:o=>i(o.target.value),required:!0}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:o=>{o.stopPropagation(),b(0)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:P,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:P?"Saving...":"Save Edits"})]})]}):e.jsx("div",{children:t.comment.content}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"mr-3",children:e.jsx(Me,{post:t.post,comment:t.comment})}),e.jsxs("div",{onClick:()=>{c||a({to:"/login"}),i(""),l(!0)},className:"flex ml-2 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx(ie,{size:22}),e.jsx("div",{className:"ml-2",children:"Reply"})]}),c&&t.comment.userId===c.userId&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{onClick:o=>{o.preventDefault(),o.stopPropagation(),j(!g)},className:"ml-3 px-2 pt-1.5 rounded-full hover:text-cyan-700 transition-all ease-in-out duration-300 cursor-pointer",children:e.jsx(G,{})}),g&&e.jsx(Se,{comment:t.comment,setDeleteMode:d,setShowMenu:j,setCommentContent:i})]})]}),r&&e.jsxs("form",{onSubmit:w,className:`pl-5 py-2 my-5 ${r?"rounded-2xl":"rounded-full"} border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300`,children:[e.jsx("input",{type:"text",placeholder:"Add your reply",className:"outline-none w-full",value:m,onChange:o=>i(o.target.value),required:!0}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:o=>{o.stopPropagation(),l(!1)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:C,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:C?"Creating...":"Comment"})]})]}),s&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Comment?"}),e.jsx("div",{className:"my-5",children:"Once you delete this comment, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:o=>{o.stopPropagation(),o.preventDefault(),!h&&(N({commentId:t.comment.commentId}),d(!1))},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:h?"Deleting...":"DELETE"}),e.jsx("div",{onClick:o=>{o.stopPropagation(),o.preventDefault(),d(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"}),t.comment.children?.map(o=>e.jsx(X,{comment:o,post:t.post},o.commentId))]},t.comment.commentId)}function Ae(){const t=le.useRouteContext(),{user:r}=E(),{data:l,isLoading:c,error:m}=M(Ie(t.postId)),{data:i,isLoading:v,error:C}=M(W(t.userId)),[a,g]=u.useState(""),{mutate:j,isPending:s}=H(),d=D(),[N,h]=u.useState(!1),y=se(l&&l||[]),[b,S]=u.useState(!1),[P,w]=u.useState(!1),{mutate:L,isPending:o}=ce(),{editPostModePointer:z,setEditPostModePointer:U}=T(),{mutate:Y,isPending:B}=ue(),[Q,q]=u.useState(t.content),_=me(),{data:A,isLoading:Z}=M(W(t.userId)),{data:f,isLoading:ee,error:te}=M(xe(t.postId)),[F,R]=u.useState(0),ne=f&&f[F];function se(n,I){const V=new Map;for(const x of n)V.set(x.commentId,{...x,children:[]});const k=[];for(const x of n){const p=V.get(x.commentId);if(x.parentCommentId==null){k.push(p);continue}const J=V.get(x.parentCommentId);if(!J){k.push(p);continue}J.children.push(p)}const re=(x,p)=>x.createdAt.getTime()-p.createdAt.getTime();function $(x){x.sort(re);for(const p of x)p.children.length&&$(p.children)}return $(k),k}function oe(n){if(n.preventDefault(),s)return;if(!r)return d({to:"/login"});const I=r.userId;j({userId:I,postId:t.postId,content:a},{onSuccess:()=>{g(""),h(!1)}})}return e.jsxs("div",{className:"pt-[70px] mx-auto w-full lg:w-[50%]",children:[e.jsxs("div",{className:"relative flex justify-between",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:Z?O:A?A.profilePic?A.profilePic:O:O,alt:"",className:"w-8 h-8 rounded-full"}),v?e.jsx("div",{className:"ml-2",children:"Loading..."}):C?e.jsx("div",{children:"Error loading author"}):i?e.jsx("div",{className:"font-bold ml-2",children:i.username}):e.jsx("div",{className:"ml-2",children:"unknown author"}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:K(t.createdAt)})]}),e.jsx("div",{className:"",children:e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),S(!b)},className:" absolute top-1 right-1 p-3 rounded-full hover:bg-[#575757] transition-all ease-in-out duration-300",children:e.jsx(G,{})})}),b&&e.jsx(Pe,{post:t,setDeleteMode:w,setShowMenu:S})]}),e.jsxs("div",{className:"text-4xl font-bold",children:[" ",t.title]}),e.jsx("div",{children:te?e.jsx("div",{className:"w-full h-auto md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:"Error loading images"}):ee?e.jsx("div",{className:"w-full h-auto md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:"Loading..."}):f?f.length>0?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[f.length>1&&e.jsx("button",{type:"button",onClick:()=>R(n=>n===0?f.length-1:n-1),className:"absolute left-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:"‹"}),ne&&e.jsx("div",{className:"w-full h-auto md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:e.jsx("img",{src:`https://${f[F].imageUrl}`,className:"w-full h-full object-contain"})}),f.length>1&&e.jsx("button",{type:"button",onClick:()=>R(n=>n===f.length-1?0:n+1),className:"absolute right-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:"›"}),e.jsx("div",{className:"absolute bottom-2 flex gap-1",children:f.map((n,I)=>e.jsx("button",{type:"button",onClick:()=>R(I),className:`w-2 h-2 rounded-full ${I===F?"bg-cyan-400":"bg-zinc-500"}`},I))})]}):e.jsx("div",{className:"text-center pt-[60px]",children:"An unexpected error has occurred"}):e.jsx("div",{className:"text-center pt-[60px]",children:"An unexpected error has occurred"})}),z===t.postId?e.jsxs("div",{children:[e.jsx("textarea",{name:"content",id:"content",required:!0,className:"p-2 border border-[#c4c4c4] rounded my-2 w-full h-[300px]",placeholder:"content",value:Q,onChange:n=>q(n.target.value)}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),U(0)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{onClick:()=>{B||Y({postId:t.postId,content:Q},{onSuccess:()=>{_.invalidate(),U(0)}})},className:"mx-2 px-2 py-1 rounded-full bg-cyan-700",children:B?"Saving...":"Save"})]})]}):e.jsx("div",{className:"my-10",children:e.jsx("div",{children:t.content})}),e.jsx(we,{post:t}),e.jsxs("form",{onClick:()=>{r||d({to:"/login"}),h(!0)},onSubmit:oe,className:`pl-5 py-2 my-5 ${N?"rounded-2xl":"rounded-full"} border border-[#5c5c5c] w-full hover:bg-[#383838] hover:border-[#818181] transition-all ease-in-out duration-300`,children:[e.jsx("input",{type:"text",placeholder:"Join the conversation",value:a,onChange:n=>g(n.target.value),required:!0,className:"outline-none w-full"}),N&&e.jsxs("div",{className:"flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),h(!1)},className:"cursor-pointer px-2 py-1 rounded-full bg-[#383838]",children:"Cancel"}),e.jsx("button",{disabled:s,className:"mx-2 px-2 py-1 rounded-full bg-red-500 cursor-pointer",children:s?"Submitting...":"Comment"})]})]}),r&&t.userId===r.userId&&P&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Post?"}),e.jsx("div",{className:"my-5",children:"Once you delete this post, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),!o&&L({postId:t.postId},{onSuccess:()=>{_.invalidate(),w(!1),q("[This post has been deleted by the user]")}})},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:o?"Deleting...":"DELETE"}),e.jsx("div",{onClick:n=>{n.stopPropagation(),n.preventDefault(),w(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]}),r&&t.userId===r.userId&&P&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"}),m?e.jsx("div",{children:"Error loading comments"}):c?e.jsx("div",{children:"Loading..."}):y.map(n=>e.jsx(X,{comment:n,post:t},n.commentId))]})}export{Ae as component};
