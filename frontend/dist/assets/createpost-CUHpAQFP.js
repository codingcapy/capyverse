import{u as R,e as T,a as M,r as i,b as j,f as Q,j as e}from"./index-C1kMLePc.js";import{u as A,g as F,a as q,P as _,F as G}from"./images-Bi-TcHRX.js";import{P as H}from"./PostContentInput-DfNmR4px.js";function X(){const{user:s}=R(),{mutate:y,isPending:I,error:x}=T(),f=M(),[N,l]=i.useState(""),[P,c]=i.useState(!1),C=i.useRef(null),[d,J]=i.useState(null),{mutate:h,isPending:v}=A(),{data:a,isLoading:w,error:S}=j(F(s&&s.userId||"")),{mutate:D}=q(),[u,m]=i.useState(0),E=a&&a[u],[g,z]=i.useState(""),{data:o,isLoading:U,error:L}=j(Q(s&&s.userId||"")),[p,b]=i.useState(!1),[r,k]=i.useState("Select a community");function O(t){if(t.preventDefault(),!s)return"Error: no logged in user";if(g.length>1e4)return l("Post content length max character limit is 10,000");const n=t.target.titleinput.value;if(n.length>400)return l("Title content length max character limit is 400");y({userId:s.userId||"",title:n,content:g,communityId:r==="Select a community"?"":r},{onSuccess:()=>f({to:"/"}),onError:B=>l(B.toString())}),x&&l(x.toString())}function $(t){if(v)return;const n=t.target.files?.[0];n&&(h({postId:"",userId:s&&s.userId||"",file:n}),t.target.value="")}return i.useEffect(()=>{s||f({to:"/login"})},[s]),i.useEffect(()=>()=>{d&&URL.revokeObjectURL(d)},[d]),i.useEffect(()=>console.log(o),[o]),e.jsxs("div",{className:"pt-20 w-[80%] lg:w-[50%] 2xl:w-[30%] mx-auto",children:[e.jsx("div",{className:"text-center font-bold text-cyan-500 text-2xl mb-5",children:"Create Post"}),e.jsxs("form",{onSubmit:O,className:"flex flex-col mx-auto ",children:[e.jsxs("div",{className:"relative w-fit",children:[e.jsxs("div",{onClick:()=>b(!p),className:"cursor-pointer rounded-full px-5 py-3 bg-[#333333] w-[207px] flex mb-5 justify-between",children:[e.jsx("div",{className:`mr-2 ${r==="Select a community"?"":"font-bold"}`,children:r==="Select a community"?r:`c/${r}`}),e.jsx("div",{className:"pt-0.5",children:e.jsx(_,{size:20})})]}),p&&e.jsx("div",{className:"absolute top-14 right-2 bg-[#333333] py-1 min-h-[50px] min-w-[190px] rounded-lg",children:U?e.jsx("div",{children:"Loading..."}):L?e.jsx("div",{children:"Error loading communities"}):o?o.length>0?o.map(t=>e.jsxs("div",{onClick:()=>{k(t.communityId),b(!1)},className:"px-3 py-2 cursor-pointer font-bold hover:text-cyan-500 transition-all ease-in-out duration-300 z-50",children:["c/",t.communityId]},t.communityId)):e.jsx("div",{className:"my-3 p-2 "}):e.jsx("div",{className:"my-3 p-2 "})})]}),e.jsx("input",{type:"text",name:"titleinput",id:"title",required:!0,className:"p-2 border border-[#c4c4c4] rounded-xl my-2",placeholder:"Title"}),e.jsxs("div",{onDragEnter:t=>{t.preventDefault(),c(!0)},onDragOver:t=>{t.preventDefault(),c(!0)},onDragLeave:()=>c(!1),onDrop:t=>{if(t.preventDefault(),c(!1),v)return;const n=t.dataTransfer.files?.[0];n&&h({postId:"",userId:s&&s.userId||"",file:n})},className:`my-5 border border-dashed w-full h-[150px] rounded-xl ${P?"bg-[#242424]":""}
          ${p?"pointer-events-none":""}`,children:[e.jsx("input",{ref:C,type:"file",className:"hidden",accept:"image/png, image/jpeg, image/heic, image/webp"}),e.jsxs("div",{className:"relative w-full h-full",children:[S?e.jsx("div",{children:"Error loading images"}):w?e.jsx("div",{children:"Loading..."}):a?a.length>0?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[a.length>1&&e.jsx("button",{type:"button",onClick:()=>m(t=>t===0?a.length-1:t-1),className:"absolute left-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:"‹"}),E&&e.jsxs("div",{className:"relative",children:[e.jsx(G,{size:20,className:"text-red-400 absolute top-2 right-2 bg-zinc-700 p-[4px] rounded z-10 cursor-pointer",onClick:()=>D({imageId:a[u].imageId})}),e.jsx("img",{src:`https://${a[u].imageUrl}`,className:"max-h-[140px] mx-auto rounded-lg bg-[#3d3d3d] object-contain"})]}),a.length>1&&e.jsx("button",{type:"button",onClick:()=>m(t=>t===a.length-1?0:t+1),className:"absolute right-2 z-10 bg-zinc-800/80 hover:bg-zinc-700 p-2 rounded-full",children:"›"}),e.jsx("div",{className:"absolute bottom-2 flex gap-1",children:a.map((t,n)=>e.jsx("button",{type:"button",onClick:()=>m(n),className:`w-2 h-2 rounded-full ${n===u?"bg-cyan-400":"bg-zinc-500"}`},n))})]}):e.jsx("div",{className:"text-center pt-[60px]",children:"Drag and drop or upload images"}):e.jsx("div",{className:"text-center pt-[60px]",children:"Drag and drop or upload images"}),e.jsx("input",{type:"file",className:"absolute top-0 left-0 w-full h-full py-2 opacity-0 cursor-pointer appearance-none file:hidden",accept:"image/png, image/jpeg, image/heic, image/webp",onChange:$})]})]}),e.jsx(H,{content:g,onChange:t=>z(t),contentPlaceholder:"Content (optional)"}),e.jsx("button",{className:"bg-cyan-600 px-5 py-2 rounded-full font-bold my-5 cursor-pointer hover:bg-cyan-500 transition-all ease-in-out duration-300",children:I?"Posting...":"POST"})]}),e.jsx("div",{children:N})]})}export{X as component};
