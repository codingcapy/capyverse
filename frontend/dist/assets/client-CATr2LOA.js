import{S as P,s as k,o as v,q as E,l as w,u as U,r as l,n as A,m as _}from"./index-CmEL-dfM.js";var q=class extends P{#t;#s=void 0;#e;#r;constructor(e,s){super(),this.#t=e,this.setOptions(s),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const s=this.options;this.options=this.#t.defaultMutationOptions(e),k(this.options,s)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),s?.mutationKey&&this.options.mutationKey&&v(s.mutationKey)!==v(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#a(e)}getCurrentResult(){return this.#s}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#i(),this.#a()}mutate(e,s){return this.#r=s,this.#e?.removeObserver(this),this.#e=this.#t.getMutationCache().build(this.#t,this.options),this.#e.addObserver(this),this.#e.execute(e)}#i(){const e=this.#e?.state??E();this.#s={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){w.batch(()=>{if(this.#r&&this.hasListeners()){const s=this.#s.variables,r=this.#s.context,t={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#r.onSuccess?.(e.data,s,r,t),this.#r.onSettled?.(e.data,null,s,r,t)):e?.type==="error"&&(this.#r.onError?.(e.error,s,r,t),this.#r.onSettled?.(void 0,e.error,s,r,t))}this.listeners.forEach(s=>{s(this.#s)})})}};function B(e,s){const r=U(),[t]=l.useState(()=>new q(r,e));l.useEffect(()=>{t.setOptions(e)},[t,e]);const i=l.useSyncExternalStore(l.useCallback(n=>t.subscribe(w.batchCalls(n)),[t]),()=>t.getCurrentResult(),()=>t.getCurrentResult()),a=l.useCallback((n,h)=>{t.mutate(n,h).catch(A)},[t]);if(i.error&&_(t.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:a,mutateAsync:i.mutate}}var $=(e,s,r={})=>{let t=`${e}=${s}`;if(e.startsWith("__Secure-")&&!r.secure)throw new Error("__Secure- Cookie must have Secure attributes");if(e.startsWith("__Host-")){if(!r.secure)throw new Error("__Host- Cookie must have Secure attributes");if(r.path!=="/")throw new Error('__Host- Cookie must have Path attributes with "/"');if(r.domain)throw new Error("__Host- Cookie must not have Domain attributes")}if(r&&typeof r.maxAge=="number"&&r.maxAge>=0){if(r.maxAge>3456e4)throw new Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");t+=`; Max-Age=${r.maxAge|0}`}if(r.domain&&r.prefix!=="host"&&(t+=`; Domain=${r.domain}`),r.path&&(t+=`; Path=${r.path}`),r.expires){if(r.expires.getTime()-Date.now()>3456e7)throw new Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");t+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(t+="; HttpOnly"),r.secure&&(t+="; Secure"),r.sameSite&&(t+=`; SameSite=${r.sameSite.charAt(0).toUpperCase()+r.sameSite.slice(1)}`),r.priority&&(t+=`; Priority=${r.priority.charAt(0).toUpperCase()+r.priority.slice(1)}`),r.partitioned){if(!r.secure)throw new Error("Partitioned Cookie must have Secure attributes");t+="; Partitioned"}return t},j=(e,s,r)=>(s=encodeURIComponent(s),$(e,s,r)),M=(e,s)=>(e=e.replace(/\/+$/,""),e=e+"/",s=s.replace(/^\/+/,""),e+s),y=(e,s)=>{for(const[r,t]of Object.entries(s)){const i=new RegExp("/:"+r+"(?:{[^/]+})?\\??");e=e.replace(i,t?`/${t}`:"")}return e},S=e=>{const s=new URLSearchParams;for(const[r,t]of Object.entries(e))if(t!==void 0)if(Array.isArray(t))for(const i of t)s.append(r,i);else s.set(r,t);return s},R=(e,s)=>{switch(s){case"ws":return e.replace(/^http/,"ws");case"http":return e.replace(/^ws/,"http")}},g=e=>/^https?:\/\/[^\/]+?\/index(?=\?|$)/.test(e)?e.replace(/\/index(?=\?|$)/,"/"):e.replace(/\/index(?=\?|$)/,"");function d(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function x(e,s){if(!d(e)&&!d(s))return s;const r={...e};for(const t in s){const i=s[t];d(r[t])&&d(i)?r[t]=x(r[t],i):r[t]=i}return r}var O=(e,s)=>new Proxy(()=>{},{get(t,i){if(!(typeof i!="string"||i==="then"))return O(e,[...s,i])},apply(t,i,a){return e({path:s,args:a})}}),T=class{url;method;queryParams=void 0;pathParams={};rBody;cType=void 0;constructor(e,s){this.url=e,this.method=s}fetch=async(e,s)=>{if(e){if(e.query&&(this.queryParams=S(e.query)),e.form){const h=new FormData;for(const[c,u]of Object.entries(e.form))if(Array.isArray(u))for(const o of u)h.append(c,o);else h.append(c,u);this.rBody=h}e.json&&(this.rBody=JSON.stringify(e.json),this.cType="application/json"),e.param&&(this.pathParams=e.param)}let r=this.method.toUpperCase();const t={...e?.header,...typeof s?.headers=="function"?await s.headers():s?.headers};if(e?.cookie){const h=[];for(const[c,u]of Object.entries(e.cookie))h.push(j(c,u,{path:"/"}));t.Cookie=h.join(",")}this.cType&&(t["Content-Type"]=this.cType);const i=new Headers(t??void 0);let a=this.url;a=g(a),a=y(a,this.pathParams),this.queryParams&&(a=a+"?"+this.queryParams.toString()),r=this.method.toUpperCase();const n=!(r==="GET"||r==="HEAD");return(s?.fetch||fetch)(a,{body:n?this.rBody:void 0,method:r,headers:i,...s?.init})}},H=(e,s)=>O(function r(t){const i=[...t.path],a=i.slice(-3).reverse();if(a[0]==="toString")return a[1]==="name"?a[2]||"":r.toString();if(a[0]==="valueOf")return a[1]==="name"?a[2]||"":r;let n="";if(/^\$/.test(a[0])){const o=i.pop();o&&(n=o.replace(/^\$/,""))}const h=i.join("/"),c=M(e,h);if(n==="url"){let o=c;return t.args[0]&&(t.args[0].param&&(o=y(c,t.args[0].param)),t.args[0].query&&(o=o+"?"+S(t.args[0].query).toString())),o=g(o),new URL(o)}if(n==="ws"){const o=R(t.args[0]&&t.args[0].param?y(c,t.args[0].param):c,"ws"),m=new URL(o),b=t.args[0]?.query;return b&&Object.entries(b).forEach(([f,p])=>{Array.isArray(p)?p.forEach(C=>m.searchParams.append(f,C)):m.searchParams.set(f,p)}),((...f)=>s?.webSocket!==void 0&&typeof s.webSocket=="function"?s.webSocket(...f):new WebSocket(...f))(m.toString())}const u=new T(c,n);if(n){s??={};const o=x(s,{...t.args[1]});return u.fetch(t.args[0],o)}return u},[]);const D="http://localhost:3333",W=H(D);export{W as c,B as u};
