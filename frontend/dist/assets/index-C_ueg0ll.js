import{r as d,c as y,u as I,j as e,L,I as C,d as P,g as E}from"./index-mk7jareS.js";import{a as p,c as k,d as S}from"./index-D3bJXwAY.js";import{g as M,d as D,V as A,M as O,P as Q,a as V}from"./comments-Bm_kPlbI.js";import{d as b}from"./capypaul01-dN7xfBcC.js";import{g as B}from"./users-D8YpaWQp.js";function v(t){const[h,f]=d.useState(!1),[n,c]=d.useState(!1),{mutate:N,isPending:u}=y(),{user:a}=I(),{data:i,isLoading:g}=p(B(t.post.userId)),{data:l,isLoading:r,error:j}=p(M(t.post.postId)),{data:s,isLoading:x,error:w}=p(k(t.post.postId));return e.jsxs("div",{className:"mx-auto w-full md:w-[50%] 2xl:w-[750px] border-t border-[#636363]",children:[e.jsxs(L,{to:"/posts/$postId",params:{postId:t.post.postId.toString()},children:[e.jsxs("div",{className:"relative my-1 rounded py-2 px-4 hover:bg-[#333333] transition-all ease-in-out duration-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex text-[#bdbdbd] text-sm",children:[e.jsx("img",{src:g?b:i?i.profilePic?i.profilePic:b:b,alt:"",className:"w-6 h-6 rounded-full"}),e.jsx("div",{className:"font-bold ml-2",children:t.post.username}),e.jsx("div",{className:"px-1",children:"•"}),e.jsx("div",{children:D(t.post.createdAt)})]}),e.jsx("div",{onClick:o=>{o.stopPropagation(),o.preventDefault(),f(!h)},className:"absolute top-1 right-1 p-3 rounded-full hover:bg-[#575757] transition-all ease-in-out duration-300",children:e.jsx(S,{})})]}),e.jsx("div",{className:"text-xl md:text-2xl font-semibold",children:t.post.title}),x?e.jsx("div",{children:"Loading..."}):w?e.jsx("div",{children:"Error loading images"}):s?s.map((o,m)=>{if(m<1)return e.jsx("div",{className:"w-full h-[220px] sm:h-[300px] md:h-[400px] xl:h-[500px] border border-[#424242] bg-[#202020] rounded-xl my-2 flex items-center justify-center",children:e.jsx("img",{src:`https://${o.imageUrl}`,alt:"",className:"w-full h-full object-contain"})},o.imageId)}):e.jsx("div",{children:"An unexpected error has occured"}),e.jsx("div",{className:"my-2",children:t.post.content}),e.jsxs("div",{className:"flex",children:[e.jsx(A,{post:t.post}),e.jsxs("div",{className:"flex bg-[#3e3e3e] w-fit rounded-full py-1 justify-center ml-2 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx("div",{className:"pl-3 pr-1",children:e.jsx(C,{size:20})}),r?e.jsx("div",{className:"pr-3",children:"Loading..."}):j?e.jsx("div",{className:"pr-3",children:"Error fetching comments"}):l?e.jsx("div",{className:"pr-3 font-semibold",children:l.length}):e.jsx("div",{className:"pr-3",children:"An unexpected error has occured"})]})]}),h&&e.jsx(O,{post:t.post,setDeleteMode:c,setShowMenu:f})]}),a&&t.post.userId===a.userId&&n&&e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#222222] p-6 rounded shadow-lg w-[90%] max-w-md text-center z-100",children:[e.jsx("div",{className:"text-2xl font-bold",children:"Delete Post?"}),e.jsx("div",{className:"my-5",children:"Once you delete this post, it can’t be restored."}),e.jsxs("div",{className:"my-5 flex justify-end",children:[e.jsx("div",{onClick:o=>{o.stopPropagation(),o.preventDefault(),!u&&(N({postId:t.post.postId}),c(!1))},className:"p-2 mr-1 bg-red-500 rounded text-white bold secondary-font font-bold cursor-pointer",children:u?"Deleting...":"DELETE"}),e.jsx("div",{onClick:o=>{o.stopPropagation(),o.preventDefault(),c(!1)},className:"p-2 ml-1 bg-[#5c5c5c] rounded bold secondary-font font-bold cursor-pointer",children:"CANCEL"})]})]})]},t.post.postId),a&&t.post.userId===a.userId&&n&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-90"})]})}function $(){const{data:t,isLoading:h,isError:f}=p(E()),{data:n,isLoading:c,isError:N}=p(V()),[u,a]=d.useState(!1),[i,g]=d.useState("Popular"),l=d.useRef(null),{searchContent:r}=P();function j(s){l.current&&!l.current.contains(s.target)&&a(!1)}return d.useEffect(()=>(document.addEventListener("click",j),()=>document.removeEventListener("click",j)),[]),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"mx-auto w-full md:w-[50%] pt-[70px] pb-5 ",children:e.jsxs("div",{ref:l,className:"relative mx-auto w-full 2xl:w-[750px] flex",children:[e.jsxs("div",{onClick:()=>a(!u),className:"flex cursor-pointer pl-4 md:pl-0 md:pt-1 hover:text-cyan-500 transition-all ease-in-out duration-300",children:[e.jsx("div",{className:"text-xs",children:i}),e.jsx("div",{className:"ml-2",children:e.jsx(Q,{})})]}),u&&e.jsxs("div",{onClick:()=>{},className:"absolute top-6 left-0 bg-[#444444] px-5 py-2 z-50 shadow-[0_0_15px_rgba(0,0,0,0.7)]",children:[e.jsx("div",{onClick:()=>{g("Popular"),a(!1)},className:" py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"Popular"}),e.jsx("div",{onClick:()=>{g("New"),a(!1)},className:"py-1 cursor-pointer hover:text-cyan-500 transition-all ease-in-out duration-300",children:"New"})]})]})}),f?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching posts"}):h?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):t?i==="Popular"?N?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Error fetching votes"}):c?e.jsx("div",{className:"mx-auto w-full lg:w-[50%]",children:"Loading..."}):n?t.sort((s,x)=>{const w=n.filter(m=>m.postId===s.postId).length||0;return(n.filter(m=>m.postId===x.postId).length||0)-w}).map(s=>r===""?e.jsx(v,{post:s},s.postId):s.title.toLowerCase().includes(r.toLowerCase())||s.content.toLowerCase().includes(r.toLowerCase())?e.jsx(v,{post:s},s.postId):""):e.jsx("div",{children:"An unexpected error has occured"}):t.sort((s,x)=>x.createdAt.getTime()-s.createdAt.getTime()).map(s=>r===""?e.jsx(v,{post:s},s.postId):s.title.toLowerCase().includes(r.toLowerCase())||s.content.toLowerCase().includes(r.toLowerCase())?e.jsx(v,{post:s},s.postId):""):e.jsx("div",{children:"No posts! Be the first to create one."})]})})}export{$ as component};
